BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%black%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2727297372.72926
 ALGERIA                   |   1997 | 4647478137.20106
 ALGERIA                   |   1996 | 4667447646.63491
 ALGERIA                   |   1995 | 4672597166.52216
 ALGERIA                   |   1994 |  4651465695.9336
 ALGERIA                   |   1993 | 4647133849.84882
 ALGERIA                   |   1992 | 4669337852.96095
 ARGENTINA                 |   1998 | 2717447773.55098
 ARGENTINA                 |   1997 | 4652773629.86492
 ARGENTINA                 |   1996 | 4635589956.67215
 ARGENTINA                 |   1995 |  4634192499.6641
 ARGENTINA                 |   1994 | 4667674427.14186
 ARGENTINA                 |   1993 | 4634138706.15157
 ARGENTINA                 |   1992 | 4647370404.97367
 BRAZIL                    |   1998 | 2769837762.92975
 BRAZIL                    |   1997 | 4719652563.33983
 BRAZIL                    |   1996 | 4731821145.56026
 BRAZIL                    |   1995 | 4695884022.25864
 BRAZIL                    |   1994 | 4692781928.03492
 BRAZIL                    |   1993 | 4723302929.42915
 BRAZIL                    |   1992 | 4720902048.80031
 CANADA                    |   1998 | 2740536856.37389
 CANADA                    |   1997 | 4695556107.16689
 CANADA                    |   1996 | 4733316652.66066
 CANADA                    |   1995 | 4697822658.63976
 CANADA                    |   1994 | 4701082779.70752
 CANADA                    |   1993 | 4692802738.45674
 CANADA                    |   1992 | 4693473122.12791
 CHINA                     |   1998 | 2753265426.47916
 CHINA                     |   1997 |  4700045206.1098
 CHINA                     |   1996 | 4685455241.13622
 CHINA                     |   1995 | 4639565962.89791
 CHINA                     |   1994 | 4674764388.05658
 CHINA                     |   1993 | 4661179915.90476
 CHINA                     |   1992 | 4719247567.71924
 EGYPT                     |   1998 | 2733120425.49238
 EGYPT                     |   1997 |  4655861233.4739
 EGYPT                     |   1996 | 4669058922.01929
 EGYPT                     |   1995 | 4667795982.72334
 EGYPT                     |   1994 | 4661756441.71393
 EGYPT                     |   1993 | 4663742011.37834
 EGYPT                     |   1992 | 4687546964.44946
 ETHIOPIA                  |   1998 | 2738972261.60505
 ETHIOPIA                  |   1997 | 4702204879.23981
 ETHIOPIA                  |   1996 | 4707331111.08251
 ETHIOPIA                  |   1995 | 4676314419.67059
 ETHIOPIA                  |   1994 | 4697591435.96148
 ETHIOPIA                  |   1993 | 4672221291.13167
 ETHIOPIA                  |   1992 | 4711191153.43886
 FRANCE                    |   1998 | 2746923986.69567
 FRANCE                    |   1997 | 4665512164.82859
 FRANCE                    |   1996 |  4674598458.4891
 FRANCE                    |   1995 | 4668655076.83657
 FRANCE                    |   1994 | 4686297531.08484
 FRANCE                    |   1993 | 4668310606.58486
 FRANCE                    |   1992 |  4681089787.7288
 GERMANY                   |   1998 | 2752719644.63772
 GERMANY                   |   1997 | 4687188715.36774
 GERMANY                   |   1996 |  4704927836.9478
 GERMANY                   |   1995 | 4696952450.73026
 GERMANY                   |   1994 | 4660581909.06254
 GERMANY                   |   1993 | 4679808476.70053
 GERMANY                   |   1992 | 4707569360.31305
 INDIA                     |   1998 | 2703537185.80433
 INDIA                     |   1997 | 4651653520.09933
 INDIA                     |   1996 | 4664240877.14477
 INDIA                     |   1995 | 4686292648.85656
 INDIA                     |   1994 | 4663518738.20241
 INDIA                     |   1993 | 4649585728.26618
 INDIA                     |   1992 |  4677818601.3182
 INDONESIA                 |   1998 | 2726001302.99608
 INDONESIA                 |   1997 | 4641143013.99315
 INDONESIA                 |   1996 | 4638465417.36547
 INDONESIA                 |   1995 | 4646124445.67321
 INDONESIA                 |   1994 |   4625396478.635
 INDONESIA                 |   1993 | 4620368939.75931
 INDONESIA                 |   1992 |  4637642799.7218
 IRAN                      |   1998 | 2745479925.20481
 IRAN                      |   1997 | 4655239958.41643
 IRAN                      |   1996 | 4650232606.17372
 IRAN                      |   1995 | 4639772553.41517
 IRAN                      |   1994 | 4668874628.89823
 IRAN                      |   1993 | 4648189783.78033
 IRAN                      |   1992 | 4692206754.80725
 IRAQ                      |   1998 |  2732163190.5265
 IRAQ                      |   1997 | 4630561945.10354
 IRAQ                      |   1996 | 4681071143.73144
 IRAQ                      |   1995 |  4623266154.5399
 IRAQ                      |   1994 | 4648958084.63114
 IRAQ                      |   1993 | 4628432843.02669
 IRAQ                      |   1992 | 4672701041.99032
 JAPAN                     |   1998 | 2706787711.11018
 JAPAN                     |   1997 | 4619055981.90882
 JAPAN                     |   1996 | 4628458555.25225
 JAPAN                     |   1995 | 4616243041.81052
 JAPAN                     |   1994 | 4616689495.80153
 JAPAN                     |   1993 |  4633274805.7663
 JAPAN                     |   1992 | 4620509535.88069
 JORDAN                    |   1998 | 2728181259.12882
 JORDAN                    |   1997 | 4631565958.57568
 JORDAN                    |   1996 | 4670240153.00892
 JORDAN                    |   1995 | 4636387611.43963
 JORDAN                    |   1994 | 4644304639.29657
 JORDAN                    |   1993 | 4657131158.06896
 JORDAN                    |   1992 | 4656291284.71529
 KENYA                     |   1998 | 2723345874.05719
 KENYA                     |   1997 | 4647871778.01846
 KENYA                     |   1996 | 4646211121.94648
 KENYA                     |   1995 | 4674085250.54729
 KENYA                     |   1994 |  4670061130.8441
 KENYA                     |   1993 | 4634769782.42829
 KENYA                     |   1992 | 4676235309.76671
 MOROCCO                   |   1998 |  2721895403.1346
 MOROCCO                   |   1997 | 4661321634.72072
 MOROCCO                   |   1996 | 4684223264.66947
 MOROCCO                   |   1995 | 4669361161.46638
 MOROCCO                   |   1994 | 4700836244.98395
 MOROCCO                   |   1993 | 4680577048.88482
 MOROCCO                   |   1992 | 4712603714.71434
 MOZAMBIQUE                |   1998 | 2740120304.95375
 MOZAMBIQUE                |   1997 | 4650663861.90563
 MOZAMBIQUE                |   1996 | 4684491755.54798
 MOZAMBIQUE                |   1995 | 4687108418.44611
 MOZAMBIQUE                |   1994 | 4679759319.32064
 MOZAMBIQUE                |   1993 | 4679531442.31721
 MOZAMBIQUE                |   1992 | 4691863219.62446
 PERU                      |   1998 | 2718715409.41299
 PERU                      |   1997 | 4615887384.06344
 PERU                      |   1996 | 4627887400.66791
 PERU                      |   1995 | 4636940912.48823
 PERU                      |   1994 | 4640145147.18266
 PERU                      |   1993 | 4608598289.04051
 PERU                      |   1992 | 4648344399.14366
 ROMANIA                   |   1998 | 2725264190.20893
 ROMANIA                   |   1997 | 4685603259.41763
 ROMANIA                   |   1996 | 4700673797.85633
 ROMANIA                   |   1995 | 4674722727.59841
 ROMANIA                   |   1994 | 4689791447.44681
 ROMANIA                   |   1993 | 4665385768.30091
 ROMANIA                   |   1992 | 4695817615.79981
 RUSSIA                    |   1998 | 2730499967.18184
 RUSSIA                    |   1997 | 4726465473.37664
 RUSSIA                    |   1996 | 4700321540.77676
 RUSSIA                    |   1995 | 4670669801.86106
 RUSSIA                    |   1994 | 4667888223.21972
 RUSSIA                    |   1993 | 4678832913.33367
 RUSSIA                    |   1992 | 4689534449.27133
 SAUDI ARABIA              |   1998 | 2757006883.76721
 SAUDI ARABIA              |   1997 | 4693988845.86591
 SAUDI ARABIA              |   1996 | 4707278027.35746
 SAUDI ARABIA              |   1995 | 4680526911.72254
 SAUDI ARABIA              |   1994 | 4662604124.73386
 SAUDI ARABIA              |   1993 | 4647870773.35519
 SAUDI ARABIA              |   1992 | 4677079368.86984
 UNITED KINGDOM            |   1998 | 2752587116.21141
 UNITED KINGDOM            |   1997 | 4705994465.06346
 UNITED KINGDOM            |   1996 | 4711463436.97345
 UNITED KINGDOM            |   1995 | 4726880547.40678
 UNITED KINGDOM            |   1994 | 4703250768.29394
 UNITED KINGDOM            |   1993 |  4698130778.2393
 UNITED KINGDOM            |   1992 | 4708990217.81927
 UNITED STATES             |   1998 | 2744872805.09672
 UNITED STATES             |   1997 | 4731173929.12116
 UNITED STATES             |   1996 | 4697282880.26673
 UNITED STATES             |   1995 | 4692631135.23382
 UNITED STATES             |   1994 |  4688006180.6705
 UNITED STATES             |   1993 | 4684364027.81992
 UNITED STATES             |   1992 | 4691957575.88779
 VIETNAM                   |   1998 | 2741682723.81323
 VIETNAM                   |   1997 | 4663912405.22724
 VIETNAM                   |   1996 | 4669542920.06844
 VIETNAM                   |   1995 | 4679395820.93506
 VIETNAM                   |   1994 | 4688135761.65597
 VIETNAM                   |   1993 | 4686196046.56726
 VIETNAM                   |   1992 | 4689199762.91698
(175 rows)

COMMIT;
COMMIT
