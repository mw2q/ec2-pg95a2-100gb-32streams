BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%linen%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  2718481075.5326
 ALGERIA                   |   1997 | 4624885422.49976
 ALGERIA                   |   1996 | 4656369211.13438
 ALGERIA                   |   1995 |   4639121908.504
 ALGERIA                   |   1994 | 4664219793.80654
 ALGERIA                   |   1993 | 4646255991.82734
 ALGERIA                   |   1992 | 4648777167.85556
 ARGENTINA                 |   1998 | 2728345275.49366
 ARGENTINA                 |   1997 | 4657867637.83011
 ARGENTINA                 |   1996 | 4665079537.92178
 ARGENTINA                 |   1995 | 4650240920.77156
 ARGENTINA                 |   1994 | 4660607456.07866
 ARGENTINA                 |   1993 | 4646421879.03246
 ARGENTINA                 |   1992 | 4671810229.27663
 BRAZIL                    |   1998 | 2745500709.05272
 BRAZIL                    |   1997 | 4682340908.33997
 BRAZIL                    |   1996 | 4680389778.59565
 BRAZIL                    |   1995 | 4682015658.30586
 BRAZIL                    |   1994 | 4682704991.44476
 BRAZIL                    |   1993 | 4694321774.88371
 BRAZIL                    |   1992 | 4686151797.43608
 CANADA                    |   1998 | 2756739197.39702
 CANADA                    |   1997 | 4701576946.86082
 CANADA                    |   1996 | 4711275220.41788
 CANADA                    |   1995 | 4700043591.81536
 CANADA                    |   1994 | 4709578254.09398
 CANADA                    |   1993 | 4692601108.54014
 CANADA                    |   1992 | 4697789069.03681
 CHINA                     |   1998 | 2720021548.06031
 CHINA                     |   1997 | 4694293422.23054
 CHINA                     |   1996 | 4682278549.54678
 CHINA                     |   1995 | 4686468532.23214
 CHINA                     |   1994 |   4656391693.564
 CHINA                     |   1993 | 4692557430.74372
 CHINA                     |   1992 | 4721622299.99074
 EGYPT                     |   1998 |  2729510768.9259
 EGYPT                     |   1997 | 4664577295.32639
 EGYPT                     |   1996 | 4671839935.49637
 EGYPT                     |   1995 | 4633242229.38678
 EGYPT                     |   1994 | 4683954239.08458
 EGYPT                     |   1993 | 4654254645.75616
 EGYPT                     |   1992 | 4671756582.99069
 ETHIOPIA                  |   1998 |  2750647286.9372
 ETHIOPIA                  |   1997 | 4677576646.69374
 ETHIOPIA                  |   1996 | 4695847973.07713
 ETHIOPIA                  |   1995 | 4672763520.09738
 ETHIOPIA                  |   1994 | 4700837040.84282
 ETHIOPIA                  |   1993 |  4688851624.7783
 ETHIOPIA                  |   1992 | 4690125529.63612
 FRANCE                    |   1998 | 2728042107.63107
 FRANCE                    |   1997 | 4676067329.27691
 FRANCE                    |   1996 | 4676861231.46049
 FRANCE                    |   1995 |  4677034925.1729
 FRANCE                    |   1994 | 4675026854.53323
 FRANCE                    |   1993 |  4672103050.7951
 FRANCE                    |   1992 |  4679001417.7512
 GERMANY                   |   1998 | 2749702278.58092
 GERMANY                   |   1997 | 4688492960.24988
 GERMANY                   |   1996 | 4706798887.13249
 GERMANY                   |   1995 | 4700567868.46856
 GERMANY                   |   1994 | 4693959440.81593
 GERMANY                   |   1993 | 4699565887.43123
 GERMANY                   |   1992 | 4727904807.86226
 INDIA                     |   1998 | 2731584165.00333
 INDIA                     |   1997 |  4688896530.2691
 INDIA                     |   1996 | 4695730595.11529
 INDIA                     |   1995 |  4676033270.0372
 INDIA                     |   1994 | 4689724927.89896
 INDIA                     |   1993 | 4672635915.73798
 INDIA                     |   1992 |  4695937733.7673
 INDONESIA                 |   1998 | 2725492953.50582
 INDONESIA                 |   1997 | 4638455512.23261
 INDONESIA                 |   1996 | 4651962175.92076
 INDONESIA                 |   1995 | 4644150903.14648
 INDONESIA                 |   1994 | 4638786737.38003
 INDONESIA                 |   1993 | 4634366158.20951
 INDONESIA                 |   1992 | 4635301900.59022
 IRAN                      |   1998 | 2719460241.26002
 IRAN                      |   1997 |  4656618053.7556
 IRAN                      |   1996 | 4639603449.87703
 IRAN                      |   1995 | 4626481522.04113
 IRAN                      |   1994 |  4646378256.7102
 IRAN                      |   1993 | 4643271573.86512
 IRAN                      |   1992 | 4676592211.28741
 IRAQ                      |   1998 | 2750182509.96847
 IRAQ                      |   1997 |  4647709214.0001
 IRAQ                      |   1996 | 4674052394.47907
 IRAQ                      |   1995 | 4650686571.80352
 IRAQ                      |   1994 | 4652912006.36287
 IRAQ                      |   1993 | 4649750088.33409
 IRAQ                      |   1992 |  4687371356.5102
 JAPAN                     |   1998 | 2708759765.67698
 JAPAN                     |   1997 |   4618032690.487
 JAPAN                     |   1996 | 4615836708.55148
 JAPAN                     |   1995 | 4638689393.69703
 JAPAN                     |   1994 | 4626558172.39794
 JAPAN                     |   1993 | 4611169273.77999
 JAPAN                     |   1992 | 4617641324.32217
 JORDAN                    |   1998 | 2725769646.22278
 JORDAN                    |   1997 | 4643317272.09817
 JORDAN                    |   1996 | 4670650442.39472
 JORDAN                    |   1995 | 4642766834.33145
 JORDAN                    |   1994 | 4664199231.66002
 JORDAN                    |   1993 | 4666790794.81085
 JORDAN                    |   1992 |  4668821496.3188
 KENYA                     |   1998 | 2733083421.86308
 KENYA                     |   1997 | 4655630928.41249
 KENYA                     |   1996 | 4652189532.34752
 KENYA                     |   1995 | 4637646751.74503
 KENYA                     |   1994 | 4652419808.71501
 KENYA                     |   1993 | 4629277676.85249
 KENYA                     |   1992 | 4638392239.13144
 MOROCCO                   |   1998 |  2752200940.3107
 MOROCCO                   |   1997 | 4656601773.56694
 MOROCCO                   |   1996 | 4707235950.01382
 MOROCCO                   |   1995 | 4687051337.05579
 MOROCCO                   |   1994 | 4675506008.76249
 MOROCCO                   |   1993 | 4679035581.54499
 MOROCCO                   |   1992 | 4655184807.89294
 MOZAMBIQUE                |   1998 | 2733180104.14088
 MOZAMBIQUE                |   1997 |  4643373606.1255
 MOZAMBIQUE                |   1996 | 4668240106.93648
 MOZAMBIQUE                |   1995 | 4644000239.58507
 MOZAMBIQUE                |   1994 | 4623073415.31801
 MOZAMBIQUE                |   1993 | 4668951408.42311
 MOZAMBIQUE                |   1992 | 4642006910.38283
 PERU                      |   1998 | 2728205262.72944
 PERU                      |   1997 | 4641322098.60213
 PERU                      |   1996 | 4648875726.20216
 PERU                      |   1995 | 4658383753.95797
 PERU                      |   1994 | 4678851240.76624
 PERU                      |   1993 | 4646937207.12574
 PERU                      |   1992 | 4663404307.17695
 ROMANIA                   |   1998 | 2762912064.09315
 ROMANIA                   |   1997 | 4691272166.39919
 ROMANIA                   |   1996 |  4732077415.5961
 ROMANIA                   |   1995 | 4692097296.78996
 ROMANIA                   |   1994 | 4709262042.08816
 ROMANIA                   |   1993 |  4686984148.2424
 ROMANIA                   |   1992 | 4725152458.26423
 RUSSIA                    |   1998 | 2737393091.01979
 RUSSIA                    |   1997 |  4667349930.0417
 RUSSIA                    |   1996 | 4702602193.17357
 RUSSIA                    |   1995 |  4655114956.4792
 RUSSIA                    |   1994 | 4670084613.12161
 RUSSIA                    |   1993 | 4668877092.64023
 RUSSIA                    |   1992 | 4675553524.30373
 SAUDI ARABIA              |   1998 | 2730774595.47063
 SAUDI ARABIA              |   1997 | 4677823975.43067
 SAUDI ARABIA              |   1996 | 4680273472.62811
 SAUDI ARABIA              |   1995 | 4646395147.35898
 SAUDI ARABIA              |   1994 | 4676045044.75365
 SAUDI ARABIA              |   1993 | 4657287540.16588
 SAUDI ARABIA              |   1992 | 4676069451.06808
 UNITED KINGDOM            |   1998 | 2752873046.88533
 UNITED KINGDOM            |   1997 | 4672508696.42174
 UNITED KINGDOM            |   1996 | 4670105489.41638
 UNITED KINGDOM            |   1995 | 4686924958.93554
 UNITED KINGDOM            |   1994 | 4688658157.55487
 UNITED KINGDOM            |   1993 | 4670727809.41104
 UNITED KINGDOM            |   1992 |  4680960272.0462
 UNITED STATES             |   1998 | 2749033839.44414
 UNITED STATES             |   1997 |  4685629924.0726
 UNITED STATES             |   1996 | 4670405742.80089
 UNITED STATES             |   1995 | 4669330195.45215
 UNITED STATES             |   1994 | 4688092814.65673
 UNITED STATES             |   1993 | 4691246326.62418
 UNITED STATES             |   1992 | 4709941232.76856
 VIETNAM                   |   1998 | 2749506228.52028
 VIETNAM                   |   1997 | 4672660265.54181
 VIETNAM                   |   1996 | 4709356615.81475
 VIETNAM                   |   1995 | 4683307292.33815
 VIETNAM                   |   1994 | 4678433269.16311
 VIETNAM                   |   1993 |   4689847190.549
 VIETNAM                   |   1992 | 4721977671.41186
(175 rows)

COMMIT;
COMMIT
