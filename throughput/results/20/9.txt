BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%rose%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2746325400.00174
 ALGERIA                   |   1997 | 4709036094.87867
 ALGERIA                   |   1996 | 4697833154.21142
 ALGERIA                   |   1995 | 4685684725.20755
 ALGERIA                   |   1994 | 4693593817.50035
 ALGERIA                   |   1993 | 4680089634.27305
 ALGERIA                   |   1992 | 4709299643.88976
 ARGENTINA                 |   1998 | 2721882415.86975
 ARGENTINA                 |   1997 | 4676126157.83675
 ARGENTINA                 |   1996 | 4648692752.39319
 ARGENTINA                 |   1995 | 4639945549.35421
 ARGENTINA                 |   1994 |  4640674093.8214
 ARGENTINA                 |   1993 | 4638111633.14376
 ARGENTINA                 |   1992 | 4659994002.86951
 BRAZIL                    |   1998 | 2736664315.52651
 BRAZIL                    |   1997 | 4673959604.84584
 BRAZIL                    |   1996 | 4655771613.74298
 BRAZIL                    |   1995 | 4670059736.05126
 BRAZIL                    |   1994 | 4664151925.42699
 BRAZIL                    |   1993 | 4692528290.89122
 BRAZIL                    |   1992 | 4674250982.91578
 CANADA                    |   1998 |  2751622386.6835
 CANADA                    |   1997 |  4712728910.6181
 CANADA                    |   1996 | 4715596026.88887
 CANADA                    |   1995 | 4674115982.94893
 CANADA                    |   1994 | 4697611198.07855
 CANADA                    |   1993 | 4677245204.76101
 CANADA                    |   1992 | 4706834907.71111
 CHINA                     |   1998 |   2715508736.698
 CHINA                     |   1997 | 4659994099.92402
 CHINA                     |   1996 | 4671761672.21281
 CHINA                     |   1995 | 4659344946.25678
 CHINA                     |   1994 | 4664927011.68817
 CHINA                     |   1993 | 4654003737.46437
 CHINA                     |   1992 | 4658396599.99513
 EGYPT                     |   1998 |  2730597114.0518
 EGYPT                     |   1997 |  4680123090.4228
 EGYPT                     |   1996 | 4662049452.00837
 EGYPT                     |   1995 | 4661693153.12681
 EGYPT                     |   1994 | 4656322767.21425
 EGYPT                     |   1993 | 4657048270.68317
 EGYPT                     |   1992 | 4664705354.52417
 ETHIOPIA                  |   1998 | 2756543187.31918
 ETHIOPIA                  |   1997 | 4676054945.89959
 ETHIOPIA                  |   1996 |  4699187642.0687
 ETHIOPIA                  |   1995 | 4682534782.78141
 ETHIOPIA                  |   1994 |   4693849340.092
 ETHIOPIA                  |   1993 | 4690019088.24585
 ETHIOPIA                  |   1992 | 4692083031.68398
 FRANCE                    |   1998 | 2728628373.28173
 FRANCE                    |   1997 | 4662282505.73931
 FRANCE                    |   1996 | 4697474421.91709
 FRANCE                    |   1995 | 4639319076.23058
 FRANCE                    |   1994 | 4655565996.69688
 FRANCE                    |   1993 | 4629041001.54239
 FRANCE                    |   1992 | 4670077499.78912
 GERMANY                   |   1998 |  2735871507.2428
 GERMANY                   |   1997 |  4673491329.2234
 GERMANY                   |   1996 | 4661167806.77423
 GERMANY                   |   1995 | 4663977451.27703
 GERMANY                   |   1994 |  4659557670.6275
 GERMANY                   |   1993 | 4689935587.21313
 GERMANY                   |   1992 | 4683013611.38888
 INDIA                     |   1998 | 2749648610.10302
 INDIA                     |   1997 | 4663713786.67125
 INDIA                     |   1996 | 4681308560.12179
 INDIA                     |   1995 | 4674023411.97205
 INDIA                     |   1994 | 4672777497.46933
 INDIA                     |   1993 |  4666907719.2101
 INDIA                     |   1992 | 4692287370.79243
 INDONESIA                 |   1998 | 2706456020.35924
 INDONESIA                 |   1997 | 4616383741.76118
 INDONESIA                 |   1996 | 4631802204.06777
 INDONESIA                 |   1995 |  4616750607.7607
 INDONESIA                 |   1994 | 4627328727.12163
 INDONESIA                 |   1993 | 4626198926.69839
 INDONESIA                 |   1992 | 4632044228.23159
 IRAN                      |   1998 | 2715334576.31268
 IRAN                      |   1997 | 4661144105.28596
 IRAN                      |   1996 | 4647414678.11415
 IRAN                      |   1995 | 4621251262.81471
 IRAN                      |   1994 | 4617966759.99274
 IRAN                      |   1993 | 4627229963.16869
 IRAN                      |   1992 | 4631014331.86957
 IRAQ                      |   1998 | 2721182474.10165
 IRAQ                      |   1997 | 4632865791.39591
 IRAQ                      |   1996 | 4653648080.67433
 IRAQ                      |   1995 | 4653904361.46445
 IRAQ                      |   1994 | 4648968268.85809
 IRAQ                      |   1993 | 4645079985.32913
 IRAQ                      |   1992 | 4676940553.13907
 JAPAN                     |   1998 | 2712339926.32427
 JAPAN                     |   1997 | 4637038864.87471
 JAPAN                     |   1996 | 4632154160.19932
 JAPAN                     |   1995 | 4636398196.18027
 JAPAN                     |   1994 | 4633006448.48647
 JAPAN                     |   1993 | 4613370063.12447
 JAPAN                     |   1992 | 4630146753.00314
 JORDAN                    |   1998 | 2718304854.55086
 JORDAN                    |   1997 | 4638165255.39968
 JORDAN                    |   1996 | 4657818802.18456
 JORDAN                    |   1995 | 4652693565.68417
 JORDAN                    |   1994 | 4646563837.73789
 JORDAN                    |   1993 | 4626544495.93478
 JORDAN                    |   1992 | 4657470132.82394
 KENYA                     |   1998 | 2712796414.69033
 KENYA                     |   1997 | 4623828820.92539
 KENYA                     |   1996 | 4644712885.77937
 KENYA                     |   1995 | 4636183159.40496
 KENYA                     |   1994 | 4649113800.46024
 KENYA                     |   1993 | 4631824604.29926
 KENYA                     |   1992 | 4654139335.60734
 MOROCCO                   |   1998 | 2743805399.09989
 MOROCCO                   |   1997 |   4693694744.538
 MOROCCO                   |   1996 | 4696078191.91262
 MOROCCO                   |   1995 | 4675696479.25375
 MOROCCO                   |   1994 | 4652961530.87044
 MOROCCO                   |   1993 | 4677024551.67667
 MOROCCO                   |   1992 | 4694544017.64903
 MOZAMBIQUE                |   1998 |  2729887203.0212
 MOZAMBIQUE                |   1997 |  4674998241.4251
 MOZAMBIQUE                |   1996 | 4673627180.98343
 MOZAMBIQUE                |   1995 |  4636144118.1214
 MOZAMBIQUE                |   1994 | 4625618822.20021
 MOZAMBIQUE                |   1993 | 4628260821.30819
 MOZAMBIQUE                |   1992 |   4666021661.627
 PERU                      |   1998 | 2719408194.29931
 PERU                      |   1997 | 4649271804.35092
 PERU                      |   1996 | 4653288349.63154
 PERU                      |   1995 | 4639573945.34069
 PERU                      |   1994 | 4645682424.83521
 PERU                      |   1993 | 4642198858.69308
 PERU                      |   1992 | 4634800517.15167
 ROMANIA                   |   1998 | 2733988830.80843
 ROMANIA                   |   1997 | 4654342772.00514
 ROMANIA                   |   1996 | 4668196737.53417
 ROMANIA                   |   1995 | 4654531350.12832
 ROMANIA                   |   1994 |  4646465439.0588
 ROMANIA                   |   1993 | 4641909167.04387
 ROMANIA                   |   1992 | 4653303811.08156
 RUSSIA                    |   1998 | 2736451519.03955
 RUSSIA                    |   1997 | 4658501784.76361
 RUSSIA                    |   1996 | 4657616136.58925
 RUSSIA                    |   1995 | 4651544861.18093
 RUSSIA                    |   1994 |  4666288051.3299
 RUSSIA                    |   1993 | 4655775831.79947
 RUSSIA                    |   1992 |  4679711653.9749
 SAUDI ARABIA              |   1998 | 2732226906.29362
 SAUDI ARABIA              |   1997 | 4604944124.22809
 SAUDI ARABIA              |   1996 | 4661516649.10127
 SAUDI ARABIA              |   1995 | 4629475683.27076
 SAUDI ARABIA              |   1994 | 4641511661.52089
 SAUDI ARABIA              |   1993 | 4634290676.92743
 SAUDI ARABIA              |   1992 | 4649848399.75285
 UNITED KINGDOM            |   1998 | 2755910021.62114
 UNITED KINGDOM            |   1997 | 4709670929.03434
 UNITED KINGDOM            |   1996 | 4688185147.67336
 UNITED KINGDOM            |   1995 | 4713457144.32279
 UNITED KINGDOM            |   1994 | 4682609994.70895
 UNITED KINGDOM            |   1993 | 4675644159.82212
 UNITED KINGDOM            |   1992 | 4692448695.81488
 UNITED STATES             |   1998 | 2753079663.22508
 UNITED STATES             |   1997 | 4658950204.79017
 UNITED STATES             |   1996 | 4690408779.62891
 UNITED STATES             |   1995 | 4654584618.09017
 UNITED STATES             |   1994 | 4691417059.00004
 UNITED STATES             |   1993 | 4636282493.06106
 UNITED STATES             |   1992 | 4677966387.06759
 VIETNAM                   |   1998 | 2742507501.09929
 VIETNAM                   |   1997 |  4685453307.9737
 VIETNAM                   |   1996 | 4694946024.27007
 VIETNAM                   |   1995 | 4683215832.19726
 VIETNAM                   |   1994 | 4673060876.28535
 VIETNAM                   |   1993 | 4713420354.67672
 VIETNAM                   |   1992 | 4682296811.84445
(175 rows)

COMMIT;
COMMIT
