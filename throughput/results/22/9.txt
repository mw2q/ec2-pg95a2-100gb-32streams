BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%orange%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2752299116.05362
 ALGERIA                   |   1997 | 4663465472.11012
 ALGERIA                   |   1996 | 4676743386.83459
 ALGERIA                   |   1995 | 4671672663.17256
 ALGERIA                   |   1994 | 4677457699.06969
 ALGERIA                   |   1993 | 4666244247.47758
 ALGERIA                   |   1992 |  4670821884.9972
 ARGENTINA                 |   1998 | 2719395981.14694
 ARGENTINA                 |   1997 |  4638535845.8204
 ARGENTINA                 |   1996 | 4638715694.05504
 ARGENTINA                 |   1995 | 4638283755.69035
 ARGENTINA                 |   1994 | 4632252689.55453
 ARGENTINA                 |   1993 |  4635731244.1121
 ARGENTINA                 |   1992 | 4649196626.74191
 BRAZIL                    |   1998 | 2719224812.50594
 BRAZIL                    |   1997 |  4660340006.9885
 BRAZIL                    |   1996 | 4696774012.51396
 BRAZIL                    |   1995 | 4636988954.54318
 BRAZIL                    |   1994 | 4650368682.95598
 BRAZIL                    |   1993 | 4643455150.10371
 BRAZIL                    |   1992 | 4662881723.55258
 CANADA                    |   1998 | 2732715626.92862
 CANADA                    |   1997 |  4681127744.2304
 CANADA                    |   1996 | 4693556011.98471
 CANADA                    |   1995 |  4687880301.7286
 CANADA                    |   1994 | 4700692127.53852
 CANADA                    |   1993 | 4698052712.78222
 CANADA                    |   1992 | 4695622989.29732
 CHINA                     |   1998 | 2735516236.38631
 CHINA                     |   1997 | 4646608001.06639
 CHINA                     |   1996 | 4668684689.65134
 CHINA                     |   1995 | 4638453236.86805
 CHINA                     |   1994 | 4661091814.39696
 CHINA                     |   1993 | 4661556890.76602
 CHINA                     |   1992 | 4674568448.02545
 EGYPT                     |   1998 |  2750680026.2146
 EGYPT                     |   1997 | 4661652004.79217
 EGYPT                     |   1996 |  4668180239.5435
 EGYPT                     |   1995 | 4648227019.45624
 EGYPT                     |   1994 | 4656976523.21583
 EGYPT                     |   1993 | 4680433279.56765
 EGYPT                     |   1992 | 4653199237.95955
 ETHIOPIA                  |   1998 |   2778556802.404
 ETHIOPIA                  |   1997 | 4673464015.98848
 ETHIOPIA                  |   1996 | 4751025882.22257
 ETHIOPIA                  |   1995 | 4693867247.66175
 ETHIOPIA                  |   1994 | 4684554486.40256
 ETHIOPIA                  |   1993 | 4664573649.71306
 ETHIOPIA                  |   1992 | 4706403350.46728
 FRANCE                    |   1998 | 2714744513.45525
 FRANCE                    |   1997 | 4689879844.06471
 FRANCE                    |   1996 | 4679215665.06973
 FRANCE                    |   1995 | 4661220567.43601
 FRANCE                    |   1994 |  4670226343.2474
 FRANCE                    |   1993 | 4662360035.48382
 FRANCE                    |   1992 | 4676957827.74022
 GERMANY                   |   1998 | 2744992649.13513
 GERMANY                   |   1997 | 4692497254.39753
 GERMANY                   |   1996 | 4696705535.65543
 GERMANY                   |   1995 |  4689001701.5053
 GERMANY                   |   1994 | 4684318607.04991
 GERMANY                   |   1993 | 4674630515.80948
 GERMANY                   |   1992 | 4714351594.88362
 INDIA                     |   1998 | 2765603587.56727
 INDIA                     |   1997 | 4713479474.69584
 INDIA                     |   1996 | 4710809616.61336
 INDIA                     |   1995 | 4708480120.31687
 INDIA                     |   1994 | 4659310680.96952
 INDIA                     |   1993 | 4703719768.90654
 INDIA                     |   1992 |  4731831121.1609
 INDONESIA                 |   1998 | 2718470641.44898
 INDONESIA                 |   1997 | 4643006515.32432
 INDONESIA                 |   1996 |  4639643525.0425
 INDONESIA                 |   1995 | 4664201872.30646
 INDONESIA                 |   1994 | 4638881961.68337
 INDONESIA                 |   1993 | 4660720687.67851
 INDONESIA                 |   1992 |  4675205890.4228
 IRAN                      |   1998 | 2714438546.57327
 IRAN                      |   1997 |  4638000225.0856
 IRAN                      |   1996 | 4631050775.87856
 IRAN                      |   1995 |  4624366608.4584
 IRAN                      |   1994 | 4639453974.55819
 IRAN                      |   1993 | 4640053067.97899
 IRAN                      |   1992 |  4630193316.3857
 IRAQ                      |   1998 | 2732296429.74598
 IRAQ                      |   1997 | 4639695259.49004
 IRAQ                      |   1996 | 4683799562.31356
 IRAQ                      |   1995 | 4631907051.33629
 IRAQ                      |   1994 | 4651766793.19652
 IRAQ                      |   1993 | 4651884393.75794
 IRAQ                      |   1992 | 4680157001.55935
 JAPAN                     |   1998 | 2735876348.78782
 JAPAN                     |   1997 | 4653221530.46389
 JAPAN                     |   1996 | 4666986076.17696
 JAPAN                     |   1995 | 4663731542.00214
 JAPAN                     |   1994 | 4662530879.05921
 JAPAN                     |   1993 | 4657515537.60812
 JAPAN                     |   1992 | 4683722641.06803
 JORDAN                    |   1998 | 2705319897.96198
 JORDAN                    |   1997 | 4631878203.21377
 JORDAN                    |   1996 | 4659492160.21782
 JORDAN                    |   1995 | 4616652426.97219
 JORDAN                    |   1994 |  4624528343.1903
 JORDAN                    |   1993 | 4654400073.21836
 JORDAN                    |   1992 | 4654837535.94651
 KENYA                     |   1998 | 2716046898.61942
 KENYA                     |   1997 | 4667711021.64243
 KENYA                     |   1996 | 4656451640.97322
 KENYA                     |   1995 | 4645519242.21277
 KENYA                     |   1994 | 4635604109.57549
 KENYA                     |   1993 | 4630265250.69376
 KENYA                     |   1992 | 4651635472.58927
 MOROCCO                   |   1998 | 2750993436.71494
 MOROCCO                   |   1997 | 4679287855.71347
 MOROCCO                   |   1996 | 4701897427.87411
 MOROCCO                   |   1995 | 4700178990.95989
 MOROCCO                   |   1994 | 4677164779.83054
 MOROCCO                   |   1993 | 4689611488.55578
 MOROCCO                   |   1992 | 4651018512.23055
 MOZAMBIQUE                |   1998 | 2716628660.31401
 MOZAMBIQUE                |   1997 | 4678545078.62712
 MOZAMBIQUE                |   1996 | 4669958637.88073
 MOZAMBIQUE                |   1995 | 4639326359.65661
 MOZAMBIQUE                |   1994 | 4666570645.92153
 MOZAMBIQUE                |   1993 | 4654019826.53796
 MOZAMBIQUE                |   1992 | 4670073434.79841
 PERU                      |   1998 | 2695392967.97753
 PERU                      |   1997 |  4604538446.7633
 PERU                      |   1996 | 4608050540.20399
 PERU                      |   1995 | 4616324744.24429
 PERU                      |   1994 | 4615228616.27972
 PERU                      |   1993 | 4617988464.03071
 PERU                      |   1992 | 4614510877.12144
 ROMANIA                   |   1998 | 2739367628.16831
 ROMANIA                   |   1997 | 4691158969.77043
 ROMANIA                   |   1996 | 4701117628.40733
 ROMANIA                   |   1995 | 4687356617.49436
 ROMANIA                   |   1994 | 4694402028.29968
 ROMANIA                   |   1993 | 4665543885.50101
 ROMANIA                   |   1992 | 4706236349.39141
 RUSSIA                    |   1998 | 2731602717.87891
 RUSSIA                    |   1997 | 4693139236.33653
 RUSSIA                    |   1996 | 4684407522.82976
 RUSSIA                    |   1995 | 4652565711.52062
 RUSSIA                    |   1994 | 4652698658.34828
 RUSSIA                    |   1993 | 4666069113.77264
 RUSSIA                    |   1992 | 4677542305.84624
 SAUDI ARABIA              |   1998 | 2724169573.64565
 SAUDI ARABIA              |   1997 | 4661994304.70262
 SAUDI ARABIA              |   1996 | 4654451820.39007
 SAUDI ARABIA              |   1995 | 4646197961.86421
 SAUDI ARABIA              |   1994 | 4637471246.43516
 SAUDI ARABIA              |   1993 | 4637496636.78802
 SAUDI ARABIA              |   1992 |  4658693142.9369
 UNITED KINGDOM            |   1998 | 2754582365.05508
 UNITED KINGDOM            |   1997 | 4683857023.93169
 UNITED KINGDOM            |   1996 | 4710207972.72084
 UNITED KINGDOM            |   1995 | 4722137362.73043
 UNITED KINGDOM            |   1994 | 4710204956.03343
 UNITED KINGDOM            |   1993 | 4701850798.40595
 UNITED KINGDOM            |   1992 | 4714759844.90033
 UNITED STATES             |   1998 | 2720777015.86849
 UNITED STATES             |   1997 | 4675712621.48713
 UNITED STATES             |   1996 |  4689420611.3097
 UNITED STATES             |   1995 | 4687008798.04644
 UNITED STATES             |   1994 | 4671933328.81314
 UNITED STATES             |   1993 | 4681431347.32675
 UNITED STATES             |   1992 | 4705287989.94425
 VIETNAM                   |   1998 | 2741881349.49233
 VIETNAM                   |   1997 |  4678443929.3355
 VIETNAM                   |   1996 | 4700471166.53759
 VIETNAM                   |   1995 | 4689972024.07731
 VIETNAM                   |   1994 | 4669185466.06003
 VIETNAM                   |   1993 | 4688597831.56029
 VIETNAM                   |   1992 | 4696642623.38183
(175 rows)

COMMIT;
COMMIT
