BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%ivory%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2741221427.68121
 ALGERIA                   |   1997 | 4669095491.66155
 ALGERIA                   |   1996 | 4683705992.58329
 ALGERIA                   |   1995 |  4672327907.3231
 ALGERIA                   |   1994 | 4661039915.39529
 ALGERIA                   |   1993 | 4682483632.13482
 ALGERIA                   |   1992 | 4674125211.08893
 ARGENTINA                 |   1998 | 2709468432.37498
 ARGENTINA                 |   1997 | 4625783945.02961
 ARGENTINA                 |   1996 | 4646648064.01751
 ARGENTINA                 |   1995 | 4619722215.71569
 ARGENTINA                 |   1994 | 4626429759.52917
 ARGENTINA                 |   1993 | 4645926758.75156
 ARGENTINA                 |   1992 | 4630086001.25353
 BRAZIL                    |   1998 | 2737408123.86827
 BRAZIL                    |   1997 | 4680904608.11511
 BRAZIL                    |   1996 | 4688238950.87097
 BRAZIL                    |   1995 | 4679702849.06139
 BRAZIL                    |   1994 | 4692116978.86838
 BRAZIL                    |   1993 | 4689855570.54735
 BRAZIL                    |   1992 |  4702515321.1712
 CANADA                    |   1998 | 2735029025.85335
 CANADA                    |   1997 | 4693359446.00888
 CANADA                    |   1996 | 4711758707.28697
 CANADA                    |   1995 | 4708526987.54252
 CANADA                    |   1994 |  4690157999.5666
 CANADA                    |   1993 | 4669920174.99527
 CANADA                    |   1992 |  4699389795.0998
 CHINA                     |   1998 | 2749249318.70747
 CHINA                     |   1997 | 4651867001.34397
 CHINA                     |   1996 | 4666767897.60017
 CHINA                     |   1995 | 4671824525.37648
 CHINA                     |   1994 | 4649427424.89558
 CHINA                     |   1993 | 4668042702.39998
 CHINA                     |   1992 | 4672235431.88961
 EGYPT                     |   1998 |  2716536983.7334
 EGYPT                     |   1997 | 4659068953.54404
 EGYPT                     |   1996 | 4655192446.96447
 EGYPT                     |   1995 | 4652428184.48107
 EGYPT                     |   1994 | 4656249608.73534
 EGYPT                     |   1993 |  4660094975.0146
 EGYPT                     |   1992 | 4666159517.18436
 ETHIOPIA                  |   1998 | 2767116675.73588
 ETHIOPIA                  |   1997 | 4723046346.69722
 ETHIOPIA                  |   1996 | 4709571307.09168
 ETHIOPIA                  |   1995 | 4701271403.65571
 ETHIOPIA                  |   1994 | 4750275052.46985
 ETHIOPIA                  |   1993 | 4733270246.45022
 ETHIOPIA                  |   1992 |  4691577213.7752
 FRANCE                    |   1998 |  2725549970.1173
 FRANCE                    |   1997 | 4667171448.96647
 FRANCE                    |   1996 | 4679625370.61597
 FRANCE                    |   1995 | 4700272422.93897
 FRANCE                    |   1994 | 4701915284.69223
 FRANCE                    |   1993 | 4678028643.27938
 FRANCE                    |   1992 | 4693071998.54219
 GERMANY                   |   1998 | 2723785611.34765
 GERMANY                   |   1997 | 4682724391.82175
 GERMANY                   |   1996 | 4693636256.41843
 GERMANY                   |   1995 | 4668680239.02884
 GERMANY                   |   1994 | 4697834328.12625
 GERMANY                   |   1993 | 4670609508.99953
 GERMANY                   |   1992 | 4691453644.81866
 INDIA                     |   1998 | 2733875465.00889
 INDIA                     |   1997 | 4661750011.21365
 INDIA                     |   1996 | 4673015720.80591
 INDIA                     |   1995 | 4658890029.13784
 INDIA                     |   1994 | 4662832570.13228
 INDIA                     |   1993 | 4643922961.09012
 INDIA                     |   1992 | 4671784177.14769
 INDONESIA                 |   1998 | 2735590126.46372
 INDONESIA                 |   1997 | 4643226794.80778
 INDONESIA                 |   1996 | 4656195972.36229
 INDONESIA                 |   1995 | 4654529723.96144
 INDONESIA                 |   1994 | 4629721982.37862
 INDONESIA                 |   1993 |  4650248786.6851
 INDONESIA                 |   1992 | 4655600381.07044
 IRAN                      |   1998 | 2724530337.45365
 IRAN                      |   1997 | 4629134874.82961
 IRAN                      |   1996 |  4648558014.7425
 IRAN                      |   1995 | 4634150994.15534
 IRAN                      |   1994 | 4656407721.84102
 IRAN                      |   1993 | 4642691742.38645
 IRAN                      |   1992 | 4662078113.58518
 IRAQ                      |   1998 | 2711503918.15917
 IRAQ                      |   1997 | 4626346783.48672
 IRAQ                      |   1996 | 4658246569.36833
 IRAQ                      |   1995 | 4653218225.31344
 IRAQ                      |   1994 | 4624341437.45264
 IRAQ                      |   1993 |  4650077228.2985
 IRAQ                      |   1992 | 4653348423.46067
 JAPAN                     |   1998 | 2711280122.66373
 JAPAN                     |   1997 |   4619424633.709
 JAPAN                     |   1996 | 4667521496.27313
 JAPAN                     |   1995 | 4645637090.99309
 JAPAN                     |   1994 | 4631815424.97317
 JAPAN                     |   1993 | 4617343651.81342
 JAPAN                     |   1992 | 4620825496.79549
 JORDAN                    |   1998 | 2750566257.65845
 JORDAN                    |   1997 | 4677019069.67337
 JORDAN                    |   1996 | 4681137471.79568
 JORDAN                    |   1995 | 4675493367.06665
 JORDAN                    |   1994 | 4687363499.00362
 JORDAN                    |   1993 | 4678438140.72507
 JORDAN                    |   1992 | 4688669234.26917
 KENYA                     |   1998 | 2721261335.09506
 KENYA                     |   1997 | 4634279438.17518
 KENYA                     |   1996 | 4643060823.31253
 KENYA                     |   1995 | 4641014854.40438
 KENYA                     |   1994 |  4666478368.2103
 KENYA                     |   1993 | 4624895836.71916
 KENYA                     |   1992 | 4635647938.34496
 MOROCCO                   |   1998 | 2736326422.87999
 MOROCCO                   |   1997 | 4678135012.58846
 MOROCCO                   |   1996 | 4674155925.94687
 MOROCCO                   |   1995 | 4661536349.45899
 MOROCCO                   |   1994 | 4669315096.77362
 MOROCCO                   |   1993 | 4664028547.31094
 MOROCCO                   |   1992 | 4675056797.04658
 MOZAMBIQUE                |   1998 | 2739199965.62661
 MOZAMBIQUE                |   1997 | 4692121141.03053
 MOZAMBIQUE                |   1996 | 4686668341.94468
 MOZAMBIQUE                |   1995 | 4678659733.59339
 MOZAMBIQUE                |   1994 | 4667426981.67279
 MOZAMBIQUE                |   1993 | 4700341446.26769
 MOZAMBIQUE                |   1992 | 4656673712.69217
 PERU                      |   1998 | 2714858180.33105
 PERU                      |   1997 | 4648777732.88555
 PERU                      |   1996 | 4645301609.08658
 PERU                      |   1995 | 4650294429.30331
 PERU                      |   1994 | 4642927660.40072
 PERU                      |   1993 | 4620397973.48692
 PERU                      |   1992 | 4665652781.22872
 ROMANIA                   |   1998 | 2737826962.88504
 ROMANIA                   |   1997 | 4669587385.04871
 ROMANIA                   |   1996 | 4672650819.14883
 ROMANIA                   |   1995 | 4662447530.57531
 ROMANIA                   |   1994 | 4665372845.36392
 ROMANIA                   |   1993 | 4701517450.48605
 ROMANIA                   |   1992 | 4704898066.45005
 RUSSIA                    |   1998 | 2725132351.49584
 RUSSIA                    |   1997 | 4666647067.80561
 RUSSIA                    |   1996 | 4689336509.96977
 RUSSIA                    |   1995 | 4679094622.73975
 RUSSIA                    |   1994 | 4654604813.67089
 RUSSIA                    |   1993 | 4654349753.57188
 RUSSIA                    |   1992 | 4660071161.71919
 SAUDI ARABIA              |   1998 | 2728385354.44778
 SAUDI ARABIA              |   1997 |  4654713276.2561
 SAUDI ARABIA              |   1996 | 4686802578.59491
 SAUDI ARABIA              |   1995 | 4672968635.63545
 SAUDI ARABIA              |   1994 | 4671248094.08243
 SAUDI ARABIA              |   1993 | 4685458127.51833
 SAUDI ARABIA              |   1992 | 4659788559.65748
 UNITED KINGDOM            |   1998 | 2755472880.13692
 UNITED KINGDOM            |   1997 | 4700257661.55545
 UNITED KINGDOM            |   1996 | 4717040856.37436
 UNITED KINGDOM            |   1995 | 4704748613.09414
 UNITED KINGDOM            |   1994 | 4702928943.81644
 UNITED KINGDOM            |   1993 |  4672887180.7088
 UNITED KINGDOM            |   1992 | 4696547525.19999
 UNITED STATES             |   1998 | 2717247732.28408
 UNITED STATES             |   1997 | 4662317616.86751
 UNITED STATES             |   1996 | 4660200341.17044
 UNITED STATES             |   1995 | 4650233270.99446
 UNITED STATES             |   1994 | 4690893330.30576
 UNITED STATES             |   1993 | 4663634974.30958
 UNITED STATES             |   1992 | 4665217536.80318
 VIETNAM                   |   1998 | 2743540913.18283
 VIETNAM                   |   1997 | 4674361581.31817
 VIETNAM                   |   1996 | 4684116172.26132
 VIETNAM                   |   1995 | 4684456790.87217
 VIETNAM                   |   1994 | 4669182575.70938
 VIETNAM                   |   1993 | 4664827184.73905
 VIETNAM                   |   1992 | 4680610346.63624
(175 rows)

COMMIT;
COMMIT
