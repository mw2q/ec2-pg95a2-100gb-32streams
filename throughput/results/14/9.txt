BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%chiffon%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2736081819.93666
 ALGERIA                   |   1997 |  4687809473.3206
 ALGERIA                   |   1996 | 4692185914.97536
 ALGERIA                   |   1995 | 4666020636.13212
 ALGERIA                   |   1994 | 4704486499.45704
 ALGERIA                   |   1993 |  4643546090.6874
 ALGERIA                   |   1992 | 4676478837.28286
 ARGENTINA                 |   1998 | 2731434461.41148
 ARGENTINA                 |   1997 | 4656944896.85559
 ARGENTINA                 |   1996 | 4655530796.91457
 ARGENTINA                 |   1995 | 4632674726.82853
 ARGENTINA                 |   1994 | 4650512034.72554
 ARGENTINA                 |   1993 | 4664513288.24255
 ARGENTINA                 |   1992 | 4664020281.24826
 BRAZIL                    |   1998 | 2733772729.11549
 BRAZIL                    |   1997 |  4663709862.8975
 BRAZIL                    |   1996 | 4675281059.66245
 BRAZIL                    |   1995 | 4657219572.56304
 BRAZIL                    |   1994 | 4653450510.17946
 BRAZIL                    |   1993 | 4668550419.48919
 BRAZIL                    |   1992 | 4659958207.48629
 CANADA                    |   1998 | 2733780495.46927
 CANADA                    |   1997 | 4661046475.11252
 CANADA                    |   1996 |  4700395966.5131
 CANADA                    |   1995 | 4676894637.49575
 CANADA                    |   1994 | 4679081397.23691
 CANADA                    |   1993 | 4670021295.26828
 CANADA                    |   1992 | 4712935779.95452
 CHINA                     |   1998 | 2736263692.47423
 CHINA                     |   1997 |  4689740772.6403
 CHINA                     |   1996 | 4714158259.74562
 CHINA                     |   1995 | 4683557133.68464
 CHINA                     |   1994 | 4673507928.93323
 CHINA                     |   1993 | 4698061752.01639
 CHINA                     |   1992 | 4686229691.44681
 EGYPT                     |   1998 | 2734534868.30802
 EGYPT                     |   1997 | 4636149611.61046
 EGYPT                     |   1996 | 4666378585.19514
 EGYPT                     |   1995 | 4676355270.95304
 EGYPT                     |   1994 | 4644823001.79366
 EGYPT                     |   1993 | 4658136901.51261
 EGYPT                     |   1992 | 4660183182.11934
 ETHIOPIA                  |   1998 | 2763177744.36418
 ETHIOPIA                  |   1997 | 4677090722.01939
 ETHIOPIA                  |   1996 | 4706628789.04391
 ETHIOPIA                  |   1995 |  4683875378.8248
 ETHIOPIA                  |   1994 | 4698777162.59257
 ETHIOPIA                  |   1993 | 4698443766.88496
 ETHIOPIA                  |   1992 | 4701881559.73305
 FRANCE                    |   1998 | 2731988244.19716
 FRANCE                    |   1997 | 4668707426.51729
 FRANCE                    |   1996 | 4695682191.44498
 FRANCE                    |   1995 | 4678756280.47806
 FRANCE                    |   1994 | 4661303379.56324
 FRANCE                    |   1993 | 4676513872.81312
 FRANCE                    |   1992 | 4692593022.22699
 GERMANY                   |   1998 | 2751871093.48189
 GERMANY                   |   1997 | 4683604913.46113
 GERMANY                   |   1996 | 4699910993.44008
 GERMANY                   |   1995 | 4706936781.55107
 GERMANY                   |   1994 |  4673339685.5768
 GERMANY                   |   1993 | 4685280595.24828
 GERMANY                   |   1992 |  4694081749.2685
 INDIA                     |   1998 | 2728795034.79231
 INDIA                     |   1997 | 4678182774.85552
 INDIA                     |   1996 | 4679157933.66467
 INDIA                     |   1995 | 4654993377.09706
 INDIA                     |   1994 | 4642526482.09498
 INDIA                     |   1993 | 4665701830.17294
 INDIA                     |   1992 | 4666724540.00143
 INDONESIA                 |   1998 | 2707587189.51297
 INDONESIA                 |   1997 | 4600981442.63536
 INDONESIA                 |   1996 | 4621442424.93175
 INDONESIA                 |   1995 | 4643526342.51762
 INDONESIA                 |   1994 | 4643118143.95076
 INDONESIA                 |   1993 | 4615322681.09088
 INDONESIA                 |   1992 | 4615643812.16848
 IRAN                      |   1998 | 2726278672.25942
 IRAN                      |   1997 | 4634001820.64257
 IRAN                      |   1996 | 4668331304.74564
 IRAN                      |   1995 | 4648884507.79536
 IRAN                      |   1994 | 4659782183.49654
 IRAN                      |   1993 | 4643548819.56068
 IRAN                      |   1992 | 4677208449.46494
 IRAQ                      |   1998 | 2711937895.19541
 IRAQ                      |   1997 | 4645092293.99416
 IRAQ                      |   1996 | 4643170868.21865
 IRAQ                      |   1995 | 4621184017.75933
 IRAQ                      |   1994 | 4641544099.55882
 IRAQ                      |   1993 | 4624045248.16287
 IRAQ                      |   1992 | 4637263023.75446
 JAPAN                     |   1998 | 2713989214.89743
 JAPAN                     |   1997 | 4622688084.35245
 JAPAN                     |   1996 | 4652063825.87036
 JAPAN                     |   1995 | 4627926884.15034
 JAPAN                     |   1994 | 4640361729.67451
 JAPAN                     |   1993 |  4628475879.2918
 JAPAN                     |   1992 | 4635011740.51209
 JORDAN                    |   1998 | 2743296761.84324
 JORDAN                    |   1997 | 4660388227.69695
 JORDAN                    |   1996 | 4690805644.20345
 JORDAN                    |   1995 | 4658689318.22201
 JORDAN                    |   1994 | 4649992694.18787
 JORDAN                    |   1993 | 4672986477.87613
 JORDAN                    |   1992 | 4698305006.57613
 KENYA                     |   1998 | 2721288661.54207
 KENYA                     |   1997 | 4631197769.04747
 KENYA                     |   1996 | 4681640612.89861
 KENYA                     |   1995 | 4628503095.05671
 KENYA                     |   1994 | 4642809771.50943
 KENYA                     |   1993 | 4622723701.75166
 KENYA                     |   1992 | 4650461531.80126
 MOROCCO                   |   1998 | 2731712644.55846
 MOROCCO                   |   1997 | 4683153828.71119
 MOROCCO                   |   1996 | 4693428647.08331
 MOROCCO                   |   1995 | 4681111009.74177
 MOROCCO                   |   1994 | 4676612059.78437
 MOROCCO                   |   1993 | 4705457698.63569
 MOROCCO                   |   1992 | 4665206465.28805
 MOZAMBIQUE                |   1998 | 2734537214.48911
 MOZAMBIQUE                |   1997 | 4659860958.94004
 MOZAMBIQUE                |   1996 | 4683197129.20198
 MOZAMBIQUE                |   1995 | 4650721387.95318
 MOZAMBIQUE                |   1994 | 4670559928.79538
 MOZAMBIQUE                |   1993 | 4653045552.14762
 MOZAMBIQUE                |   1992 | 4671797218.24503
 PERU                      |   1998 | 2720206826.00414
 PERU                      |   1997 | 4654590711.31366
 PERU                      |   1996 | 4640145374.20124
 PERU                      |   1995 | 4644379269.10109
 PERU                      |   1994 | 4627989878.83284
 PERU                      |   1993 | 4639190192.22791
 PERU                      |   1992 | 4658854282.24387
 ROMANIA                   |   1998 | 2753656048.76313
 ROMANIA                   |   1997 | 4697294116.82567
 ROMANIA                   |   1996 | 4699904880.19753
 ROMANIA                   |   1995 | 4684974544.98808
 ROMANIA                   |   1994 | 4700542654.74164
 ROMANIA                   |   1993 |  4684347189.8968
 ROMANIA                   |   1992 | 4684668218.87501
 RUSSIA                    |   1998 | 2732577015.34076
 RUSSIA                    |   1997 | 4683883673.87766
 RUSSIA                    |   1996 | 4672755634.34947
 RUSSIA                    |   1995 | 4665379409.52126
 RUSSIA                    |   1994 | 4651906496.77877
 RUSSIA                    |   1993 | 4681116573.83491
 RUSSIA                    |   1992 | 4654916376.96992
 SAUDI ARABIA              |   1998 | 2701453053.23188
 SAUDI ARABIA              |   1997 | 4650335285.28563
 SAUDI ARABIA              |   1996 | 4666479970.78476
 SAUDI ARABIA              |   1995 | 4646618264.97203
 SAUDI ARABIA              |   1994 | 4644207215.21249
 SAUDI ARABIA              |   1993 | 4623440767.75939
 SAUDI ARABIA              |   1992 |   4665511216.542
 UNITED KINGDOM            |   1998 | 2747920523.16878
 UNITED KINGDOM            |   1997 | 4665860539.40519
 UNITED KINGDOM            |   1996 |  4700205026.6665
 UNITED KINGDOM            |   1995 | 4672491610.04284
 UNITED KINGDOM            |   1994 | 4655851234.67227
 UNITED KINGDOM            |   1993 | 4681720831.07379
 UNITED KINGDOM            |   1992 |  4688212591.5969
 UNITED STATES             |   1998 | 2737749986.44253
 UNITED STATES             |   1997 | 4679161838.73183
 UNITED STATES             |   1996 |   4715556122.712
 UNITED STATES             |   1995 | 4684451492.14388
 UNITED STATES             |   1994 | 4717754181.63906
 UNITED STATES             |   1993 | 4698061841.47948
 UNITED STATES             |   1992 | 4709079544.37465
 VIETNAM                   |   1998 | 2730175089.75271
 VIETNAM                   |   1997 | 4675218052.40621
 VIETNAM                   |   1996 | 4694229961.81873
 VIETNAM                   |   1995 | 4677596383.94532
 VIETNAM                   |   1994 | 4692082688.80167
 VIETNAM                   |   1993 | 4670760114.97933
 VIETNAM                   |   1992 | 4702154615.37668
(175 rows)

COMMIT;
COMMIT
