BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%cyan%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2762903723.04343
 ALGERIA                   |   1997 | 4690080792.75796
 ALGERIA                   |   1996 | 4709051837.92525
 ALGERIA                   |   1995 | 4697258796.99498
 ALGERIA                   |   1994 | 4713284273.81429
 ALGERIA                   |   1993 | 4672424029.47526
 ALGERIA                   |   1992 | 4710375062.09018
 ARGENTINA                 |   1998 | 2717122986.71679
 ARGENTINA                 |   1997 | 4651047918.45256
 ARGENTINA                 |   1996 |  4651258631.3766
 ARGENTINA                 |   1995 | 4628910905.93898
 ARGENTINA                 |   1994 | 4633762121.57397
 ARGENTINA                 |   1993 |  4633036638.4115
 ARGENTINA                 |   1992 | 4671996662.53826
 BRAZIL                    |   1998 | 2735504957.24521
 BRAZIL                    |   1997 | 4680667659.39064
 BRAZIL                    |   1996 | 4685460804.56679
 BRAZIL                    |   1995 | 4694860126.08073
 BRAZIL                    |   1994 | 4650714811.30082
 BRAZIL                    |   1993 | 4677129698.54571
 BRAZIL                    |   1992 | 4711808303.34898
 CANADA                    |   1998 | 2717844257.88989
 CANADA                    |   1997 | 4726604180.20362
 CANADA                    |   1996 | 4686385711.59853
 CANADA                    |   1995 |  4676918871.9127
 CANADA                    |   1994 | 4666880480.70131
 CANADA                    |   1993 | 4672585326.29954
 CANADA                    |   1992 | 4678251144.06118
 CHINA                     |   1998 | 2753623422.14129
 CHINA                     |   1997 | 4673431564.70649
 CHINA                     |   1996 |  4720867944.5358
 CHINA                     |   1995 | 4670951941.97516
 CHINA                     |   1994 | 4675125766.55234
 CHINA                     |   1993 | 4684302536.17706
 CHINA                     |   1992 | 4692105835.27796
 EGYPT                     |   1998 | 2729111078.43233
 EGYPT                     |   1997 | 4679844899.83548
 EGYPT                     |   1996 |  4701448084.7318
 EGYPT                     |   1995 | 4674170236.21091
 EGYPT                     |   1994 | 4684790958.94729
 EGYPT                     |   1993 | 4687345832.61828
 EGYPT                     |   1992 | 4685751171.62973
 ETHIOPIA                  |   1998 | 2749212091.09855
 ETHIOPIA                  |   1997 | 4720723507.94631
 ETHIOPIA                  |   1996 | 4691876284.62827
 ETHIOPIA                  |   1995 | 4702387586.31753
 ETHIOPIA                  |   1994 | 4715120563.26596
 ETHIOPIA                  |   1993 | 4693857642.77993
 ETHIOPIA                  |   1992 | 4732484184.68046
 FRANCE                    |   1998 | 2744052411.19952
 FRANCE                    |   1997 | 4695506424.58348
 FRANCE                    |   1996 | 4711340199.17825
 FRANCE                    |   1995 | 4689928833.67948
 FRANCE                    |   1994 | 4680115932.17499
 FRANCE                    |   1993 | 4683686361.69417
 FRANCE                    |   1992 | 4698676720.72441
 GERMANY                   |   1998 | 2766027122.09102
 GERMANY                   |   1997 | 4703289226.07763
 GERMANY                   |   1996 | 4709417956.80381
 GERMANY                   |   1995 | 4682597862.95268
 GERMANY                   |   1994 |  4691486079.5319
 GERMANY                   |   1993 | 4691338162.87726
 GERMANY                   |   1992 | 4702029211.21027
 INDIA                     |   1998 | 2765679213.82752
 INDIA                     |   1997 | 4711720719.15854
 INDIA                     |   1996 | 4726497486.44095
 INDIA                     |   1995 | 4725516757.50275
 INDIA                     |   1994 | 4709154444.18324
 INDIA                     |   1993 | 4699590790.93419
 INDIA                     |   1992 | 4730252399.22912
 INDONESIA                 |   1998 | 2745268326.22887
 INDONESIA                 |   1997 | 4629112828.86415
 INDONESIA                 |   1996 |  4626478381.9764
 INDONESIA                 |   1995 | 4615207180.22488
 INDONESIA                 |   1994 | 4608774608.68031
 INDONESIA                 |   1993 | 4618107275.04481
 INDONESIA                 |   1992 | 4608531026.97856
 IRAN                      |   1998 | 2729535340.71878
 IRAN                      |   1997 | 4648540793.84477
 IRAN                      |   1996 | 4648931810.42647
 IRAN                      |   1995 | 4632430891.56796
 IRAN                      |   1994 |   4647428251.923
 IRAN                      |   1993 | 4650887803.91513
 IRAN                      |   1992 | 4641994368.39701
 IRAQ                      |   1998 | 2729116774.34571
 IRAQ                      |   1997 | 4654635440.11981
 IRAQ                      |   1996 | 4676907923.81872
 IRAQ                      |   1995 | 4668686574.79493
 IRAQ                      |   1994 | 4645837839.35508
 IRAQ                      |   1993 | 4649276085.88408
 IRAQ                      |   1992 | 4670390033.16067
 JAPAN                     |   1998 | 2695102178.24313
 JAPAN                     |   1997 | 4639030532.17964
 JAPAN                     |   1996 | 4658151670.13866
 JAPAN                     |   1995 | 4640623569.34064
 JAPAN                     |   1994 | 4628264798.08615
 JAPAN                     |   1993 | 4605276867.39685
 JAPAN                     |   1992 | 4645511069.93836
 JORDAN                    |   1998 | 2735181965.08485
 JORDAN                    |   1997 | 4657346488.83969
 JORDAN                    |   1996 | 4693947399.11656
 JORDAN                    |   1995 |  4670456754.6488
 JORDAN                    |   1994 | 4659009706.62291
 JORDAN                    |   1993 | 4677180550.92784
 JORDAN                    |   1992 | 4678220230.82954
 KENYA                     |   1998 | 2719806966.44492
 KENYA                     |   1997 | 4613952160.60848
 KENYA                     |   1996 | 4642469175.91042
 KENYA                     |   1995 | 4639322774.27637
 KENYA                     |   1994 | 4638243713.68066
 KENYA                     |   1993 | 4635875440.27892
 KENYA                     |   1992 | 4649692037.23577
 MOROCCO                   |   1998 | 2729501891.13706
 MOROCCO                   |   1997 |   4659559684.814
 MOROCCO                   |   1996 | 4687738082.67762
 MOROCCO                   |   1995 | 4675983089.84388
 MOROCCO                   |   1994 | 4690823957.86895
 MOROCCO                   |   1993 |  4665274850.6572
 MOROCCO                   |   1992 | 4719232387.98751
 MOZAMBIQUE                |   1998 | 2724514575.63012
 MOZAMBIQUE                |   1997 |  4668468403.5312
 MOZAMBIQUE                |   1996 | 4687432347.20613
 MOZAMBIQUE                |   1995 | 4656693220.08774
 MOZAMBIQUE                |   1994 | 4648495794.92094
 MOZAMBIQUE                |   1993 | 4654867734.34336
 MOZAMBIQUE                |   1992 | 4654570013.75562
 PERU                      |   1998 | 2718209135.37261
 PERU                      |   1997 | 4622070331.20781
 PERU                      |   1996 | 4623172664.21759
 PERU                      |   1995 | 4618133955.46201
 PERU                      |   1994 | 4626156538.50984
 PERU                      |   1993 | 4630197922.02763
 PERU                      |   1992 | 4609207613.63497
 ROMANIA                   |   1998 | 2726471306.47092
 ROMANIA                   |   1997 | 4670802242.66696
 ROMANIA                   |   1996 | 4689690732.50441
 ROMANIA                   |   1995 | 4678041559.30343
 ROMANIA                   |   1994 | 4687338624.21409
 ROMANIA                   |   1993 | 4684750685.76733
 ROMANIA                   |   1992 | 4677728762.59111
 RUSSIA                    |   1998 | 2729454883.48845
 RUSSIA                    |   1997 | 4658063694.14658
 RUSSIA                    |   1996 | 4685862690.81861
 RUSSIA                    |   1995 | 4629945364.70431
 RUSSIA                    |   1994 | 4648427129.46453
 RUSSIA                    |   1993 | 4648590471.59944
 RUSSIA                    |   1992 | 4663515452.57281
 SAUDI ARABIA              |   1998 | 2744136607.38731
 SAUDI ARABIA              |   1997 | 4703506347.35897
 SAUDI ARABIA              |   1996 | 4720283337.17372
 SAUDI ARABIA              |   1995 | 4683895747.35905
 SAUDI ARABIA              |   1994 |  4699131354.6151
 SAUDI ARABIA              |   1993 | 4685009752.39806
 SAUDI ARABIA              |   1992 | 4689137796.58782
 UNITED KINGDOM            |   1998 | 2757782344.37937
 UNITED KINGDOM            |   1997 | 4693599430.32296
 UNITED KINGDOM            |   1996 | 4704624645.27043
 UNITED KINGDOM            |   1995 | 4670976420.36002
 UNITED KINGDOM            |   1994 | 4706673711.95376
 UNITED KINGDOM            |   1993 | 4667908487.53002
 UNITED KINGDOM            |   1992 |  4711216790.4151
 UNITED STATES             |   1998 | 2738425095.65854
 UNITED STATES             |   1997 |  4682723777.6933
 UNITED STATES             |   1996 | 4679481711.03192
 UNITED STATES             |   1995 | 4649793963.16028
 UNITED STATES             |   1994 | 4687984700.99168
 UNITED STATES             |   1993 | 4680501083.00731
 UNITED STATES             |   1992 | 4674982130.64802
 VIETNAM                   |   1998 | 2755449451.60832
 VIETNAM                   |   1997 | 4668095023.78584
 VIETNAM                   |   1996 | 4701491478.57918
 VIETNAM                   |   1995 | 4694712895.49367
 VIETNAM                   |   1994 |  4689835428.5018
 VIETNAM                   |   1993 | 4698211352.37599
 VIETNAM                   |   1992 | 4702004432.32378
(175 rows)

COMMIT;
COMMIT
