BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%brown%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2722159523.13953
 ALGERIA                   |   1997 | 4642314563.64169
 ALGERIA                   |   1996 | 4655174645.08684
 ALGERIA                   |   1995 | 4627648973.62425
 ALGERIA                   |   1994 | 4640277788.74135
 ALGERIA                   |   1993 | 4648030839.98267
 ALGERIA                   |   1992 | 4635684032.72378
 ARGENTINA                 |   1998 | 2704969494.55296
 ARGENTINA                 |   1997 | 4671242563.55793
 ARGENTINA                 |   1996 | 4671165433.67282
 ARGENTINA                 |   1995 | 4639163318.13606
 ARGENTINA                 |   1994 | 4663934328.97009
 ARGENTINA                 |   1993 | 4649198714.89586
 ARGENTINA                 |   1992 |  4668858912.6509
 BRAZIL                    |   1998 | 2729163332.98374
 BRAZIL                    |   1997 | 4653202900.42101
 BRAZIL                    |   1996 | 4660146086.21564
 BRAZIL                    |   1995 | 4650764651.23977
 BRAZIL                    |   1994 | 4636170574.37428
 BRAZIL                    |   1993 | 4673128388.03426
 BRAZIL                    |   1992 | 4673437933.42357
 CANADA                    |   1998 | 2730814358.17865
 CANADA                    |   1997 | 4672096125.75154
 CANADA                    |   1996 | 4687329436.18558
 CANADA                    |   1995 | 4678525798.41231
 CANADA                    |   1994 | 4672944486.19765
 CANADA                    |   1993 | 4635959280.78625
 CANADA                    |   1992 | 4687374685.30642
 CHINA                     |   1998 | 2738376237.85699
 CHINA                     |   1997 | 4670428330.89099
 CHINA                     |   1996 | 4673677286.43005
 CHINA                     |   1995 | 4687943995.75576
 CHINA                     |   1994 | 4700739212.92244
 CHINA                     |   1993 | 4665398041.24677
 CHINA                     |   1992 | 4680346750.72023
 EGYPT                     |   1998 | 2709751263.24753
 EGYPT                     |   1997 | 4637810039.51557
 EGYPT                     |   1996 | 4629316475.39379
 EGYPT                     |   1995 | 4662332837.26478
 EGYPT                     |   1994 |  4631464979.4284
 EGYPT                     |   1993 | 4626455780.09872
 EGYPT                     |   1992 | 4639796498.86987
 ETHIOPIA                  |   1998 | 2734110453.75927
 ETHIOPIA                  |   1997 | 4685282394.80355
 ETHIOPIA                  |   1996 | 4675103486.22818
 ETHIOPIA                  |   1995 | 4701626820.24244
 ETHIOPIA                  |   1994 | 4699677721.48689
 ETHIOPIA                  |   1993 | 4677494210.28472
 ETHIOPIA                  |   1992 | 4695884119.21978
 FRANCE                    |   1998 | 2746156945.24387
 FRANCE                    |   1997 | 4692543544.76639
 FRANCE                    |   1996 | 4673826136.21845
 FRANCE                    |   1995 | 4685379847.51083
 FRANCE                    |   1994 | 4664206179.40556
 FRANCE                    |   1993 | 4686994783.36526
 FRANCE                    |   1992 | 4654461526.52006
 GERMANY                   |   1998 | 2737195174.98752
 GERMANY                   |   1997 | 4682455145.94898
 GERMANY                   |   1996 | 4667894778.72372
 GERMANY                   |   1995 | 4663428404.04835
 GERMANY                   |   1994 | 4664934675.08844
 GERMANY                   |   1993 |  4688665278.6488
 GERMANY                   |   1992 | 4698551770.99351
 INDIA                     |   1998 | 2713492227.36474
 INDIA                     |   1997 | 4667525944.86303
 INDIA                     |   1996 | 4682527658.96732
 INDIA                     |   1995 | 4665747422.04598
 INDIA                     |   1994 | 4646282634.12204
 INDIA                     |   1993 | 4659055075.18845
 INDIA                     |   1992 | 4669734546.07247
 INDONESIA                 |   1998 | 2718750196.65845
 INDONESIA                 |   1997 | 4643037277.15278
 INDONESIA                 |   1996 | 4663212758.98043
 INDONESIA                 |   1995 |   4649768505.592
 INDONESIA                 |   1994 | 4641788325.86429
 INDONESIA                 |   1993 | 4638828956.78124
 INDONESIA                 |   1992 |  4640307436.5456
 IRAN                      |   1998 | 2725748031.59843
 IRAN                      |   1997 |  4630534586.5686
 IRAN                      |   1996 |  4639872858.3081
 IRAN                      |   1995 | 4613304977.18339
 IRAN                      |   1994 | 4640222451.79682
 IRAN                      |   1993 | 4622622790.35308
 IRAN                      |   1992 | 4639218974.63641
 IRAQ                      |   1998 | 2737563252.55417
 IRAQ                      |   1997 | 4668208992.96698
 IRAQ                      |   1996 | 4672390900.46646
 IRAQ                      |   1995 | 4654040432.80776
 IRAQ                      |   1994 | 4692313940.43374
 IRAQ                      |   1993 | 4653623441.23667
 IRAQ                      |   1992 | 4693679411.40149
 JAPAN                     |   1998 | 2725983966.32537
 JAPAN                     |   1997 | 4645827546.12695
 JAPAN                     |   1996 | 4672955535.94188
 JAPAN                     |   1995 | 4644590205.81383
 JAPAN                     |   1994 | 4656172607.85966
 JAPAN                     |   1993 | 4645804809.20741
 JAPAN                     |   1992 | 4663591415.84753
 JORDAN                    |   1998 | 2726866605.89145
 JORDAN                    |   1997 | 4654214431.34195
 JORDAN                    |   1996 | 4675119521.45903
 JORDAN                    |   1995 | 4633232467.16178
 JORDAN                    |   1994 |  4647554054.8876
 JORDAN                    |   1993 | 4645822826.85473
 JORDAN                    |   1992 | 4671761434.66332
 KENYA                     |   1998 | 2724993192.80483
 KENYA                     |   1997 | 4620272348.02975
 KENYA                     |   1996 | 4632717670.08466
 KENYA                     |   1995 | 4634517764.08575
 KENYA                     |   1994 | 4632273624.14053
 KENYA                     |   1993 | 4597659770.50344
 KENYA                     |   1992 | 4605707163.11504
 MOROCCO                   |   1998 | 2732275535.00322
 MOROCCO                   |   1997 | 4691054260.33475
 MOROCCO                   |   1996 | 4689544656.48299
 MOROCCO                   |   1995 | 4673491674.70632
 MOROCCO                   |   1994 | 4710894360.67614
 MOROCCO                   |   1993 |  4674964393.0042
 MOROCCO                   |   1992 | 4682057974.17859
 MOZAMBIQUE                |   1998 | 2744395136.69919
 MOZAMBIQUE                |   1997 | 4646182436.11001
 MOZAMBIQUE                |   1996 | 4683517637.32357
 MOZAMBIQUE                |   1995 |  4672841669.4067
 MOZAMBIQUE                |   1994 | 4634614927.15917
 MOZAMBIQUE                |   1993 | 4645434521.86921
 MOZAMBIQUE                |   1992 | 4676846750.09893
 PERU                      |   1998 | 2702500470.63791
 PERU                      |   1997 | 4620903459.11431
 PERU                      |   1996 | 4668237732.04711
 PERU                      |   1995 | 4642396434.89474
 PERU                      |   1994 | 4605175710.66175
 PERU                      |   1993 | 4631953193.04357
 PERU                      |   1992 | 4638253620.13711
 ROMANIA                   |   1998 |  2766143958.0317
 ROMANIA                   |   1997 | 4675917502.76616
 ROMANIA                   |   1996 | 4694897759.40986
 ROMANIA                   |   1995 | 4665996440.57074
 ROMANIA                   |   1994 | 4684167540.91757
 ROMANIA                   |   1993 | 4689935339.86678
 ROMANIA                   |   1992 | 4691111531.02875
 RUSSIA                    |   1998 | 2722909342.55509
 RUSSIA                    |   1997 | 4665770312.50899
 RUSSIA                    |   1996 | 4670573689.11752
 RUSSIA                    |   1995 | 4653781857.39006
 RUSSIA                    |   1994 | 4642242966.16117
 RUSSIA                    |   1993 | 4643335610.71976
 RUSSIA                    |   1992 | 4659257287.52738
 SAUDI ARABIA              |   1998 | 2760004244.63395
 SAUDI ARABIA              |   1997 | 4671876213.17369
 SAUDI ARABIA              |   1996 | 4685766686.76893
 SAUDI ARABIA              |   1995 | 4664047779.78206
 SAUDI ARABIA              |   1994 | 4658480643.36604
 SAUDI ARABIA              |   1993 | 4686054675.72752
 SAUDI ARABIA              |   1992 | 4669225165.07892
 UNITED KINGDOM            |   1998 | 2772948174.85296
 UNITED KINGDOM            |   1997 | 4743791153.30766
 UNITED KINGDOM            |   1996 | 4744095918.01849
 UNITED KINGDOM            |   1995 | 4710955409.89533
 UNITED KINGDOM            |   1994 | 4716656685.32365
 UNITED KINGDOM            |   1993 | 4714053106.23485
 UNITED KINGDOM            |   1992 | 4722669436.25614
 UNITED STATES             |   1998 | 2743153566.25072
 UNITED STATES             |   1997 |  4685900188.6095
 UNITED STATES             |   1996 | 4729745096.87876
 UNITED STATES             |   1995 | 4670030048.95183
 UNITED STATES             |   1994 | 4687862385.98325
 UNITED STATES             |   1993 | 4695318859.09217
 UNITED STATES             |   1992 | 4683276692.90929
 VIETNAM                   |   1998 |  2749315468.7602
 VIETNAM                   |   1997 | 4677673245.70741
 VIETNAM                   |   1996 | 4689703910.69224
 VIETNAM                   |   1995 | 4687907858.13074
 VIETNAM                   |   1994 | 4677202123.49447
 VIETNAM                   |   1993 | 4653571637.46291
 VIETNAM                   |   1992 | 4706999463.46845
(175 rows)

COMMIT;
COMMIT
