BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%blue%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2757148763.66208
 ALGERIA                   |   1997 | 4707844492.60483
 ALGERIA                   |   1996 | 4699847546.34944
 ALGERIA                   |   1995 | 4709730144.75345
 ALGERIA                   |   1994 | 4698813966.49168
 ALGERIA                   |   1993 | 4677775247.40546
 ALGERIA                   |   1992 | 4692933290.82039
 ARGENTINA                 |   1998 | 2690058308.63439
 ARGENTINA                 |   1997 | 4607015753.01591
 ARGENTINA                 |   1996 | 4658332795.99259
 ARGENTINA                 |   1995 | 4608040442.36068
 ARGENTINA                 |   1994 | 4612644459.59424
 ARGENTINA                 |   1993 | 4622945806.24934
 ARGENTINA                 |   1992 | 4628482765.33299
 BRAZIL                    |   1998 | 2726382650.97614
 BRAZIL                    |   1997 | 4678278383.73705
 BRAZIL                    |   1996 | 4717192728.39423
 BRAZIL                    |   1995 | 4680568985.29116
 BRAZIL                    |   1994 | 4679096338.22213
 BRAZIL                    |   1993 | 4688909806.55261
 BRAZIL                    |   1992 | 4687904163.04892
 CANADA                    |   1998 | 2739639365.87872
 CANADA                    |   1997 |  4693383864.3018
 CANADA                    |   1996 |  4691299943.6115
 CANADA                    |   1995 | 4670196415.61668
 CANADA                    |   1994 | 4684295774.00472
 CANADA                    |   1993 | 4680061585.01326
 CANADA                    |   1992 |   4685674465.977
 CHINA                     |   1998 | 2736145374.48157
 CHINA                     |   1997 | 4656081105.83784
 CHINA                     |   1996 | 4707905676.64252
 CHINA                     |   1995 | 4672154854.70646
 CHINA                     |   1994 | 4681014986.23506
 CHINA                     |   1993 | 4666190822.37697
 CHINA                     |   1992 | 4695234333.41546
 EGYPT                     |   1998 | 2737663556.06301
 EGYPT                     |   1997 | 4667873911.93791
 EGYPT                     |   1996 | 4679229670.63193
 EGYPT                     |   1995 | 4685012478.01139
 EGYPT                     |   1994 | 4657058333.17094
 EGYPT                     |   1993 | 4677397796.57367
 EGYPT                     |   1992 | 4661002213.60786
 ETHIOPIA                  |   1998 | 2762473585.23501
 ETHIOPIA                  |   1997 | 4724111340.48526
 ETHIOPIA                  |   1996 | 4725726263.34323
 ETHIOPIA                  |   1995 | 4757500797.62985
 ETHIOPIA                  |   1994 | 4703551467.97377
 ETHIOPIA                  |   1993 | 4728012775.80197
 ETHIOPIA                  |   1992 |  4707119233.9308
 FRANCE                    |   1998 | 2759467607.25873
 FRANCE                    |   1997 | 4681454517.85248
 FRANCE                    |   1996 |  4666228355.7224
 FRANCE                    |   1995 | 4670071437.17079
 FRANCE                    |   1994 | 4689028570.39982
 FRANCE                    |   1993 |  4675742232.3566
 FRANCE                    |   1992 |  4663320131.6669
 GERMANY                   |   1998 | 2742665956.98917
 GERMANY                   |   1997 | 4672638429.28983
 GERMANY                   |   1996 | 4668646133.01508
 GERMANY                   |   1995 |   4665350121.218
 GERMANY                   |   1994 | 4701688060.63014
 GERMANY                   |   1993 | 4648221527.79905
 GERMANY                   |   1992 | 4686528278.44672
 INDIA                     |   1998 | 2754567627.08667
 INDIA                     |   1997 | 4677220410.23424
 INDIA                     |   1996 | 4677220442.46327
 INDIA                     |   1995 | 4685186137.92963
 INDIA                     |   1994 | 4670995040.43713
 INDIA                     |   1993 | 4683107194.78642
 INDIA                     |   1992 | 4689829233.52419
 INDONESIA                 |   1998 | 2727197119.04924
 INDONESIA                 |   1997 | 4653011879.61661
 INDONESIA                 |   1996 | 4648312091.04907
 INDONESIA                 |   1995 | 4648343508.85121
 INDONESIA                 |   1994 | 4657615734.22993
 INDONESIA                 |   1993 | 4635229856.98402
 INDONESIA                 |   1992 | 4650167959.70002
 IRAN                      |   1998 | 2721033015.59986
 IRAN                      |   1997 | 4660095509.80346
 IRAN                      |   1996 | 4658968836.15509
 IRAN                      |   1995 | 4641135650.46617
 IRAN                      |   1994 | 4643114983.88895
 IRAN                      |   1993 | 4643854423.75618
 IRAN                      |   1992 | 4659309264.68041
 IRAQ                      |   1998 | 2753571350.44771
 IRAQ                      |   1997 | 4684689264.52684
 IRAQ                      |   1996 | 4664966317.21735
 IRAQ                      |   1995 | 4665185909.02119
 IRAQ                      |   1994 | 4687850360.82098
 IRAQ                      |   1993 | 4661615817.28337
 IRAQ                      |   1992 | 4692999573.08729
 JAPAN                     |   1998 | 2726293427.99755
 JAPAN                     |   1997 | 4638686720.33674
 JAPAN                     |   1996 | 4637261759.84326
 JAPAN                     |   1995 | 4635606001.02385
 JAPAN                     |   1994 | 4660182689.79035
 JAPAN                     |   1993 | 4629524537.26695
 JAPAN                     |   1992 | 4633082669.73593
 JORDAN                    |   1998 | 2727699852.52646
 JORDAN                    |   1997 | 4668689580.65822
 JORDAN                    |   1996 | 4675942015.16914
 JORDAN                    |   1995 |  4668266184.9803
 JORDAN                    |   1994 | 4664340921.69403
 JORDAN                    |   1993 | 4665526581.11287
 JORDAN                    |   1992 | 4684906643.25985
 KENYA                     |   1998 | 2714325942.90928
 KENYA                     |   1997 | 4646702272.17711
 KENYA                     |   1996 | 4650253619.34215
 KENYA                     |   1995 | 4650193558.67847
 KENYA                     |   1994 | 4636364211.88851
 KENYA                     |   1993 | 4606384094.44075
 KENYA                     |   1992 | 4644735522.22637
 MOROCCO                   |   1998 | 2735401367.20385
 MOROCCO                   |   1997 | 4692949520.99523
 MOROCCO                   |   1996 | 4682999075.44554
 MOROCCO                   |   1995 | 4674716799.17214
 MOROCCO                   |   1994 | 4678636225.06871
 MOROCCO                   |   1993 | 4670318290.73521
 MOROCCO                   |   1992 | 4685744844.51289
 MOZAMBIQUE                |   1998 | 2737290954.33601
 MOZAMBIQUE                |   1997 | 4654031642.35321
 MOZAMBIQUE                |   1996 |  4663297482.9674
 MOZAMBIQUE                |   1995 | 4645146036.74243
 MOZAMBIQUE                |   1994 | 4645520220.01362
 MOZAMBIQUE                |   1993 | 4657724450.14851
 MOZAMBIQUE                |   1992 | 4652582144.52543
 PERU                      |   1998 | 2727159530.35472
 PERU                      |   1997 | 4632134634.74989
 PERU                      |   1996 | 4643603936.30952
 PERU                      |   1995 | 4627430906.37477
 PERU                      |   1994 | 4645278958.00084
 PERU                      |   1993 | 4630155363.04506
 PERU                      |   1992 | 4636424998.17517
 ROMANIA                   |   1998 | 2758408001.84588
 ROMANIA                   |   1997 | 4684909667.56946
 ROMANIA                   |   1996 | 4668048172.49387
 ROMANIA                   |   1995 | 4669938591.32911
 ROMANIA                   |   1994 | 4681728970.76768
 ROMANIA                   |   1993 | 4673621222.20395
 ROMANIA                   |   1992 | 4673610446.80209
 RUSSIA                    |   1998 | 2732900266.61689
 RUSSIA                    |   1997 | 4669950476.28289
 RUSSIA                    |   1996 | 4689166399.48304
 RUSSIA                    |   1995 | 4659909381.86788
 RUSSIA                    |   1994 | 4663489149.53829
 RUSSIA                    |   1993 | 4644455720.94325
 RUSSIA                    |   1992 | 4681004008.34003
 SAUDI ARABIA              |   1998 | 2715327917.68372
 SAUDI ARABIA              |   1997 | 4635456941.25597
 SAUDI ARABIA              |   1996 | 4653485132.05903
 SAUDI ARABIA              |   1995 | 4646964035.30799
 SAUDI ARABIA              |   1994 | 4636933087.11415
 SAUDI ARABIA              |   1993 | 4648776227.17242
 SAUDI ARABIA              |   1992 | 4655995257.41101
 UNITED KINGDOM            |   1998 |  2741095984.9993
 UNITED KINGDOM            |   1997 | 4663327040.10979
 UNITED KINGDOM            |   1996 | 4695644565.69332
 UNITED KINGDOM            |   1995 | 4644741478.46356
 UNITED KINGDOM            |   1994 | 4668396559.60222
 UNITED KINGDOM            |   1993 | 4662526703.06637
 UNITED KINGDOM            |   1992 | 4674895611.76754
 UNITED STATES             |   1998 | 2744069300.44024
 UNITED STATES             |   1997 | 4674567632.42839
 UNITED STATES             |   1996 |  4684445273.7967
 UNITED STATES             |   1995 | 4657196501.55129
 UNITED STATES             |   1994 | 4673366568.82657
 UNITED STATES             |   1993 | 4680403318.76574
 UNITED STATES             |   1992 | 4687645704.82981
 VIETNAM                   |   1998 | 2748492961.89138
 VIETNAM                   |   1997 | 4687782570.26841
 VIETNAM                   |   1996 | 4693298101.97342
 VIETNAM                   |   1995 |  4702070314.3778
 VIETNAM                   |   1994 | 4688793680.71199
 VIETNAM                   |   1993 |   4694412083.084
 VIETNAM                   |   1992 | 4700735402.02657
(175 rows)

COMMIT;
COMMIT
