BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%grey%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2755493398.67331
 ALGERIA                   |   1997 | 4678164408.19569
 ALGERIA                   |   1996 | 4714885397.89539
 ALGERIA                   |   1995 | 4703484707.05832
 ALGERIA                   |   1994 | 4687060717.98883
 ALGERIA                   |   1993 | 4700535377.49346
 ALGERIA                   |   1992 | 4692265494.60131
 ARGENTINA                 |   1998 | 2713530668.27258
 ARGENTINA                 |   1997 |  4664195281.1666
 ARGENTINA                 |   1996 | 4659769626.73046
 ARGENTINA                 |   1995 | 4643105423.73843
 ARGENTINA                 |   1994 | 4656918349.34506
 ARGENTINA                 |   1993 | 4670817280.81815
 ARGENTINA                 |   1992 | 4657918788.81163
 BRAZIL                    |   1998 | 2741945947.41474
 BRAZIL                    |   1997 | 4666837983.97313
 BRAZIL                    |   1996 | 4703658636.47367
 BRAZIL                    |   1995 | 4668306614.06802
 BRAZIL                    |   1994 | 4683679923.50684
 BRAZIL                    |   1993 | 4702935202.89754
 BRAZIL                    |   1992 | 4696158701.22548
 CANADA                    |   1998 | 2747563481.26037
 CANADA                    |   1997 | 4701669402.03067
 CANADA                    |   1996 | 4694170698.78697
 CANADA                    |   1995 | 4722783421.52683
 CANADA                    |   1994 | 4701114647.15793
 CANADA                    |   1993 | 4671990596.46677
 CANADA                    |   1992 | 4697354790.45783
 CHINA                     |   1998 | 2737451061.97179
 CHINA                     |   1997 | 4668634545.62515
 CHINA                     |   1996 | 4707244995.03133
 CHINA                     |   1995 | 4694720345.15737
 CHINA                     |   1994 | 4675602293.44502
 CHINA                     |   1993 | 4666173124.16721
 CHINA                     |   1992 | 4680962719.82548
 EGYPT                     |   1998 | 2730773323.53458
 EGYPT                     |   1997 | 4688206153.08639
 EGYPT                     |   1996 | 4700646207.48421
 EGYPT                     |   1995 | 4708116088.54992
 EGYPT                     |   1994 |  4689906172.1257
 EGYPT                     |   1993 |  4688237100.3483
 EGYPT                     |   1992 | 4735661083.17232
 ETHIOPIA                  |   1998 | 2761285751.02568
 ETHIOPIA                  |   1997 | 4720931245.92612
 ETHIOPIA                  |   1996 | 4736544861.72233
 ETHIOPIA                  |   1995 | 4730760374.46909
 ETHIOPIA                  |   1994 | 4724373871.18395
 ETHIOPIA                  |   1993 | 4717260490.68335
 ETHIOPIA                  |   1992 | 4725760765.46942
 FRANCE                    |   1998 | 2755503600.20124
 FRANCE                    |   1997 | 4722359705.64262
 FRANCE                    |   1996 | 4713343112.36215
 FRANCE                    |   1995 |   4681601328.639
 FRANCE                    |   1994 | 4710592953.79851
 FRANCE                    |   1993 | 4687233743.09612
 FRANCE                    |   1992 | 4727302200.20377
 GERMANY                   |   1998 | 2756578330.94168
 GERMANY                   |   1997 | 4674104064.52789
 GERMANY                   |   1996 |  4703252491.0818
 GERMANY                   |   1995 | 4719214167.96037
 GERMANY                   |   1994 | 4698456127.22862
 GERMANY                   |   1993 | 4695099706.05207
 GERMANY                   |   1992 | 4708616608.96254
 INDIA                     |   1998 | 2710944071.12413
 INDIA                     |   1997 | 4678385266.67374
 INDIA                     |   1996 | 4674564265.11702
 INDIA                     |   1995 |  4648306469.8151
 INDIA                     |   1994 | 4655081779.96982
 INDIA                     |   1993 | 4668145387.90597
 INDIA                     |   1992 |  4647787244.9522
 INDONESIA                 |   1998 |  2720666801.4657
 INDONESIA                 |   1997 | 4674660908.30669
 INDONESIA                 |   1996 | 4670129061.36653
 INDONESIA                 |   1995 | 4636107817.65893
 INDONESIA                 |   1994 | 4644696350.51392
 INDONESIA                 |   1993 | 4621184838.73041
 INDONESIA                 |   1992 |  4643304031.1753
 IRAN                      |   1998 | 2721363020.20627
 IRAN                      |   1997 | 4650103507.82492
 IRAN                      |   1996 | 4659711713.16121
 IRAN                      |   1995 | 4666271187.22856
 IRAN                      |   1994 | 4658194937.73536
 IRAN                      |   1993 | 4633500994.11019
 IRAN                      |   1992 | 4649028661.99892
 IRAQ                      |   1998 | 2736395257.26309
 IRAQ                      |   1997 | 4652878323.18337
 IRAQ                      |   1996 | 4660782099.34821
 IRAQ                      |   1995 | 4662410723.18647
 IRAQ                      |   1994 | 4677665753.45878
 IRAQ                      |   1993 |  4660995530.7653
 IRAQ                      |   1992 |  4682931286.1297
 JAPAN                     |   1998 | 2706271134.13697
 JAPAN                     |   1997 | 4650779116.89122
 JAPAN                     |   1996 | 4640728515.02934
 JAPAN                     |   1995 | 4647437653.48009
 JAPAN                     |   1994 | 4647596281.77729
 JAPAN                     |   1993 | 4604250747.46552
 JAPAN                     |   1992 | 4652085529.02609
 JORDAN                    |   1998 | 2751825253.96289
 JORDAN                    |   1997 | 4665865487.92918
 JORDAN                    |   1996 | 4673546732.71972
 JORDAN                    |   1995 | 4662307487.68386
 JORDAN                    |   1994 |  4662443931.3171
 JORDAN                    |   1993 |  4646495901.2682
 JORDAN                    |   1992 | 4691712251.25227
 KENYA                     |   1998 | 2708022410.72302
 KENYA                     |   1997 | 4631193202.98552
 KENYA                     |   1996 |  4652034791.9821
 KENYA                     |   1995 | 4638043963.35351
 KENYA                     |   1994 | 4614935795.56566
 KENYA                     |   1993 |  4617163145.5591
 KENYA                     |   1992 | 4633328646.78183
 MOROCCO                   |   1998 | 2760989850.22493
 MOROCCO                   |   1997 | 4710170447.04713
 MOROCCO                   |   1996 | 4709847364.56244
 MOROCCO                   |   1995 | 4695706732.14513
 MOROCCO                   |   1994 | 4714983841.63976
 MOROCCO                   |   1993 | 4722178324.91211
 MOROCCO                   |   1992 | 4734700252.62131
 MOZAMBIQUE                |   1998 | 2737242356.42285
 MOZAMBIQUE                |   1997 | 4676584129.11947
 MOZAMBIQUE                |   1996 | 4700058401.08728
 MOZAMBIQUE                |   1995 | 4685345864.62258
 MOZAMBIQUE                |   1994 |  4678840633.8175
 MOZAMBIQUE                |   1993 | 4664776035.43782
 MOZAMBIQUE                |   1992 | 4694299424.11029
 PERU                      |   1998 | 2706364731.44834
 PERU                      |   1997 |  4643149337.5329
 PERU                      |   1996 | 4634063254.82522
 PERU                      |   1995 | 4627536003.83173
 PERU                      |   1994 | 4646455944.98767
 PERU                      |   1993 | 4635922927.79456
 PERU                      |   1992 | 4659238639.97307
 ROMANIA                   |   1998 | 2757618857.39885
 ROMANIA                   |   1997 | 4698721856.53172
 ROMANIA                   |   1996 | 4729643255.56364
 ROMANIA                   |   1995 |  4724975015.6637
 ROMANIA                   |   1994 | 4717563834.33507
 ROMANIA                   |   1993 | 4712805437.18209
 ROMANIA                   |   1992 | 4732767271.57814
 RUSSIA                    |   1998 | 2744875077.80375
 RUSSIA                    |   1997 | 4688900857.95208
 RUSSIA                    |   1996 | 4665149347.24838
 RUSSIA                    |   1995 | 4672321642.03865
 RUSSIA                    |   1994 | 4642682322.75877
 RUSSIA                    |   1993 | 4668761618.85442
 RUSSIA                    |   1992 | 4667435505.76879
 SAUDI ARABIA              |   1998 | 2752746679.14942
 SAUDI ARABIA              |   1997 | 4671770725.90675
 SAUDI ARABIA              |   1996 | 4689524248.31164
 SAUDI ARABIA              |   1995 | 4636099379.70098
 SAUDI ARABIA              |   1994 | 4679674204.15427
 SAUDI ARABIA              |   1993 | 4667551653.96969
 SAUDI ARABIA              |   1992 | 4691733699.92416
 UNITED KINGDOM            |   1998 | 2758971976.79625
 UNITED KINGDOM            |   1997 | 4701849170.23579
 UNITED KINGDOM            |   1996 | 4729020846.90196
 UNITED KINGDOM            |   1995 | 4711147328.41444
 UNITED KINGDOM            |   1994 | 4708702529.86039
 UNITED KINGDOM            |   1993 |  4713730485.0426
 UNITED KINGDOM            |   1992 | 4734655402.30938
 UNITED STATES             |   1998 | 2722836728.73138
 UNITED STATES             |   1997 | 4673251592.47373
 UNITED STATES             |   1996 | 4671537571.50715
 UNITED STATES             |   1995 | 4642863794.35194
 UNITED STATES             |   1994 | 4657858524.92434
 UNITED STATES             |   1993 | 4686225562.28254
 UNITED STATES             |   1992 | 4683808731.27154
 VIETNAM                   |   1998 | 2758285016.14139
 VIETNAM                   |   1997 | 4696229882.39325
 VIETNAM                   |   1996 | 4724019624.29951
 VIETNAM                   |   1995 | 4698252136.74209
 VIETNAM                   |   1994 | 4691942769.32154
 VIETNAM                   |   1993 | 4698118215.77898
 VIETNAM                   |   1992 | 4720897278.29977
(175 rows)

COMMIT;
COMMIT
