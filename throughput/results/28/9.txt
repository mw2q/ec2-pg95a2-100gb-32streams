BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%deep%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  2748924740.9422
 ALGERIA                   |   1997 | 4688200013.75748
 ALGERIA                   |   1996 | 4700565248.95193
 ALGERIA                   |   1995 | 4673507602.61212
 ALGERIA                   |   1994 | 4681996513.60571
 ALGERIA                   |   1993 | 4675868980.40691
 ALGERIA                   |   1992 | 4698440060.12691
 ARGENTINA                 |   1998 |   2727689031.108
 ARGENTINA                 |   1997 | 4629619562.56854
 ARGENTINA                 |   1996 | 4654088976.96474
 ARGENTINA                 |   1995 | 4625330103.15197
 ARGENTINA                 |   1994 | 4633282213.49263
 ARGENTINA                 |   1993 |  4651018096.1958
 ARGENTINA                 |   1992 | 4652828729.50871
 BRAZIL                    |   1998 |  2741410343.7687
 BRAZIL                    |   1997 | 4694454930.72761
 BRAZIL                    |   1996 | 4706114349.29228
 BRAZIL                    |   1995 | 4654505177.91828
 BRAZIL                    |   1994 | 4674081700.21419
 BRAZIL                    |   1993 | 4686124549.76518
 BRAZIL                    |   1992 | 4711744421.06152
 CANADA                    |   1998 | 2758750324.36239
 CANADA                    |   1997 | 4710963260.82091
 CANADA                    |   1996 | 4706765227.68893
 CANADA                    |   1995 | 4707402312.11418
 CANADA                    |   1994 | 4722105604.31069
 CANADA                    |   1993 | 4703615362.12062
 CANADA                    |   1992 | 4722027126.27091
 CHINA                     |   1998 | 2740903833.40073
 CHINA                     |   1997 |  4674100091.2372
 CHINA                     |   1996 | 4697280853.88543
 CHINA                     |   1995 | 4667721459.88796
 CHINA                     |   1994 | 4661157798.23986
 CHINA                     |   1993 | 4677381347.31255
 CHINA                     |   1992 | 4688449710.34674
 EGYPT                     |   1998 | 2757797164.96264
 EGYPT                     |   1997 | 4679319247.91546
 EGYPT                     |   1996 | 4701531833.83295
 EGYPT                     |   1995 | 4699764594.89947
 EGYPT                     |   1994 | 4686471402.62284
 EGYPT                     |   1993 | 4708438020.57405
 EGYPT                     |   1992 | 4708457099.21748
 ETHIOPIA                  |   1998 | 2763047984.97122
 ETHIOPIA                  |   1997 | 4695462063.54174
 ETHIOPIA                  |   1996 | 4695858702.79988
 ETHIOPIA                  |   1995 | 4705020167.04899
 ETHIOPIA                  |   1994 | 4710583663.96786
 ETHIOPIA                  |   1993 | 4710794948.97665
 ETHIOPIA                  |   1992 | 4725871558.82135
 FRANCE                    |   1998 | 2736371814.84138
 FRANCE                    |   1997 | 4682200199.19339
 FRANCE                    |   1996 | 4674860685.67768
 FRANCE                    |   1995 | 4666039345.10919
 FRANCE                    |   1994 |  4673842463.3215
 FRANCE                    |   1993 |  4672128128.6276
 FRANCE                    |   1992 | 4668238053.48036
 GERMANY                   |   1998 |  2744476492.7753
 GERMANY                   |   1997 | 4683183010.44129
 GERMANY                   |   1996 | 4668430455.78765
 GERMANY                   |   1995 | 4651730344.73552
 GERMANY                   |   1994 |  4667949735.7226
 GERMANY                   |   1993 | 4675807533.26462
 GERMANY                   |   1992 |  4673019075.1068
 INDIA                     |   1998 | 2742513377.31747
 INDIA                     |   1997 |  4652813731.7801
 INDIA                     |   1996 | 4681253690.55721
 INDIA                     |   1995 |  4675037708.2125
 INDIA                     |   1994 | 4663453831.87627
 INDIA                     |   1993 | 4672939610.47659
 INDIA                     |   1992 | 4672100489.43522
 INDONESIA                 |   1998 | 2713160889.26456
 INDONESIA                 |   1997 | 4645959165.60157
 INDONESIA                 |   1996 | 4645404265.16008
 INDONESIA                 |   1995 | 4643970953.90844
 INDONESIA                 |   1994 | 4640484427.63059
 INDONESIA                 |   1993 |  4624953958.7463
 INDONESIA                 |   1992 |  4634579859.4915
 IRAN                      |   1998 | 2713036148.19315
 IRAN                      |   1997 | 4625302180.39889
 IRAN                      |   1996 | 4647259404.91117
 IRAN                      |   1995 | 4627785667.17798
 IRAN                      |   1994 | 4639626420.18425
 IRAN                      |   1993 | 4615811107.85058
 IRAN                      |   1992 | 4647161769.79484
 IRAQ                      |   1998 | 2717472484.02412
 IRAQ                      |   1997 | 4642207132.63777
 IRAQ                      |   1996 | 4624460634.69505
 IRAQ                      |   1995 | 4627484689.93925
 IRAQ                      |   1994 | 4633593262.77453
 IRAQ                      |   1993 | 4616528681.38299
 IRAQ                      |   1992 | 4674070022.25866
 JAPAN                     |   1998 | 2723524862.40372
 JAPAN                     |   1997 | 4623097677.50096
 JAPAN                     |   1996 | 4643445602.51581
 JAPAN                     |   1995 | 4637292277.55158
 JAPAN                     |   1994 | 4659097786.10436
 JAPAN                     |   1993 | 4625446449.44734
 JAPAN                     |   1992 | 4633807423.87826
 JORDAN                    |   1998 | 2714873947.76747
 JORDAN                    |   1997 | 4635510322.48136
 JORDAN                    |   1996 | 4700738764.50533
 JORDAN                    |   1995 | 4636889710.25464
 JORDAN                    |   1994 | 4651292777.16939
 JORDAN                    |   1993 | 4669986959.80751
 JORDAN                    |   1992 | 4666637317.94903
 KENYA                     |   1998 | 2725090225.39747
 KENYA                     |   1997 | 4635279074.72348
 KENYA                     |   1996 | 4689350221.18549
 KENYA                     |   1995 |  4651805378.2972
 KENYA                     |   1994 | 4662100016.30009
 KENYA                     |   1993 | 4674961996.69486
 KENYA                     |   1992 | 4651986345.59124
 MOROCCO                   |   1998 | 2744133580.41884
 MOROCCO                   |   1997 | 4690240850.03745
 MOROCCO                   |   1996 | 4717513303.94055
 MOROCCO                   |   1995 | 4694398848.40308
 MOROCCO                   |   1994 | 4681144570.38031
 MOROCCO                   |   1993 | 4674080148.90916
 MOROCCO                   |   1992 | 4687124178.86918
 MOZAMBIQUE                |   1998 | 2726508544.33099
 MOZAMBIQUE                |   1997 | 4651393872.85381
 MOZAMBIQUE                |   1996 | 4666077638.10065
 MOZAMBIQUE                |   1995 | 4662494456.57704
 MOZAMBIQUE                |   1994 | 4626009724.65372
 MOZAMBIQUE                |   1993 | 4662206266.30268
 MOZAMBIQUE                |   1992 | 4656133273.61773
 PERU                      |   1998 |  2710913605.3001
 PERU                      |   1997 | 4621620063.92031
 PERU                      |   1996 |  4620297070.2124
 PERU                      |   1995 | 4614953943.52557
 PERU                      |   1994 | 4632077057.59009
 PERU                      |   1993 | 4620549274.02277
 PERU                      |   1992 | 4650152655.24814
 ROMANIA                   |   1998 | 2750449482.97539
 ROMANIA                   |   1997 | 4676529674.02632
 ROMANIA                   |   1996 | 4683671479.43649
 ROMANIA                   |   1995 |  4663940551.1825
 ROMANIA                   |   1994 | 4662807328.73762
 ROMANIA                   |   1993 | 4679803745.50787
 ROMANIA                   |   1992 | 4678337217.86871
 RUSSIA                    |   1998 | 2740326728.45076
 RUSSIA                    |   1997 | 4678350680.64475
 RUSSIA                    |   1996 | 4654146291.43031
 RUSSIA                    |   1995 | 4634333517.90454
 RUSSIA                    |   1994 | 4654525642.38465
 RUSSIA                    |   1993 | 4675085324.50434
 RUSSIA                    |   1992 | 4652035519.31385
 SAUDI ARABIA              |   1998 |  2711892594.2841
 SAUDI ARABIA              |   1997 | 4621332254.75834
 SAUDI ARABIA              |   1996 | 4657932135.40184
 SAUDI ARABIA              |   1995 | 4656998092.97906
 SAUDI ARABIA              |   1994 | 4672821055.30858
 SAUDI ARABIA              |   1993 |  4652935690.3223
 SAUDI ARABIA              |   1992 | 4662148894.69601
 UNITED KINGDOM            |   1998 | 2758720343.13241
 UNITED KINGDOM            |   1997 | 4686613147.43542
 UNITED KINGDOM            |   1996 | 4706309594.70207
 UNITED KINGDOM            |   1995 | 4717027342.26047
 UNITED KINGDOM            |   1994 | 4702145302.64342
 UNITED KINGDOM            |   1993 | 4691695092.45946
 UNITED KINGDOM            |   1992 | 4709130468.31358
 UNITED STATES             |   1998 | 2743380907.96348
 UNITED STATES             |   1997 |  4728130213.5726
 UNITED STATES             |   1996 | 4718070380.25723
 UNITED STATES             |   1995 | 4665316168.46758
 UNITED STATES             |   1994 | 4725094538.35297
 UNITED STATES             |   1993 | 4716859595.51986
 UNITED STATES             |   1992 | 4709615392.29833
 VIETNAM                   |   1998 | 2742926103.36567
 VIETNAM                   |   1997 |   4679390390.667
 VIETNAM                   |   1996 | 4711305209.11162
 VIETNAM                   |   1995 | 4700546675.89661
 VIETNAM                   |   1994 | 4678859915.60724
 VIETNAM                   |   1993 | 4708283409.02551
 VIETNAM                   |   1992 | 4724584853.21934
(175 rows)

COMMIT;
COMMIT
