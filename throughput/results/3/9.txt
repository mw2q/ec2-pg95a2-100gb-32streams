BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%smoke%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2715012025.55238
 ALGERIA                   |   1997 | 4623162739.16971
 ALGERIA                   |   1996 | 4653308799.37963
 ALGERIA                   |   1995 | 4653831038.91421
 ALGERIA                   |   1994 | 4624441325.81281
 ALGERIA                   |   1993 | 4665193049.99662
 ALGERIA                   |   1992 | 4666662525.40617
 ARGENTINA                 |   1998 |  2712839570.2446
 ARGENTINA                 |   1997 | 4607734952.67257
 ARGENTINA                 |   1996 |  4628835330.9573
 ARGENTINA                 |   1995 | 4606454582.44537
 ARGENTINA                 |   1994 | 4620477719.65078
 ARGENTINA                 |   1993 | 4634266489.25162
 ARGENTINA                 |   1992 |  4617362764.3911
 BRAZIL                    |   1998 | 2717241093.40699
 BRAZIL                    |   1997 | 4640446549.64887
 BRAZIL                    |   1996 | 4668283555.91815
 BRAZIL                    |   1995 | 4665999160.72816
 BRAZIL                    |   1994 | 4629530868.54835
 BRAZIL                    |   1993 | 4648969892.31947
 BRAZIL                    |   1992 | 4661330167.32179
 CANADA                    |   1998 | 2746195226.53479
 CANADA                    |   1997 | 4706185300.49457
 CANADA                    |   1996 | 4710938698.82563
 CANADA                    |   1995 | 4693480035.80543
 CANADA                    |   1994 | 4707389312.47349
 CANADA                    |   1993 | 4679668443.77391
 CANADA                    |   1992 | 4725074703.59978
 CHINA                     |   1998 | 2736458692.14545
 CHINA                     |   1997 | 4665356730.35871
 CHINA                     |   1996 | 4642941687.39427
 CHINA                     |   1995 | 4686126017.45792
 CHINA                     |   1994 | 4643773787.77814
 CHINA                     |   1993 | 4676662678.24845
 CHINA                     |   1992 | 4676111540.05829
 EGYPT                     |   1998 | 2725786045.43074
 EGYPT                     |   1997 | 4674402751.61466
 EGYPT                     |   1996 | 4700051214.54064
 EGYPT                     |   1995 | 4663844391.87494
 EGYPT                     |   1994 | 4655950410.33253
 EGYPT                     |   1993 | 4686295435.88974
 EGYPT                     |   1992 | 4692048914.88172
 ETHIOPIA                  |   1998 | 2776498124.65563
 ETHIOPIA                  |   1997 | 4708349906.63528
 ETHIOPIA                  |   1996 | 4718675624.20584
 ETHIOPIA                  |   1995 | 4696871567.96367
 ETHIOPIA                  |   1994 | 4715452205.48582
 ETHIOPIA                  |   1993 | 4707760874.56637
 ETHIOPIA                  |   1992 | 4693464939.08702
 FRANCE                    |   1998 | 2737684887.35988
 FRANCE                    |   1997 | 4692791111.50086
 FRANCE                    |   1996 | 4715152971.48304
 FRANCE                    |   1995 | 4675335037.17156
 FRANCE                    |   1994 |  4699788103.0384
 FRANCE                    |   1993 | 4694290208.70842
 FRANCE                    |   1992 | 4687401455.69422
 GERMANY                   |   1998 | 2741615388.90688
 GERMANY                   |   1997 | 4645387599.92009
 GERMANY                   |   1996 | 4682850179.41068
 GERMANY                   |   1995 | 4650576325.17414
 GERMANY                   |   1994 | 4662930449.63346
 GERMANY                   |   1993 | 4662383604.74614
 GERMANY                   |   1992 | 4667470852.90427
 INDIA                     |   1998 | 2742528066.00042
 INDIA                     |   1997 | 4666156279.83848
 INDIA                     |   1996 |  4692260508.0794
 INDIA                     |   1995 | 4657986036.06456
 INDIA                     |   1994 | 4649531594.02402
 INDIA                     |   1993 | 4648105533.81488
 INDIA                     |   1992 | 4691188478.62475
 INDONESIA                 |   1998 | 2705735673.00327
 INDONESIA                 |   1997 | 4634715629.56067
 INDONESIA                 |   1996 | 4601619815.58128
 INDONESIA                 |   1995 | 4628268018.12068
 INDONESIA                 |   1994 | 4604876747.51354
 INDONESIA                 |   1993 | 4591807790.34694
 INDONESIA                 |   1992 | 4587769053.96688
 IRAN                      |   1998 | 2728023440.98727
 IRAN                      |   1997 | 4683532605.48992
 IRAN                      |   1996 | 4688221826.85307
 IRAN                      |   1995 | 4665577932.47981
 IRAN                      |   1994 | 4662243475.75555
 IRAN                      |   1993 | 4660409166.91555
 IRAN                      |   1992 | 4664006895.91536
 IRAQ                      |   1998 | 2740737714.48466
 IRAQ                      |   1997 | 4674125113.65547
 IRAQ                      |   1996 | 4668582174.75031
 IRAQ                      |   1995 |  4682075961.3156
 IRAQ                      |   1994 | 4651300188.07313
 IRAQ                      |   1993 | 4673476392.84629
 IRAQ                      |   1992 |  4667344737.8576
 JAPAN                     |   1998 | 2711201545.40757
 JAPAN                     |   1997 | 4635226068.99047
 JAPAN                     |   1996 | 4675506748.47025
 JAPAN                     |   1995 | 4645261281.23459
 JAPAN                     |   1994 | 4628189635.30524
 JAPAN                     |   1993 | 4633392222.92279
 JAPAN                     |   1992 | 4629782032.39724
 JORDAN                    |   1998 | 2725898120.81263
 JORDAN                    |   1997 | 4658814434.14679
 JORDAN                    |   1996 | 4668948037.96982
 JORDAN                    |   1995 | 4650742874.90661
 JORDAN                    |   1994 | 4660669713.54833
 JORDAN                    |   1993 | 4654944535.36086
 JORDAN                    |   1992 | 4673470521.63939
 KENYA                     |   1998 | 2733630049.94803
 KENYA                     |   1997 | 4645675118.44132
 KENYA                     |   1996 | 4649008039.09106
 KENYA                     |   1995 | 4659097958.82568
 KENYA                     |   1994 |  4628702813.9969
 KENYA                     |   1993 | 4638873341.70389
 KENYA                     |   1992 | 4635907359.89301
 MOROCCO                   |   1998 | 2737372560.73887
 MOROCCO                   |   1997 | 4682023204.75759
 MOROCCO                   |   1996 | 4697081515.67755
 MOROCCO                   |   1995 |  4678877096.3165
 MOROCCO                   |   1994 | 4671855507.90057
 MOROCCO                   |   1993 |  4675266489.1994
 MOROCCO                   |   1992 | 4683121527.63119
 MOZAMBIQUE                |   1998 | 2720870905.41304
 MOZAMBIQUE                |   1997 |  4660536630.7866
 MOZAMBIQUE                |   1996 | 4667695869.30179
 MOZAMBIQUE                |   1995 | 4634933026.20358
 MOZAMBIQUE                |   1994 | 4621651047.30711
 MOZAMBIQUE                |   1993 | 4643799308.00355
 MOZAMBIQUE                |   1992 | 4650129641.79994
 PERU                      |   1998 | 2713765791.75424
 PERU                      |   1997 | 4630645865.81359
 PERU                      |   1996 | 4632071447.45048
 PERU                      |   1995 |  4646064320.5132
 PERU                      |   1994 |  4646388300.8427
 PERU                      |   1993 | 4637786023.28146
 PERU                      |   1992 | 4637884162.95396
 ROMANIA                   |   1998 | 2739042559.70026
 ROMANIA                   |   1997 | 4678582844.00391
 ROMANIA                   |   1996 | 4678668615.74794
 ROMANIA                   |   1995 | 4672618535.51609
 ROMANIA                   |   1994 | 4671949308.69001
 ROMANIA                   |   1993 | 4642410362.89531
 ROMANIA                   |   1992 | 4682503543.82718
 RUSSIA                    |   1998 | 2733018216.47897
 RUSSIA                    |   1997 | 4700997813.39909
 RUSSIA                    |   1996 | 4676338090.76833
 RUSSIA                    |   1995 | 4674511449.84151
 RUSSIA                    |   1994 | 4680794578.19545
 RUSSIA                    |   1993 | 4675440544.14508
 RUSSIA                    |   1992 | 4692073034.96378
 SAUDI ARABIA              |   1998 | 2736054689.17947
 SAUDI ARABIA              |   1997 | 4686986769.81284
 SAUDI ARABIA              |   1996 | 4707750336.94399
 SAUDI ARABIA              |   1995 | 4683200224.64102
 SAUDI ARABIA              |   1994 | 4689787445.76669
 SAUDI ARABIA              |   1993 | 4706864022.72337
 SAUDI ARABIA              |   1992 | 4687030272.49854
 UNITED KINGDOM            |   1998 | 2776447540.47684
 UNITED KINGDOM            |   1997 | 4706228153.86783
 UNITED KINGDOM            |   1996 | 4754577843.50061
 UNITED KINGDOM            |   1995 |  4718373479.6881
 UNITED KINGDOM            |   1994 | 4742470609.96014
 UNITED KINGDOM            |   1993 | 4729799625.25702
 UNITED KINGDOM            |   1992 | 4739698590.41023
 UNITED STATES             |   1998 | 2746227408.91021
 UNITED STATES             |   1997 | 4671581920.51548
 UNITED STATES             |   1996 | 4684723274.13544
 UNITED STATES             |   1995 | 4674037722.21241
 UNITED STATES             |   1994 | 4679052658.85879
 UNITED STATES             |   1993 | 4684532271.43057
 UNITED STATES             |   1992 | 4674409515.41424
 VIETNAM                   |   1998 | 2717057391.75631
 VIETNAM                   |   1997 | 4682030890.04347
 VIETNAM                   |   1996 | 4692306200.44944
 VIETNAM                   |   1995 | 4690315533.50302
 VIETNAM                   |   1994 | 4665072208.92713
 VIETNAM                   |   1993 | 4676897225.93598
 VIETNAM                   |   1992 |  4681169669.5684
(175 rows)

COMMIT;
COMMIT
