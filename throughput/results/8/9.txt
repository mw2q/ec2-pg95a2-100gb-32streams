BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%metallic%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2731511994.98489
 ALGERIA                   |   1997 | 4662945483.58906
 ALGERIA                   |   1996 | 4674831987.34811
 ALGERIA                   |   1995 | 4657775744.01978
 ALGERIA                   |   1994 | 4684569680.03944
 ALGERIA                   |   1993 | 4658022229.68243
 ALGERIA                   |   1992 | 4675151526.18812
 ARGENTINA                 |   1998 | 2715038144.84921
 ARGENTINA                 |   1997 | 4643646960.45267
 ARGENTINA                 |   1996 | 4643273369.64069
 ARGENTINA                 |   1995 | 4592271393.56603
 ARGENTINA                 |   1994 | 4621223874.44115
 ARGENTINA                 |   1993 | 4611854244.44123
 ARGENTINA                 |   1992 | 4635928125.57986
 BRAZIL                    |   1998 | 2740245534.48005
 BRAZIL                    |   1997 |  4662191890.2694
 BRAZIL                    |   1996 | 4677984642.73606
 BRAZIL                    |   1995 | 4660392141.11787
 BRAZIL                    |   1994 | 4663230898.85877
 BRAZIL                    |   1993 | 4659294884.19527
 BRAZIL                    |   1992 | 4684846987.37387
 CANADA                    |   1998 | 2747453781.96347
 CANADA                    |   1997 | 4661595282.01952
 CANADA                    |   1996 | 4702175801.20108
 CANADA                    |   1995 | 4674481641.69814
 CANADA                    |   1994 | 4679398077.26182
 CANADA                    |   1993 | 4676461704.70383
 CANADA                    |   1992 | 4674213329.54204
 CHINA                     |   1998 | 2731460675.30376
 CHINA                     |   1997 |  4661885324.0151
 CHINA                     |   1996 | 4700690297.53839
 CHINA                     |   1995 | 4663689990.94174
 CHINA                     |   1994 | 4646124120.83302
 CHINA                     |   1993 | 4659282173.84484
 CHINA                     |   1992 | 4683737469.61766
 EGYPT                     |   1998 | 2719238681.22769
 EGYPT                     |   1997 | 4675156543.92628
 EGYPT                     |   1996 | 4692621767.85773
 EGYPT                     |   1995 | 4682781157.07191
 EGYPT                     |   1994 | 4684692982.00163
 EGYPT                     |   1993 | 4675405819.83185
 EGYPT                     |   1992 | 4670240192.25509
 ETHIOPIA                  |   1998 | 2786517606.02565
 ETHIOPIA                  |   1997 | 4719268328.50197
 ETHIOPIA                  |   1996 | 4734157573.52923
 ETHIOPIA                  |   1995 | 4712909831.65524
 ETHIOPIA                  |   1994 | 4748343323.03761
 ETHIOPIA                  |   1993 | 4731127744.66613
 ETHIOPIA                  |   1992 | 4751949956.17225
 FRANCE                    |   1998 | 2741568890.65503
 FRANCE                    |   1997 | 4653684706.52421
 FRANCE                    |   1996 | 4672305480.81224
 FRANCE                    |   1995 |  4674205650.2419
 FRANCE                    |   1994 | 4659865660.76078
 FRANCE                    |   1993 | 4674137130.50513
 FRANCE                    |   1992 | 4651474735.53694
 GERMANY                   |   1998 | 2747980973.40032
 GERMANY                   |   1997 | 4670870254.41927
 GERMANY                   |   1996 | 4681428687.25164
 GERMANY                   |   1995 | 4677022616.87362
 GERMANY                   |   1994 | 4692315852.16772
 GERMANY                   |   1993 | 4654973267.65716
 GERMANY                   |   1992 | 4662569481.96753
 INDIA                     |   1998 | 2745717112.77692
 INDIA                     |   1997 | 4659536666.20352
 INDIA                     |   1996 | 4663480976.28542
 INDIA                     |   1995 | 4652512024.72334
 INDIA                     |   1994 | 4646231210.66222
 INDIA                     |   1993 | 4650560606.43017
 INDIA                     |   1992 | 4696311172.68979
 INDONESIA                 |   1998 | 2723184200.91845
 INDONESIA                 |   1997 | 4650779591.56222
 INDONESIA                 |   1996 | 4621424537.67073
 INDONESIA                 |   1995 | 4659155587.38064
 INDONESIA                 |   1994 | 4641448773.33621
 INDONESIA                 |   1993 |   4629786017.334
 INDONESIA                 |   1992 | 4651931710.97124
 IRAN                      |   1998 | 2724515197.45818
 IRAN                      |   1997 |  4654497081.1097
 IRAN                      |   1996 | 4667149253.00331
 IRAN                      |   1995 | 4657223844.06656
 IRAN                      |   1994 | 4672867556.76197
 IRAN                      |   1993 | 4661472287.93478
 IRAN                      |   1992 | 4661176527.25138
 IRAQ                      |   1998 |  2717077936.5818
 IRAQ                      |   1997 | 4607275295.52533
 IRAQ                      |   1996 | 4633196544.08353
 IRAQ                      |   1995 | 4641138247.74651
 IRAQ                      |   1994 | 4612965448.67006
 IRAQ                      |   1993 |   4627730331.775
 IRAQ                      |   1992 | 4653769152.71594
 JAPAN                     |   1998 | 2728808586.00797
 JAPAN                     |   1997 | 4646019318.56465
 JAPAN                     |   1996 | 4638151427.12835
 JAPAN                     |   1995 | 4649965753.54396
 JAPAN                     |   1994 |  4654999394.9477
 JAPAN                     |   1993 | 4617975350.20693
 JAPAN                     |   1992 | 4660664274.63653
 JORDAN                    |   1998 | 2738612956.16266
 JORDAN                    |   1997 | 4654886497.64163
 JORDAN                    |   1996 | 4682233049.19349
 JORDAN                    |   1995 | 4636309035.53117
 JORDAN                    |   1994 | 4656563470.21416
 JORDAN                    |   1993 | 4646424417.00779
 JORDAN                    |   1992 | 4631969269.28575
 KENYA                     |   1998 | 2727160053.80669
 KENYA                     |   1997 | 4656597900.96877
 KENYA                     |   1996 |  4660183354.4404
 KENYA                     |   1995 | 4618630131.29398
 KENYA                     |   1994 | 4656932419.87597
 KENYA                     |   1993 | 4648965408.18782
 KENYA                     |   1992 | 4668910867.93627
 MOROCCO                   |   1998 | 2716803377.40284
 MOROCCO                   |   1997 |  4673937475.7093
 MOROCCO                   |   1996 | 4668537452.96457
 MOROCCO                   |   1995 | 4660500897.48252
 MOROCCO                   |   1994 | 4636698335.77327
 MOROCCO                   |   1993 |  4660530548.9071
 MOROCCO                   |   1992 | 4660524897.65422
 MOZAMBIQUE                |   1998 |  2735430073.5782
 MOZAMBIQUE                |   1997 | 4649519935.20815
 MOZAMBIQUE                |   1996 | 4656644459.62498
 MOZAMBIQUE                |   1995 |  4638283585.7633
 MOZAMBIQUE                |   1994 | 4646029131.45697
 MOZAMBIQUE                |   1993 |  4672865876.0603
 MOZAMBIQUE                |   1992 | 4657847183.14058
 PERU                      |   1998 | 2712179835.13086
 PERU                      |   1997 | 4640661799.82476
 PERU                      |   1996 | 4641839024.18409
 PERU                      |   1995 |  4644061541.7535
 PERU                      |   1994 | 4639533145.01045
 PERU                      |   1993 | 4623918334.04369
 PERU                      |   1992 | 4648486482.35409
 ROMANIA                   |   1998 | 2750137172.83068
 ROMANIA                   |   1997 | 4669001408.38822
 ROMANIA                   |   1996 | 4691660021.80141
 ROMANIA                   |   1995 | 4694015686.53181
 ROMANIA                   |   1994 | 4677158816.72155
 ROMANIA                   |   1993 | 4656561214.59254
 ROMANIA                   |   1992 | 4667633095.45925
 RUSSIA                    |   1998 | 2723423803.35277
 RUSSIA                    |   1997 | 4659312040.39304
 RUSSIA                    |   1996 | 4665006849.06623
 RUSSIA                    |   1995 | 4666507486.44244
 RUSSIA                    |   1994 | 4658920600.76698
 RUSSIA                    |   1993 | 4671551541.13137
 RUSSIA                    |   1992 | 4663915116.17922
 SAUDI ARABIA              |   1998 | 2721194329.81786
 SAUDI ARABIA              |   1997 | 4670451174.83245
 SAUDI ARABIA              |   1996 | 4654185546.12051
 SAUDI ARABIA              |   1995 | 4672293738.13715
 SAUDI ARABIA              |   1994 | 4657212565.45885
 SAUDI ARABIA              |   1993 | 4675062738.76466
 SAUDI ARABIA              |   1992 | 4650964102.61061
 UNITED KINGDOM            |   1998 | 2768523274.08837
 UNITED KINGDOM            |   1997 | 4732157462.76276
 UNITED KINGDOM            |   1996 | 4729712352.06709
 UNITED KINGDOM            |   1995 | 4703968860.37596
 UNITED KINGDOM            |   1994 | 4718442459.18346
 UNITED KINGDOM            |   1993 | 4701569631.92941
 UNITED KINGDOM            |   1992 | 4732758611.00558
 UNITED STATES             |   1998 | 2739075855.20346
 UNITED STATES             |   1997 | 4637224497.22568
 UNITED STATES             |   1996 | 4699494807.79351
 UNITED STATES             |   1995 | 4647371724.17942
 UNITED STATES             |   1994 | 4685616856.91412
 UNITED STATES             |   1993 | 4659298076.28572
 UNITED STATES             |   1992 | 4672066596.21248
 VIETNAM                   |   1998 | 2740280577.14205
 VIETNAM                   |   1997 | 4691906863.97923
 VIETNAM                   |   1996 | 4715832738.83341
 VIETNAM                   |   1995 | 4684618795.52994
 VIETNAM                   |   1994 | 4680501002.25913
 VIETNAM                   |   1993 | 4682328246.47332
 VIETNAM                   |   1992 | 4700959349.49717
(175 rows)

COMMIT;
COMMIT
