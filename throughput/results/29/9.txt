BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%coral%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2736470913.88508
 ALGERIA                   |   1997 | 4693551144.63531
 ALGERIA                   |   1996 | 4704422037.17564
 ALGERIA                   |   1995 | 4672871465.90573
 ALGERIA                   |   1994 | 4668401777.30781
 ALGERIA                   |   1993 | 4660020537.33552
 ALGERIA                   |   1992 | 4693780980.19001
 ARGENTINA                 |   1998 | 2722597248.49047
 ARGENTINA                 |   1997 | 4630554689.05969
 ARGENTINA                 |   1996 | 4659703159.79496
 ARGENTINA                 |   1995 | 4616706109.12541
 ARGENTINA                 |   1994 | 4636596624.23652
 ARGENTINA                 |   1993 | 4627687944.70596
 ARGENTINA                 |   1992 | 4658259755.92976
 BRAZIL                    |   1998 | 2730160858.16921
 BRAZIL                    |   1997 |   4663754671.216
 BRAZIL                    |   1996 | 4691263628.47205
 BRAZIL                    |   1995 | 4664360993.54359
 BRAZIL                    |   1994 | 4675193214.77316
 BRAZIL                    |   1993 | 4686804236.62017
 BRAZIL                    |   1992 | 4701813724.66429
 CANADA                    |   1998 | 2751599379.16466
 CANADA                    |   1997 |  4704994317.6797
 CANADA                    |   1996 |  4697075725.6142
 CANADA                    |   1995 | 4720862677.59279
 CANADA                    |   1994 | 4698732145.61024
 CANADA                    |   1993 |  4685601092.9289
 CANADA                    |   1992 | 4708859530.72171
 CHINA                     |   1998 | 2751880697.51073
 CHINA                     |   1997 | 4684170713.29572
 CHINA                     |   1996 | 4731929883.93118
 CHINA                     |   1995 | 4690777390.57837
 CHINA                     |   1994 | 4679614892.39986
 CHINA                     |   1993 |  4661427165.5685
 CHINA                     |   1992 | 4723080674.59237
 EGYPT                     |   1998 | 2749363368.13192
 EGYPT                     |   1997 | 4661253537.10065
 EGYPT                     |   1996 |  4676925799.2705
 EGYPT                     |   1995 | 4688329805.73896
 EGYPT                     |   1994 | 4660781027.03946
 EGYPT                     |   1993 | 4691390731.95544
 EGYPT                     |   1992 | 4693620362.40901
 ETHIOPIA                  |   1998 |  2744724589.1265
 ETHIOPIA                  |   1997 | 4702478195.91162
 ETHIOPIA                  |   1996 | 4708018914.04596
 ETHIOPIA                  |   1995 | 4696575058.04243
 ETHIOPIA                  |   1994 | 4693466760.72846
 ETHIOPIA                  |   1993 | 4684450748.40752
 ETHIOPIA                  |   1992 | 4731215808.71561
 FRANCE                    |   1998 | 2756364040.64793
 FRANCE                    |   1997 | 4692227410.61854
 FRANCE                    |   1996 | 4738028506.25213
 FRANCE                    |   1995 | 4704931329.93363
 FRANCE                    |   1994 | 4720638543.56044
 FRANCE                    |   1993 | 4705106397.42696
 FRANCE                    |   1992 | 4725282553.57166
 GERMANY                   |   1998 | 2756490715.79111
 GERMANY                   |   1997 | 4678101881.87708
 GERMANY                   |   1996 | 4698414466.04838
 GERMANY                   |   1995 | 4679602437.36129
 GERMANY                   |   1994 | 4699198490.67236
 GERMANY                   |   1993 | 4703694140.59532
 GERMANY                   |   1992 | 4724398648.63897
 INDIA                     |   1998 | 2749490160.78824
 INDIA                     |   1997 | 4698492648.15562
 INDIA                     |   1996 | 4720303132.17869
 INDIA                     |   1995 | 4679057766.17787
 INDIA                     |   1994 | 4713000257.04759
 INDIA                     |   1993 | 4683085611.13525
 INDIA                     |   1992 | 4724015572.23468
 INDONESIA                 |   1998 | 2731920188.25384
 INDONESIA                 |   1997 | 4642195407.79069
 INDONESIA                 |   1996 | 4660595792.77803
 INDONESIA                 |   1995 | 4642496468.22648
 INDONESIA                 |   1994 | 4677378523.35117
 INDONESIA                 |   1993 | 4667269529.53222
 INDONESIA                 |   1992 | 4663922979.22651
 IRAN                      |   1998 | 2720108794.92146
 IRAN                      |   1997 | 4625249892.55113
 IRAN                      |   1996 | 4634205241.58924
 IRAN                      |   1995 | 4650879459.05204
 IRAN                      |   1994 | 4626518729.43577
 IRAN                      |   1993 | 4626752506.34802
 IRAN                      |   1992 | 4633897593.58276
 IRAQ                      |   1998 | 2738553495.12216
 IRAQ                      |   1997 | 4619086861.48206
 IRAQ                      |   1996 | 4666860209.81848
 IRAQ                      |   1995 |  4631581838.0005
 IRAQ                      |   1994 | 4633769901.18707
 IRAQ                      |   1993 | 4612612484.48917
 IRAQ                      |   1992 |  4652155321.6832
 JAPAN                     |   1998 | 2731040018.17501
 JAPAN                     |   1997 | 4608535319.17878
 JAPAN                     |   1996 | 4621421763.69085
 JAPAN                     |   1995 | 4626724161.22034
 JAPAN                     |   1994 | 4623849837.56674
 JAPAN                     |   1993 | 4619058972.27744
 JAPAN                     |   1992 | 4642693015.45406
 JORDAN                    |   1998 | 2718798649.25444
 JORDAN                    |   1997 | 4643683868.39221
 JORDAN                    |   1996 | 4675643199.86156
 JORDAN                    |   1995 | 4637841366.80324
 JORDAN                    |   1994 | 4629520204.04899
 JORDAN                    |   1993 | 4630686338.46261
 JORDAN                    |   1992 | 4670087896.56899
 KENYA                     |   1998 | 2725822114.74605
 KENYA                     |   1997 | 4642346573.14949
 KENYA                     |   1996 | 4680398631.22774
 KENYA                     |   1995 | 4623899859.06489
 KENYA                     |   1994 | 4646973230.89998
 KENYA                     |   1993 | 4652227887.03521
 KENYA                     |   1992 | 4651359829.21785
 MOROCCO                   |   1998 | 2748906394.34592
 MOROCCO                   |   1997 | 4676490496.40455
 MOROCCO                   |   1996 | 4716630092.97055
 MOROCCO                   |   1995 | 4676888567.96703
 MOROCCO                   |   1994 |  4665706865.2774
 MOROCCO                   |   1993 |  4676995055.3121
 MOROCCO                   |   1992 | 4694489938.93814
 MOZAMBIQUE                |   1998 | 2742044361.52616
 MOZAMBIQUE                |   1997 | 4667628471.45315
 MOZAMBIQUE                |   1996 | 4689625025.94928
 MOZAMBIQUE                |   1995 | 4685122548.16863
 MOZAMBIQUE                |   1994 | 4673814078.90843
 MOZAMBIQUE                |   1993 | 4685201320.99042
 MOZAMBIQUE                |   1992 | 4647369375.93394
 PERU                      |   1998 | 2725295377.67094
 PERU                      |   1997 |   4629692809.492
 PERU                      |   1996 |  4652012582.7786
 PERU                      |   1995 | 4639550522.83071
 PERU                      |   1994 | 4628719237.80569
 PERU                      |   1993 | 4621305753.34658
 PERU                      |   1992 | 4664116209.40363
 ROMANIA                   |   1998 | 2742482996.46224
 ROMANIA                   |   1997 |  4706769409.0449
 ROMANIA                   |   1996 |  4693159131.2692
 ROMANIA                   |   1995 | 4685217390.83868
 ROMANIA                   |   1994 | 4704604264.32645
 ROMANIA                   |   1993 | 4694075880.70658
 ROMANIA                   |   1992 | 4708128708.71163
 RUSSIA                    |   1998 | 2728586339.11204
 RUSSIA                    |   1997 | 4682123476.42844
 RUSSIA                    |   1996 | 4695877135.51642
 RUSSIA                    |   1995 | 4703147821.84292
 RUSSIA                    |   1994 | 4663559125.68788
 RUSSIA                    |   1993 |  4668064448.4179
 RUSSIA                    |   1992 | 4680908777.51018
 SAUDI ARABIA              |   1998 | 2741545251.69635
 SAUDI ARABIA              |   1997 | 4681555502.28884
 SAUDI ARABIA              |   1996 | 4674298586.03067
 SAUDI ARABIA              |   1995 | 4671778600.91658
 SAUDI ARABIA              |   1994 | 4663051234.79533
 SAUDI ARABIA              |   1993 |  4655542231.8241
 SAUDI ARABIA              |   1992 | 4674879222.09251
 UNITED KINGDOM            |   1998 | 2773869691.29774
 UNITED KINGDOM            |   1997 | 4737402668.85611
 UNITED KINGDOM            |   1996 | 4750482979.14583
 UNITED KINGDOM            |   1995 | 4698570314.75137
 UNITED KINGDOM            |   1994 |  4721864473.6981
 UNITED KINGDOM            |   1993 | 4729235230.12684
 UNITED KINGDOM            |   1992 | 4731563525.45856
 UNITED STATES             |   1998 | 2741829411.19962
 UNITED STATES             |   1997 | 4662676265.13073
 UNITED STATES             |   1996 | 4684649038.67437
 UNITED STATES             |   1995 | 4661164063.92607
 UNITED STATES             |   1994 | 4656709730.20947
 UNITED STATES             |   1993 | 4680277269.56107
 UNITED STATES             |   1992 | 4654524500.96548
 VIETNAM                   |   1998 | 2734866071.97964
 VIETNAM                   |   1997 | 4688324063.45958
 VIETNAM                   |   1996 | 4691150441.36794
 VIETNAM                   |   1995 | 4702784238.75328
 VIETNAM                   |   1994 | 4702213050.81903
 VIETNAM                   |   1993 | 4676166271.99342
 VIETNAM                   |   1992 |  4704534977.7732
(175 rows)

COMMIT;
COMMIT
