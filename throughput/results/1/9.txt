BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%almond%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2726336477.53974
 ALGERIA                   |   1997 | 4636664930.83926
 ALGERIA                   |   1996 | 4643726771.81005
 ALGERIA                   |   1995 | 4650087468.82199
 ALGERIA                   |   1994 | 4646581459.06773
 ALGERIA                   |   1993 |  4650891686.1683
 ALGERIA                   |   1992 | 4696529514.75097
 ARGENTINA                 |   1998 | 2714831525.85128
 ARGENTINA                 |   1997 | 4646583784.33021
 ARGENTINA                 |   1996 | 4671937224.52551
 ARGENTINA                 |   1995 | 4653946056.83514
 ARGENTINA                 |   1994 | 4641405663.23411
 ARGENTINA                 |   1993 | 4683482992.37756
 ARGENTINA                 |   1992 | 4665146680.10053
 BRAZIL                    |   1998 | 2755514129.46476
 BRAZIL                    |   1997 | 4672654252.41037
 BRAZIL                    |   1996 | 4689812310.41839
 BRAZIL                    |   1995 | 4668804692.12663
 BRAZIL                    |   1994 | 4709874402.39878
 BRAZIL                    |   1993 | 4688183428.83674
 BRAZIL                    |   1992 | 4701480388.90273
 CANADA                    |   1998 |  2739049129.4629
 CANADA                    |   1997 | 4672862045.20597
 CANADA                    |   1996 | 4705014646.78086
 CANADA                    |   1995 | 4690799969.98921
 CANADA                    |   1994 | 4705725305.27886
 CANADA                    |   1993 |  4683807352.8277
 CANADA                    |   1992 | 4703626641.83147
 CHINA                     |   1998 | 2766615564.24855
 CHINA                     |   1997 | 4683188612.94485
 CHINA                     |   1996 | 4710962060.75563
 CHINA                     |   1995 | 4669873536.29305
 CHINA                     |   1994 | 4694311999.20988
 CHINA                     |   1993 |  4669043248.5715
 CHINA                     |   1992 | 4677069107.90614
 EGYPT                     |   1998 | 2740026452.73056
 EGYPT                     |   1997 |  4674802577.7251
 EGYPT                     |   1996 | 4669215684.83886
 EGYPT                     |   1995 | 4678482070.86604
 EGYPT                     |   1994 |  4665442609.9251
 EGYPT                     |   1993 | 4659934853.53383
 EGYPT                     |   1992 | 4665059922.09292
 ETHIOPIA                  |   1998 | 2784243996.77141
 ETHIOPIA                  |   1997 | 4721905342.12204
 ETHIOPIA                  |   1996 | 4747964855.62685
 ETHIOPIA                  |   1995 | 4732884259.72173
 ETHIOPIA                  |   1994 | 4737762717.62024
 ETHIOPIA                  |   1993 | 4744928440.22816
 ETHIOPIA                  |   1992 |  4726907750.4315
 FRANCE                    |   1998 | 2720823479.25449
 FRANCE                    |   1997 | 4684262553.58521
 FRANCE                    |   1996 | 4683447801.00312
 FRANCE                    |   1995 |   4693718386.421
 FRANCE                    |   1994 | 4664557120.93578
 FRANCE                    |   1993 | 4652921232.49061
 FRANCE                    |   1992 | 4667041377.51898
 GERMANY                   |   1998 | 2751210651.31185
 GERMANY                   |   1997 | 4704167487.06149
 GERMANY                   |   1996 | 4704531797.28694
 GERMANY                   |   1995 | 4685057024.88655
 GERMANY                   |   1994 | 4706647955.90459
 GERMANY                   |   1993 | 4712142086.60345
 GERMANY                   |   1992 | 4691478551.70919
 INDIA                     |   1998 | 2764155248.37868
 INDIA                     |   1997 | 4684785595.58277
 INDIA                     |   1996 | 4680384412.37814
 INDIA                     |   1995 | 4654010438.45779
 INDIA                     |   1994 | 4687104781.81961
 INDIA                     |   1993 | 4696710790.38891
 INDIA                     |   1992 | 4682682114.53259
 INDONESIA                 |   1998 | 2706524583.90713
 INDONESIA                 |   1997 | 4620330310.39758
 INDONESIA                 |   1996 |   4629505235.086
 INDONESIA                 |   1995 | 4631826455.27465
 INDONESIA                 |   1994 | 4636474683.61288
 INDONESIA                 |   1993 | 4644119980.49134
 INDONESIA                 |   1992 | 4676691663.92965
 IRAN                      |   1998 |  2717060940.8666
 IRAN                      |   1997 | 4647180088.29396
 IRAN                      |   1996 | 4662615278.94024
 IRAN                      |   1995 | 4632968608.52877
 IRAN                      |   1994 | 4656608391.56361
 IRAN                      |   1993 | 4650653806.60315
 IRAN                      |   1992 | 4675802601.81257
 IRAQ                      |   1998 | 2723560505.07082
 IRAQ                      |   1997 | 4638216764.44107
 IRAQ                      |   1996 | 4645618858.25948
 IRAQ                      |   1995 | 4653765541.87976
 IRAQ                      |   1994 | 4639394571.47644
 IRAQ                      |   1993 | 4637381810.42817
 IRAQ                      |   1992 |  4656643814.2503
 JAPAN                     |   1998 | 2720587229.03642
 JAPAN                     |   1997 | 4605721306.32358
 JAPAN                     |   1996 | 4623612338.01887
 JAPAN                     |   1995 | 4632016645.43254
 JAPAN                     |   1994 | 4620977548.91935
 JAPAN                     |   1993 | 4614598020.44964
 JAPAN                     |   1992 | 4611851090.27597
 JORDAN                    |   1998 | 2741781354.35748
 JORDAN                    |   1997 | 4680464624.25097
 JORDAN                    |   1996 | 4670717447.13173
 JORDAN                    |   1995 | 4657101077.18433
 JORDAN                    |   1994 | 4653354222.04028
 JORDAN                    |   1993 | 4685004089.99551
 JORDAN                    |   1992 | 4680903171.62911
 KENYA                     |   1998 | 2701508188.34446
 KENYA                     |   1997 |  4634775939.1422
 KENYA                     |   1996 | 4648986415.08735
 KENYA                     |   1995 | 4612083180.50611
 KENYA                     |   1994 | 4613482649.79335
 KENYA                     |   1993 | 4635278482.51597
 KENYA                     |   1992 | 4637843115.84889
 MOROCCO                   |   1998 | 2748450104.66873
 MOROCCO                   |   1997 | 4688140913.91878
 MOROCCO                   |   1996 | 4697237010.20384
 MOROCCO                   |   1995 | 4677611027.48072
 MOROCCO                   |   1994 | 4675553192.27161
 MOROCCO                   |   1993 | 4676296839.74154
 MOROCCO                   |   1992 | 4688837805.31792
 MOZAMBIQUE                |   1998 | 2723971023.54171
 MOZAMBIQUE                |   1997 | 4657198255.14482
 MOZAMBIQUE                |   1996 | 4676064563.13341
 MOZAMBIQUE                |   1995 | 4640224180.57003
 MOZAMBIQUE                |   1994 | 4666497240.96842
 MOZAMBIQUE                |   1993 | 4672565443.94891
 MOZAMBIQUE                |   1992 | 4668824363.97053
 PERU                      |   1998 | 2691725091.90807
 PERU                      |   1997 | 4637754842.34988
 PERU                      |   1996 | 4646509549.88231
 PERU                      |   1995 | 4646166189.28985
 PERU                      |   1994 | 4633935680.03862
 PERU                      |   1993 | 4633313303.66251
 PERU                      |   1992 | 4663341028.61607
 ROMANIA                   |   1998 | 2740504848.41135
 ROMANIA                   |   1997 | 4671283193.07517
 ROMANIA                   |   1996 | 4709056123.53328
 ROMANIA                   |   1995 |  4648930491.4962
 ROMANIA                   |   1994 | 4687071156.84702
 ROMANIA                   |   1993 | 4658551478.57423
 ROMANIA                   |   1992 | 4724067922.34284
 RUSSIA                    |   1998 | 2723941938.58749
 RUSSIA                    |   1997 | 4680065425.06595
 RUSSIA                    |   1996 | 4690090171.53489
 RUSSIA                    |   1995 | 4674954851.35971
 RUSSIA                    |   1994 | 4660166944.85459
 RUSSIA                    |   1993 | 4640747837.06778
 RUSSIA                    |   1992 | 4680305246.59151
 SAUDI ARABIA              |   1998 | 2726046115.16466
 SAUDI ARABIA              |   1997 | 4670622377.69543
 SAUDI ARABIA              |   1996 | 4697366212.74519
 SAUDI ARABIA              |   1995 |  4680299898.0216
 SAUDI ARABIA              |   1994 | 4645384985.86564
 SAUDI ARABIA              |   1993 | 4664751638.94638
 SAUDI ARABIA              |   1992 | 4677693050.58394
 UNITED KINGDOM            |   1998 | 2753441039.38486
 UNITED KINGDOM            |   1997 | 4706604555.47029
 UNITED KINGDOM            |   1996 | 4717714925.84665
 UNITED KINGDOM            |   1995 |  4681537931.2199
 UNITED KINGDOM            |   1994 | 4700117983.29047
 UNITED KINGDOM            |   1993 | 4695500789.37094
 UNITED KINGDOM            |   1992 | 4708780835.44514
 UNITED STATES             |   1998 | 2746855456.88447
 UNITED STATES             |   1997 | 4699042865.17735
 UNITED STATES             |   1996 | 4708755952.99153
 UNITED STATES             |   1995 |  4677993474.1752
 UNITED STATES             |   1994 | 4683772138.97645
 UNITED STATES             |   1993 | 4677011162.28246
 UNITED STATES             |   1992 |  4691068596.5915
 VIETNAM                   |   1998 | 2737841875.07916
 VIETNAM                   |   1997 |  4683736919.5763
 VIETNAM                   |   1996 | 4718349979.98228
 VIETNAM                   |   1995 | 4673369563.28402
 VIETNAM                   |   1994 | 4691337046.62339
 VIETNAM                   |   1993 | 4691611585.02125
 VIETNAM                   |   1992 | 4686302221.93791
(175 rows)

COMMIT;
COMMIT
