BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%aquamarine%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2738682730.12727
 ALGERIA                   |   1997 |  4650336398.4933
 ALGERIA                   |   1996 | 4669589340.83536
 ALGERIA                   |   1995 |  4665562987.1913
 ALGERIA                   |   1994 | 4674885789.64082
 ALGERIA                   |   1993 | 4650984210.20317
 ALGERIA                   |   1992 | 4698525288.64362
 ARGENTINA                 |   1998 | 2708560460.12582
 ARGENTINA                 |   1997 | 4644583315.08231
 ARGENTINA                 |   1996 |  4634551402.9585
 ARGENTINA                 |   1995 |  4615211012.3974
 ARGENTINA                 |   1994 | 4652815100.97357
 ARGENTINA                 |   1993 | 4625988247.79551
 ARGENTINA                 |   1992 | 4641166574.43115
 BRAZIL                    |   1998 | 2713158634.90241
 BRAZIL                    |   1997 | 4622686614.94924
 BRAZIL                    |   1996 | 4666395055.69646
 BRAZIL                    |   1995 | 4636324462.41951
 BRAZIL                    |   1994 |   4631119472.107
 BRAZIL                    |   1993 | 4654680041.80139
 BRAZIL                    |   1992 | 4635423472.66892
 CANADA                    |   1998 | 2744512357.18598
 CANADA                    |   1997 | 4662209656.83604
 CANADA                    |   1996 | 4687707381.17993
 CANADA                    |   1995 | 4681261920.21102
 CANADA                    |   1994 | 4682220978.57401
 CANADA                    |   1993 |  4659548632.5988
 CANADA                    |   1992 | 4675310109.68777
 CHINA                     |   1998 | 2739730907.36585
 CHINA                     |   1997 | 4640581332.51969
 CHINA                     |   1996 | 4677954927.89532
 CHINA                     |   1995 | 4637403598.01505
 CHINA                     |   1994 | 4662850161.73887
 CHINA                     |   1993 | 4663263419.75165
 CHINA                     |   1992 | 4661708278.27864
 EGYPT                     |   1998 | 2732691258.36782
 EGYPT                     |   1997 | 4669030203.02793
 EGYPT                     |   1996 | 4693074686.66325
 EGYPT                     |   1995 |  4654571545.1378
 EGYPT                     |   1994 | 4653358416.80834
 EGYPT                     |   1993 | 4660844790.02617
 EGYPT                     |   1992 | 4682218737.53087
 ETHIOPIA                  |   1998 | 2744121241.06772
 ETHIOPIA                  |   1997 | 4708476446.65559
 ETHIOPIA                  |   1996 | 4726580581.86099
 ETHIOPIA                  |   1995 | 4716146960.82646
 ETHIOPIA                  |   1994 | 4728065618.46683
 ETHIOPIA                  |   1993 | 4706013729.10728
 ETHIOPIA                  |   1992 | 4712076081.79492
 FRANCE                    |   1998 | 2760352563.55285
 FRANCE                    |   1997 | 4677283502.76715
 FRANCE                    |   1996 | 4695684057.62203
 FRANCE                    |   1995 | 4680664667.21869
 FRANCE                    |   1994 | 4668951412.94079
 FRANCE                    |   1993 |  4653048528.7628
 FRANCE                    |   1992 | 4683354903.80978
 GERMANY                   |   1998 | 2727475418.38984
 GERMANY                   |   1997 | 4661044821.36938
 GERMANY                   |   1996 | 4684906781.98926
 GERMANY                   |   1995 |  4674778985.7657
 GERMANY                   |   1994 | 4645950414.69196
 GERMANY                   |   1993 | 4691564108.55531
 GERMANY                   |   1992 | 4705044332.85166
 INDIA                     |   1998 | 2745552983.25098
 INDIA                     |   1997 | 4679195473.40637
 INDIA                     |   1996 | 4664043710.06508
 INDIA                     |   1995 | 4672361803.91436
 INDIA                     |   1994 | 4682617064.98493
 INDIA                     |   1993 | 4689548932.71281
 INDIA                     |   1992 |  4696225839.0932
 INDONESIA                 |   1998 | 2711310834.71526
 INDONESIA                 |   1997 | 4626298779.51226
 INDONESIA                 |   1996 |  4634407574.8653
 INDONESIA                 |   1995 |  4615113223.6905
 INDONESIA                 |   1994 | 4615822911.88601
 INDONESIA                 |   1993 | 4621480325.00182
 INDONESIA                 |   1992 | 4649375542.01644
 IRAN                      |   1998 | 2735472198.59397
 IRAN                      |   1997 |  4669206496.7661
 IRAN                      |   1996 |  4670646229.7308
 IRAN                      |   1995 | 4672442743.78972
 IRAN                      |   1994 | 4672607551.97212
 IRAN                      |   1993 | 4667623255.86487
 IRAN                      |   1992 | 4685098493.95338
 IRAQ                      |   1998 | 2697334506.36749
 IRAQ                      |   1997 | 4631726477.71055
 IRAQ                      |   1996 | 4629417728.68198
 IRAQ                      |   1995 | 4628144609.39937
 IRAQ                      |   1994 | 4625285072.35333
 IRAQ                      |   1993 |  4624106729.6127
 IRAQ                      |   1992 | 4626969394.71554
 JAPAN                     |   1998 | 2738826011.59695
 JAPAN                     |   1997 | 4654854561.40116
 JAPAN                     |   1996 | 4662919863.74588
 JAPAN                     |   1995 | 4633933900.25415
 JAPAN                     |   1994 |  4649123267.5062
 JAPAN                     |   1993 | 4637307125.90761
 JAPAN                     |   1992 | 4643866399.27239
 JORDAN                    |   1998 | 2713316268.60828
 JORDAN                    |   1997 | 4630667411.49002
 JORDAN                    |   1996 | 4681923867.07935
 JORDAN                    |   1995 | 4658903777.98473
 JORDAN                    |   1994 | 4646553258.06001
 JORDAN                    |   1993 | 4635256619.58029
 JORDAN                    |   1992 | 4653047061.59201
 KENYA                     |   1998 | 2727734498.69616
 KENYA                     |   1997 | 4622983743.20994
 KENYA                     |   1996 | 4639684799.11284
 KENYA                     |   1995 |  4622751892.8014
 KENYA                     |   1994 | 4637662526.34888
 KENYA                     |   1993 | 4631788689.01669
 KENYA                     |   1992 | 4650236001.84604
 MOROCCO                   |   1998 | 2744431511.74631
 MOROCCO                   |   1997 | 4669888213.38066
 MOROCCO                   |   1996 | 4695479563.96652
 MOROCCO                   |   1995 | 4675526169.19718
 MOROCCO                   |   1994 | 4682773144.24592
 MOROCCO                   |   1993 | 4680356445.84273
 MOROCCO                   |   1992 | 4689755470.69642
 MOZAMBIQUE                |   1998 | 2727582539.12012
 MOZAMBIQUE                |   1997 | 4658661178.15056
 MOZAMBIQUE                |   1996 | 4652268524.33884
 MOZAMBIQUE                |   1995 | 4639509621.65346
 MOZAMBIQUE                |   1994 | 4650499453.93446
 MOZAMBIQUE                |   1993 | 4624580613.59628
 MOZAMBIQUE                |   1992 | 4669551009.38526
 PERU                      |   1998 | 2702463884.33974
 PERU                      |   1997 | 4630449536.00513
 PERU                      |   1996 | 4607228334.35764
 PERU                      |   1995 | 4611040222.36755
 PERU                      |   1994 | 4606277092.02706
 PERU                      |   1993 | 4614494650.92058
 PERU                      |   1992 | 4652555464.68634
 ROMANIA                   |   1998 | 2756597760.22472
 ROMANIA                   |   1997 | 4664152604.11922
 ROMANIA                   |   1996 | 4728733542.25881
 ROMANIA                   |   1995 | 4682774256.93697
 ROMANIA                   |   1994 |  4680144263.2092
 ROMANIA                   |   1993 | 4679409808.48703
 ROMANIA                   |   1992 | 4711722780.07778
 RUSSIA                    |   1998 | 2729560247.36754
 RUSSIA                    |   1997 | 4689540192.87491
 RUSSIA                    |   1996 | 4667993167.35056
 RUSSIA                    |   1995 | 4653750015.83419
 RUSSIA                    |   1994 | 4641550309.53409
 RUSSIA                    |   1993 | 4655648297.26993
 RUSSIA                    |   1992 | 4664487422.98366
 SAUDI ARABIA              |   1998 | 2718921182.84598
 SAUDI ARABIA              |   1997 | 4633859822.78606
 SAUDI ARABIA              |   1996 |  4662483512.4578
 SAUDI ARABIA              |   1995 | 4634439601.44802
 SAUDI ARABIA              |   1994 | 4644796934.69892
 SAUDI ARABIA              |   1993 | 4647226045.19137
 SAUDI ARABIA              |   1992 | 4653797795.06632
 UNITED KINGDOM            |   1998 | 2771745398.17895
 UNITED KINGDOM            |   1997 | 4714087712.17605
 UNITED KINGDOM            |   1996 | 4721668586.49182
 UNITED KINGDOM            |   1995 | 4694359402.39632
 UNITED KINGDOM            |   1994 | 4703240577.42758
 UNITED KINGDOM            |   1993 | 4718960291.85781
 UNITED KINGDOM            |   1992 | 4721623427.44191
 UNITED STATES             |   1998 | 2747241156.27257
 UNITED STATES             |   1997 | 4689858924.43021
 UNITED STATES             |   1996 | 4695405668.38554
 UNITED STATES             |   1995 | 4672060022.19067
 UNITED STATES             |   1994 |  4650710806.7089
 UNITED STATES             |   1993 | 4657613282.59341
 UNITED STATES             |   1992 | 4675426842.50624
 VIETNAM                   |   1998 | 2724972912.74262
 VIETNAM                   |   1997 | 4658841694.56656
 VIETNAM                   |   1996 |  4680215472.4655
 VIETNAM                   |   1995 | 4664944382.97054
 VIETNAM                   |   1994 | 4653604008.39117
 VIETNAM                   |   1993 | 4682078406.76252
 VIETNAM                   |   1992 | 4662803433.14574
(175 rows)

COMMIT;
COMMIT
