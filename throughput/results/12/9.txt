BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%firebrick%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  2733607943.3107
 ALGERIA                   |   1997 | 4670043577.18122
 ALGERIA                   |   1996 | 4677858490.12642
 ALGERIA                   |   1995 | 4688455891.99651
 ALGERIA                   |   1994 |  4679047650.2402
 ALGERIA                   |   1993 | 4684939574.96331
 ALGERIA                   |   1992 | 4677613087.94514
 ARGENTINA                 |   1998 |  2704182268.7968
 ARGENTINA                 |   1997 | 4654642347.91664
 ARGENTINA                 |   1996 | 4661823950.27981
 ARGENTINA                 |   1995 | 4656661498.32848
 ARGENTINA                 |   1994 | 4651782829.94362
 ARGENTINA                 |   1993 | 4666163762.47479
 ARGENTINA                 |   1992 | 4635908117.41967
 BRAZIL                    |   1998 | 2742574380.28926
 BRAZIL                    |   1997 | 4683398469.58193
 BRAZIL                    |   1996 | 4686308953.03535
 BRAZIL                    |   1995 | 4677684508.82743
 BRAZIL                    |   1994 | 4648007219.37186
 BRAZIL                    |   1993 | 4703065084.07946
 BRAZIL                    |   1992 | 4673196540.34907
 CANADA                    |   1998 |  2753153049.5393
 CANADA                    |   1997 | 4666819727.04464
 CANADA                    |   1996 | 4685711171.09051
 CANADA                    |   1995 | 4676411140.89425
 CANADA                    |   1994 |  4687147083.9772
 CANADA                    |   1993 | 4676323978.52322
 CANADA                    |   1992 | 4676789086.07284
 CHINA                     |   1998 | 2719890872.51954
 CHINA                     |   1997 |  4664949398.9108
 CHINA                     |   1996 | 4657425085.30981
 CHINA                     |   1995 | 4666316337.66168
 CHINA                     |   1994 | 4670349004.53274
 CHINA                     |   1993 | 4661064140.68512
 CHINA                     |   1992 | 4654330572.61914
 EGYPT                     |   1998 | 2735670494.35678
 EGYPT                     |   1997 | 4643822141.94364
 EGYPT                     |   1996 | 4656156663.25228
 EGYPT                     |   1995 | 4680706165.83416
 EGYPT                     |   1994 | 4651754612.65761
 EGYPT                     |   1993 | 4667093570.45996
 EGYPT                     |   1992 | 4685603941.09523
 ETHIOPIA                  |   1998 | 2770590824.96578
 ETHIOPIA                  |   1997 | 4714605138.54348
 ETHIOPIA                  |   1996 | 4744424840.59305
 ETHIOPIA                  |   1995 | 4710100835.03905
 ETHIOPIA                  |   1994 | 4726359411.99893
 ETHIOPIA                  |   1993 | 4724860933.04727
 ETHIOPIA                  |   1992 | 4708559115.88634
 FRANCE                    |   1998 | 2745864228.26716
 FRANCE                    |   1997 | 4724478355.13488
 FRANCE                    |   1996 |  4709940969.5064
 FRANCE                    |   1995 | 4690379287.83797
 FRANCE                    |   1994 |  4698958971.7553
 FRANCE                    |   1993 |  4694108601.1179
 FRANCE                    |   1992 | 4694522167.71474
 GERMANY                   |   1998 | 2738528699.51953
 GERMANY                   |   1997 | 4651504969.65491
 GERMANY                   |   1996 | 4660861916.14696
 GERMANY                   |   1995 | 4660468031.21397
 GERMANY                   |   1994 | 4666130553.34784
 GERMANY                   |   1993 | 4668192359.88608
 GERMANY                   |   1992 | 4691086511.72888
 INDIA                     |   1998 | 2723768685.90656
 INDIA                     |   1997 | 4658725106.75046
 INDIA                     |   1996 | 4686551630.16379
 INDIA                     |   1995 | 4658367244.98861
 INDIA                     |   1994 | 4675702036.75687
 INDIA                     |   1993 | 4665891039.37871
 INDIA                     |   1992 | 4688697366.00698
 INDONESIA                 |   1998 | 2725567542.71742
 INDONESIA                 |   1997 | 4640941714.80946
 INDONESIA                 |   1996 | 4607757423.07596
 INDONESIA                 |   1995 | 4618308478.13097
 INDONESIA                 |   1994 | 4611803356.55452
 INDONESIA                 |   1993 | 4630113767.91433
 INDONESIA                 |   1992 | 4627492510.21023
 IRAN                      |   1998 | 2716762377.42768
 IRAN                      |   1997 | 4662477089.97666
 IRAN                      |   1996 |  4686630252.4575
 IRAN                      |   1995 |  4664410353.6634
 IRAN                      |   1994 | 4648448179.02893
 IRAN                      |   1993 | 4675208717.18897
 IRAN                      |   1992 |  4677715491.3538
 IRAQ                      |   1998 | 2734994303.54565
 IRAQ                      |   1997 | 4675942420.73451
 IRAQ                      |   1996 | 4666003888.63244
 IRAQ                      |   1995 | 4632916735.32594
 IRAQ                      |   1994 | 4652760236.28504
 IRAQ                      |   1993 | 4644052497.23124
 IRAQ                      |   1992 | 4657411206.90874
 JAPAN                     |   1998 | 2749632949.39614
 JAPAN                     |   1997 | 4649506220.56526
 JAPAN                     |   1996 | 4671982536.28468
 JAPAN                     |   1995 | 4658693849.64605
 JAPAN                     |   1994 | 4666954912.11918
 JAPAN                     |   1993 |  4648644491.2888
 JAPAN                     |   1992 | 4659784865.25146
 JORDAN                    |   1998 | 2700795923.50704
 JORDAN                    |   1997 | 4641687353.10536
 JORDAN                    |   1996 | 4665525994.38912
 JORDAN                    |   1995 | 4638666926.65186
 JORDAN                    |   1994 | 4636949528.96745
 JORDAN                    |   1993 | 4631897928.07886
 JORDAN                    |   1992 | 4667070649.96498
 KENYA                     |   1998 | 2722430103.33438
 KENYA                     |   1997 | 4626221576.70736
 KENYA                     |   1996 | 4612014422.24593
 KENYA                     |   1995 | 4618000740.34301
 KENYA                     |   1994 | 4617463982.65634
 KENYA                     |   1993 | 4641072266.84394
 KENYA                     |   1992 |  4597000259.2535
 MOROCCO                   |   1998 | 2747104760.64346
 MOROCCO                   |   1997 | 4720469336.92892
 MOROCCO                   |   1996 | 4731250108.09931
 MOROCCO                   |   1995 |  4655520685.9538
 MOROCCO                   |   1994 | 4711387374.43323
 MOROCCO                   |   1993 | 4707742299.76742
 MOROCCO                   |   1992 | 4700951250.80896
 MOZAMBIQUE                |   1998 | 2735572376.67861
 MOZAMBIQUE                |   1997 |  4651311587.0652
 MOZAMBIQUE                |   1996 |  4686897412.9217
 MOZAMBIQUE                |   1995 | 4623983367.67879
 MOZAMBIQUE                |   1994 | 4624961700.55748
 MOZAMBIQUE                |   1993 | 4622221721.29471
 MOZAMBIQUE                |   1992 |  4655896573.4137
 PERU                      |   1998 | 2702521816.34509
 PERU                      |   1997 | 4635047987.47928
 PERU                      |   1996 | 4639548363.97722
 PERU                      |   1995 | 4620709898.41717
 PERU                      |   1994 | 4639639394.41267
 PERU                      |   1993 | 4666170370.81508
 PERU                      |   1992 | 4630978588.25541
 ROMANIA                   |   1998 | 2755064209.84187
 ROMANIA                   |   1997 | 4674805092.44796
 ROMANIA                   |   1996 | 4694718547.88257
 ROMANIA                   |   1995 | 4700474334.08107
 ROMANIA                   |   1994 | 4686887996.15608
 ROMANIA                   |   1993 | 4676631612.73929
 ROMANIA                   |   1992 | 4692601400.96404
 RUSSIA                    |   1998 | 2723839413.94392
 RUSSIA                    |   1997 | 4678935566.26462
 RUSSIA                    |   1996 | 4697981195.33974
 RUSSIA                    |   1995 | 4675955022.01892
 RUSSIA                    |   1994 |  4685182392.7746
 RUSSIA                    |   1993 | 4681122566.29725
 RUSSIA                    |   1992 | 4665071152.56684
 SAUDI ARABIA              |   1998 | 2725001483.83615
 SAUDI ARABIA              |   1997 | 4626733527.67175
 SAUDI ARABIA              |   1996 |  4682787014.6831
 SAUDI ARABIA              |   1995 | 4667705603.70145
 SAUDI ARABIA              |   1994 | 4654602844.54593
 SAUDI ARABIA              |   1993 | 4639583904.47415
 SAUDI ARABIA              |   1992 | 4665933324.33587
 UNITED KINGDOM            |   1998 | 2760625189.86332
 UNITED KINGDOM            |   1997 | 4721054558.68809
 UNITED KINGDOM            |   1996 | 4704500228.09588
 UNITED KINGDOM            |   1995 | 4688517417.08532
 UNITED KINGDOM            |   1994 | 4683689940.18701
 UNITED KINGDOM            |   1993 | 4663123214.90339
 UNITED KINGDOM            |   1992 | 4705062537.76106
 UNITED STATES             |   1998 | 2745377470.73391
 UNITED STATES             |   1997 | 4684900086.59549
 UNITED STATES             |   1996 | 4674291350.10378
 UNITED STATES             |   1995 | 4668626560.12825
 UNITED STATES             |   1994 | 4690707048.18988
 UNITED STATES             |   1993 | 4661964923.14854
 UNITED STATES             |   1992 | 4718533521.83725
 VIETNAM                   |   1998 | 2760451795.80385
 VIETNAM                   |   1997 | 4695599513.17309
 VIETNAM                   |   1996 | 4732339324.43076
 VIETNAM                   |   1995 | 4697217903.83099
 VIETNAM                   |   1994 | 4740088105.84107
 VIETNAM                   |   1993 | 4690886584.85061
 VIETNAM                   |   1992 | 4710975966.63219
(175 rows)

COMMIT;
COMMIT
