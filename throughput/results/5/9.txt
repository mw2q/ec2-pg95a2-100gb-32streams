BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%purple%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2734935418.11855
 ALGERIA                   |   1997 | 4679060643.22159
 ALGERIA                   |   1996 | 4662131915.08305
 ALGERIA                   |   1995 | 4663425050.18865
 ALGERIA                   |   1994 | 4675019293.76277
 ALGERIA                   |   1993 | 4672681782.77703
 ALGERIA                   |   1992 | 4657190811.67609
 ARGENTINA                 |   1998 | 2732567452.72087
 ARGENTINA                 |   1997 | 4650979700.14861
 ARGENTINA                 |   1996 | 4691021024.16667
 ARGENTINA                 |   1995 | 4662648384.02506
 ARGENTINA                 |   1994 | 4648684680.18751
 ARGENTINA                 |   1993 | 4667856601.21981
 ARGENTINA                 |   1992 | 4671107201.88014
 BRAZIL                    |   1998 | 2715154519.87083
 BRAZIL                    |   1997 | 4671766822.05555
 BRAZIL                    |   1996 | 4664085018.33989
 BRAZIL                    |   1995 |  4657465520.9066
 BRAZIL                    |   1994 | 4663868258.08601
 BRAZIL                    |   1993 | 4665801408.84732
 BRAZIL                    |   1992 | 4688307341.56058
 CANADA                    |   1998 | 2746028573.25581
 CANADA                    |   1997 |  4695502980.3192
 CANADA                    |   1996 | 4669336716.94862
 CANADA                    |   1995 | 4701576341.93946
 CANADA                    |   1994 | 4707510445.97752
 CANADA                    |   1993 |  4689171263.2019
 CANADA                    |   1992 | 4681363918.63074
 CHINA                     |   1998 | 2714361551.71897
 CHINA                     |   1997 | 4657343666.73964
 CHINA                     |   1996 | 4638716784.47742
 CHINA                     |   1995 |   4641724648.637
 CHINA                     |   1994 | 4634623882.61233
 CHINA                     |   1993 | 4625753220.79733
 CHINA                     |   1992 | 4679490397.46858
 EGYPT                     |   1998 |  2722991955.5163
 EGYPT                     |   1997 | 4665951722.26943
 EGYPT                     |   1996 | 4678851893.13583
 EGYPT                     |   1995 | 4663780572.13998
 EGYPT                     |   1994 |  4671020318.0912
 EGYPT                     |   1993 | 4665481993.92466
 EGYPT                     |   1992 | 4666893384.85477
 ETHIOPIA                  |   1998 |  2766428984.0058
 ETHIOPIA                  |   1997 | 4728778234.81087
 ETHIOPIA                  |   1996 | 4747322547.63459
 ETHIOPIA                  |   1995 |  4708929368.0319
 ETHIOPIA                  |   1994 | 4728968966.20159
 ETHIOPIA                  |   1993 |  4718107435.2477
 ETHIOPIA                  |   1992 | 4713789342.97961
 FRANCE                    |   1998 | 2732242683.27012
 FRANCE                    |   1997 | 4662956876.37168
 FRANCE                    |   1996 | 4668012890.39682
 FRANCE                    |   1995 | 4649860406.20308
 FRANCE                    |   1994 | 4635725588.67383
 FRANCE                    |   1993 | 4642133723.65064
 FRANCE                    |   1992 | 4674341049.55911
 GERMANY                   |   1998 | 2748431025.42909
 GERMANY                   |   1997 | 4697734352.54989
 GERMANY                   |   1996 | 4696646702.19667
 GERMANY                   |   1995 | 4659586441.21667
 GERMANY                   |   1994 | 4672870579.23125
 GERMANY                   |   1993 | 4673484545.04697
 GERMANY                   |   1992 | 4672294540.01679
 INDIA                     |   1998 | 2746364175.95157
 INDIA                     |   1997 | 4672450051.57931
 INDIA                     |   1996 |  4676074478.0267
 INDIA                     |   1995 | 4669088044.90034
 INDIA                     |   1994 | 4677632967.34992
 INDIA                     |   1993 | 4674857609.13956
 INDIA                     |   1992 | 4682095376.48225
 INDONESIA                 |   1998 | 2728389421.80404
 INDONESIA                 |   1997 | 4640252545.53231
 INDONESIA                 |   1996 | 4612827345.03974
 INDONESIA                 |   1995 | 4628412363.39554
 INDONESIA                 |   1994 | 4649538781.04838
 INDONESIA                 |   1993 | 4629563573.06027
 INDONESIA                 |   1992 | 4636199964.19289
 IRAN                      |   1998 | 2731983067.82042
 IRAN                      |   1997 | 4646640668.10106
 IRAN                      |   1996 | 4632983354.54512
 IRAN                      |   1995 | 4638708532.64306
 IRAN                      |   1994 | 4656394725.26381
 IRAN                      |   1993 | 4664226865.27893
 IRAN                      |   1992 | 4664923629.12749
 IRAQ                      |   1998 |   2711135568.034
 IRAQ                      |   1997 | 4623724941.64101
 IRAQ                      |   1996 | 4668246507.27407
 IRAQ                      |   1995 | 4640942449.07327
 IRAQ                      |   1994 | 4654462342.54455
 IRAQ                      |   1993 | 4651205667.75576
 IRAQ                      |   1992 | 4669344673.68704
 JAPAN                     |   1998 | 2714567731.55385
 JAPAN                     |   1997 | 4611965377.00885
 JAPAN                     |   1996 | 4625756760.27182
 JAPAN                     |   1995 | 4650575310.90894
 JAPAN                     |   1994 | 4632225363.60299
 JAPAN                     |   1993 |  4622806592.1589
 JAPAN                     |   1992 |   4646480619.288
 JORDAN                    |   1998 | 2749944742.14145
 JORDAN                    |   1997 | 4679736903.38013
 JORDAN                    |   1996 | 4695647216.23216
 JORDAN                    |   1995 | 4683365202.30272
 JORDAN                    |   1994 |   4673523740.584
 JORDAN                    |   1993 | 4685456267.03943
 JORDAN                    |   1992 | 4688863096.19182
 KENYA                     |   1998 |  2722334061.3984
 KENYA                     |   1997 | 4620281273.09595
 KENYA                     |   1996 | 4642580631.28294
 KENYA                     |   1995 | 4631256676.84418
 KENYA                     |   1994 | 4639416373.57069
 KENYA                     |   1993 | 4645990606.24386
 KENYA                     |   1992 | 4663549859.15978
 MOROCCO                   |   1998 | 2760775006.86701
 MOROCCO                   |   1997 | 4681724096.17754
 MOROCCO                   |   1996 | 4699669489.06991
 MOROCCO                   |   1995 | 4672895511.97096
 MOROCCO                   |   1994 | 4686355937.34766
 MOROCCO                   |   1993 | 4693071497.79363
 MOROCCO                   |   1992 | 4705510866.73907
 MOZAMBIQUE                |   1998 | 2747662215.63135
 MOZAMBIQUE                |   1997 | 4675926645.74595
 MOZAMBIQUE                |   1996 | 4686583781.90606
 MOZAMBIQUE                |   1995 |  4652096332.3464
 MOZAMBIQUE                |   1994 | 4656770925.64766
 MOZAMBIQUE                |   1993 | 4658113448.76228
 MOZAMBIQUE                |   1992 | 4665651039.98618
 PERU                      |   1998 | 2721514434.10956
 PERU                      |   1997 | 4638854248.93578
 PERU                      |   1996 |  4645560883.9203
 PERU                      |   1995 | 4632361553.29779
 PERU                      |   1994 | 4635835221.11963
 PERU                      |   1993 | 4630141859.06408
 PERU                      |   1992 | 4645645725.26235
 ROMANIA                   |   1998 | 2751503902.84494
 ROMANIA                   |   1997 |  4685672582.3693
 ROMANIA                   |   1996 |  4709439935.7226
 ROMANIA                   |   1995 | 4677909296.43023
 ROMANIA                   |   1994 | 4718402564.56058
 ROMANIA                   |   1993 | 4664317002.59814
 ROMANIA                   |   1992 | 4700803770.49402
 RUSSIA                    |   1998 |  2731950813.2638
 RUSSIA                    |   1997 |  4676390238.4827
 RUSSIA                    |   1996 |  4701388066.5229
 RUSSIA                    |   1995 |  4651510406.0616
 RUSSIA                    |   1994 | 4687853694.08253
 RUSSIA                    |   1993 | 4677500038.40083
 RUSSIA                    |   1992 | 4671872489.52447
 SAUDI ARABIA              |   1998 | 2728001461.15379
 SAUDI ARABIA              |   1997 | 4654565250.13533
 SAUDI ARABIA              |   1996 | 4665018158.79713
 SAUDI ARABIA              |   1995 | 4640209943.97566
 SAUDI ARABIA              |   1994 |  4670692792.6996
 SAUDI ARABIA              |   1993 | 4669739505.84825
 SAUDI ARABIA              |   1992 | 4675814482.04339
 UNITED KINGDOM            |   1998 | 2772947803.16678
 UNITED KINGDOM            |   1997 | 4714401344.05789
 UNITED KINGDOM            |   1996 | 4708683320.40024
 UNITED KINGDOM            |   1995 |   4676958112.282
 UNITED KINGDOM            |   1994 | 4710147797.84129
 UNITED KINGDOM            |   1993 | 4691469325.41831
 UNITED KINGDOM            |   1992 | 4717862043.34868
 UNITED STATES             |   1998 | 2729488075.06173
 UNITED STATES             |   1997 | 4664627495.60054
 UNITED STATES             |   1996 |   4684590746.975
 UNITED STATES             |   1995 |    4655501093.36
 UNITED STATES             |   1994 | 4670667227.98132
 UNITED STATES             |   1993 | 4673178969.33289
 UNITED STATES             |   1992 | 4682101082.95303
 VIETNAM                   |   1998 | 2734578038.44395
 VIETNAM                   |   1997 | 4701200875.06618
 VIETNAM                   |   1996 | 4727268946.33243
 VIETNAM                   |   1995 | 4714958907.09512
 VIETNAM                   |   1994 | 4691580199.83767
 VIETNAM                   |   1993 | 4693251105.98176
 VIETNAM                   |   1992 | 4720252712.47832
(175 rows)

COMMIT;
COMMIT
