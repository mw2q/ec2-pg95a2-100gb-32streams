BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%light%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2737000277.15089
 ALGERIA                   |   1997 | 4669791179.72769
 ALGERIA                   |   1996 | 4715254760.17845
 ALGERIA                   |   1995 | 4707933565.20898
 ALGERIA                   |   1994 | 4664034910.28184
 ALGERIA                   |   1993 | 4684245440.07185
 ALGERIA                   |   1992 | 4696557985.68771
 ARGENTINA                 |   1998 | 2712830087.28504
 ARGENTINA                 |   1997 | 4606241511.63942
 ARGENTINA                 |   1996 | 4662062272.98927
 ARGENTINA                 |   1995 | 4642028072.49813
 ARGENTINA                 |   1994 | 4659976889.21082
 ARGENTINA                 |   1993 | 4653660154.34562
 ARGENTINA                 |   1992 |  4643464835.4679
 BRAZIL                    |   1998 | 2723293715.67114
 BRAZIL                    |   1997 | 4689848417.00756
 BRAZIL                    |   1996 | 4666945608.95505
 BRAZIL                    |   1995 | 4652744103.87158
 BRAZIL                    |   1994 |  4652254233.0881
 BRAZIL                    |   1993 | 4643266828.30665
 BRAZIL                    |   1992 | 4663760660.43069
 CANADA                    |   1998 | 2755669839.83401
 CANADA                    |   1997 | 4671994863.77033
 CANADA                    |   1996 |  4699117016.1666
 CANADA                    |   1995 | 4697920878.70773
 CANADA                    |   1994 |  4682043300.4692
 CANADA                    |   1993 | 4683823237.87731
 CANADA                    |   1992 | 4713667587.35914
 CHINA                     |   1998 | 2747024149.75822
 CHINA                     |   1997 | 4663587739.06095
 CHINA                     |   1996 | 4682829908.33304
 CHINA                     |   1995 | 4670810714.51918
 CHINA                     |   1994 | 4672342035.25457
 CHINA                     |   1993 | 4656813440.21783
 CHINA                     |   1992 | 4656873427.58751
 EGYPT                     |   1998 | 2723764074.54203
 EGYPT                     |   1997 | 4669928891.34517
 EGYPT                     |   1996 | 4686847626.11661
 EGYPT                     |   1995 | 4655297062.31028
 EGYPT                     |   1994 | 4652148515.03666
 EGYPT                     |   1993 |  4651319222.1161
 EGYPT                     |   1992 | 4657083434.13411
 ETHIOPIA                  |   1998 | 2733363776.38438
 ETHIOPIA                  |   1997 | 4681344662.12565
 ETHIOPIA                  |   1996 |  4704261055.8934
 ETHIOPIA                  |   1995 |  4683071261.6864
 ETHIOPIA                  |   1994 | 4678652678.78764
 ETHIOPIA                  |   1993 | 4679885332.69755
 ETHIOPIA                  |   1992 | 4685738503.08098
 FRANCE                    |   1998 | 2748028332.36864
 FRANCE                    |   1997 | 4694031030.09258
 FRANCE                    |   1996 |  4704331938.0029
 FRANCE                    |   1995 | 4691067550.19581
 FRANCE                    |   1994 | 4699128601.97506
 FRANCE                    |   1993 | 4695020510.54385
 FRANCE                    |   1992 | 4696662821.06085
 GERMANY                   |   1998 | 2750255148.70571
 GERMANY                   |   1997 | 4698998781.01003
 GERMANY                   |   1996 | 4711656844.98089
 GERMANY                   |   1995 | 4682728219.57546
 GERMANY                   |   1994 | 4686581966.76012
 GERMANY                   |   1993 | 4670386923.51271
 GERMANY                   |   1992 |  4671780410.5079
 INDIA                     |   1998 | 2752304609.03229
 INDIA                     |   1997 | 4701302033.77589
 INDIA                     |   1996 | 4699025458.89386
 INDIA                     |   1995 | 4684363900.44725
 INDIA                     |   1994 | 4681901835.97899
 INDIA                     |   1993 | 4712177468.78517
 INDIA                     |   1992 | 4723946144.18636
 INDONESIA                 |   1998 |  2737852510.3221
 INDONESIA                 |   1997 | 4647090359.61723
 INDONESIA                 |   1996 | 4655385325.91844
 INDONESIA                 |   1995 | 4635666346.32865
 INDONESIA                 |   1994 |  4650145625.5695
 INDONESIA                 |   1993 | 4660965141.80319
 INDONESIA                 |   1992 | 4607675119.82267
 IRAN                      |   1998 | 2732387492.95245
 IRAN                      |   1997 | 4659872513.58714
 IRAN                      |   1996 |  4679630702.4251
 IRAN                      |   1995 | 4659728469.89686
 IRAN                      |   1994 |  4652129604.1634
 IRAN                      |   1993 | 4631292115.44575
 IRAN                      |   1992 | 4627022047.22996
 IRAQ                      |   1998 | 2726324289.00117
 IRAQ                      |   1997 | 4652347641.21463
 IRAQ                      |   1996 | 4682616692.47189
 IRAQ                      |   1995 | 4632029141.26382
 IRAQ                      |   1994 | 4652109387.69295
 IRAQ                      |   1993 | 4666674530.14394
 IRAQ                      |   1992 | 4675691797.53378
 JAPAN                     |   1998 | 2709271175.78845
 JAPAN                     |   1997 | 4616112104.58296
 JAPAN                     |   1996 | 4608875405.62619
 JAPAN                     |   1995 | 4635172067.86962
 JAPAN                     |   1994 | 4633536360.33589
 JAPAN                     |   1993 | 4631885094.10277
 JAPAN                     |   1992 | 4628709148.82072
 JORDAN                    |   1998 | 2728473677.18191
 JORDAN                    |   1997 | 4649800966.41717
 JORDAN                    |   1996 | 4692592572.30864
 JORDAN                    |   1995 |  4652601037.0192
 JORDAN                    |   1994 | 4664455895.03959
 JORDAN                    |   1993 | 4671482747.06513
 JORDAN                    |   1992 | 4672381052.53894
 KENYA                     |   1998 | 2720007320.68657
 KENYA                     |   1997 | 4660405868.20792
 KENYA                     |   1996 | 4676096158.40597
 KENYA                     |   1995 | 4650112082.97479
 KENYA                     |   1994 | 4643357527.90653
 KENYA                     |   1993 | 4641159722.00798
 KENYA                     |   1992 | 4647672836.64557
 MOROCCO                   |   1998 | 2736543400.62437
 MOROCCO                   |   1997 | 4660295397.35254
 MOROCCO                   |   1996 | 4672562378.19347
 MOROCCO                   |   1995 | 4684976424.03666
 MOROCCO                   |   1994 | 4666116387.53962
 MOROCCO                   |   1993 | 4676451199.93854
 MOROCCO                   |   1992 | 4674996151.95021
 MOZAMBIQUE                |   1998 | 2738982551.26926
 MOZAMBIQUE                |   1997 | 4670586393.47981
 MOZAMBIQUE                |   1996 |  4656926013.0276
 MOZAMBIQUE                |   1995 | 4669531794.32696
 MOZAMBIQUE                |   1994 |  4650728199.1907
 MOZAMBIQUE                |   1993 | 4639485491.91245
 MOZAMBIQUE                |   1992 | 4659365622.97721
 PERU                      |   1998 | 2720700682.23443
 PERU                      |   1997 | 4639360217.65751
 PERU                      |   1996 | 4624799319.30837
 PERU                      |   1995 |  4641526990.6638
 PERU                      |   1994 | 4643919444.12903
 PERU                      |   1993 | 4622801198.19966
 PERU                      |   1992 | 4637290541.46608
 ROMANIA                   |   1998 | 2742277533.11223
 ROMANIA                   |   1997 | 4661560255.98187
 ROMANIA                   |   1996 | 4674675173.81705
 ROMANIA                   |   1995 |  4656442526.7412
 ROMANIA                   |   1994 | 4658435364.17083
 ROMANIA                   |   1993 | 4665769378.43424
 ROMANIA                   |   1992 | 4675379793.74655
 RUSSIA                    |   1998 | 2731466178.95368
 RUSSIA                    |   1997 | 4680792539.96818
 RUSSIA                    |   1996 | 4676819211.63429
 RUSSIA                    |   1995 |  4655417483.9312
 RUSSIA                    |   1994 | 4671673388.01756
 RUSSIA                    |   1993 | 4660840315.47583
 RUSSIA                    |   1992 | 4718601030.21663
 SAUDI ARABIA              |   1998 |  2707539369.7701
 SAUDI ARABIA              |   1997 | 4638612362.83994
 SAUDI ARABIA              |   1996 | 4670343005.11802
 SAUDI ARABIA              |   1995 | 4634743651.43381
 SAUDI ARABIA              |   1994 |  4639215586.0345
 SAUDI ARABIA              |   1993 | 4652745558.07289
 SAUDI ARABIA              |   1992 | 4660930812.43449
 UNITED KINGDOM            |   1998 | 2748094530.77406
 UNITED KINGDOM            |   1997 | 4673033137.51794
 UNITED KINGDOM            |   1996 | 4693197329.03441
 UNITED KINGDOM            |   1995 | 4690265607.87675
 UNITED KINGDOM            |   1994 | 4673580693.15727
 UNITED KINGDOM            |   1993 | 4668864911.92145
 UNITED KINGDOM            |   1992 |  4689518877.8868
 UNITED STATES             |   1998 | 2716457892.02718
 UNITED STATES             |   1997 | 4671222054.26912
 UNITED STATES             |   1996 | 4693269334.86923
 UNITED STATES             |   1995 | 4651597813.32027
 UNITED STATES             |   1994 | 4687948149.73519
 UNITED STATES             |   1993 | 4680923113.37709
 UNITED STATES             |   1992 |  4689251732.3272
 VIETNAM                   |   1998 | 2758295153.70407
 VIETNAM                   |   1997 |  4647478378.7354
 VIETNAM                   |   1996 | 4672755914.81171
 VIETNAM                   |   1995 | 4684420522.10805
 VIETNAM                   |   1994 | 4677418343.86258
 VIETNAM                   |   1993 | 4683903328.43486
 VIETNAM                   |   1992 | 4653270528.72579
(175 rows)

COMMIT;
COMMIT
