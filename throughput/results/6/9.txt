BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%peach%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  2763389468.6827
 ALGERIA                   |   1997 | 4670336150.22812
 ALGERIA                   |   1996 | 4714988234.39673
 ALGERIA                   |   1995 | 4675315666.26735
 ALGERIA                   |   1994 | 4692629369.15298
 ALGERIA                   |   1993 | 4657291800.21352
 ALGERIA                   |   1992 | 4678871279.55941
 ARGENTINA                 |   1998 | 2706229818.05255
 ARGENTINA                 |   1997 | 4635003141.58283
 ARGENTINA                 |   1996 | 4616524741.18945
 ARGENTINA                 |   1995 | 4605294702.87932
 ARGENTINA                 |   1994 | 4600453172.98175
 ARGENTINA                 |   1993 | 4628590990.49665
 ARGENTINA                 |   1992 | 4662968045.43962
 BRAZIL                    |   1998 | 2735976092.53512
 BRAZIL                    |   1997 | 4644798356.18667
 BRAZIL                    |   1996 |  4662657886.4002
 BRAZIL                    |   1995 | 4646621078.41884
 BRAZIL                    |   1994 | 4623988003.77564
 BRAZIL                    |   1993 | 4649469339.28988
 BRAZIL                    |   1992 | 4687531476.48953
 CANADA                    |   1998 | 2755912554.84678
 CANADA                    |   1997 | 4674726708.97167
 CANADA                    |   1996 | 4680189226.55327
 CANADA                    |   1995 | 4673534750.27326
 CANADA                    |   1994 | 4689804136.30543
 CANADA                    |   1993 | 4694031782.52519
 CANADA                    |   1992 | 4685546568.81254
 CHINA                     |   1998 | 2736917015.47717
 CHINA                     |   1997 | 4702101814.07612
 CHINA                     |   1996 | 4705902370.61206
 CHINA                     |   1995 | 4675231271.80035
 CHINA                     |   1994 | 4683856223.69752
 CHINA                     |   1993 | 4663325869.16045
 CHINA                     |   1992 |  4685692466.3374
 EGYPT                     |   1998 | 2732765109.31353
 EGYPT                     |   1997 | 4671321784.52596
 EGYPT                     |   1996 | 4700242278.42302
 EGYPT                     |   1995 | 4676801953.80287
 EGYPT                     |   1994 | 4663220301.07698
 EGYPT                     |   1993 | 4685065058.83306
 EGYPT                     |   1992 | 4692125275.76851
 ETHIOPIA                  |   1998 | 2752325206.47699
 ETHIOPIA                  |   1997 | 4708740661.14848
 ETHIOPIA                  |   1996 | 4713614456.11998
 ETHIOPIA                  |   1995 | 4731568351.51746
 ETHIOPIA                  |   1994 | 4719594362.54087
 ETHIOPIA                  |   1993 | 4682851024.20988
 ETHIOPIA                  |   1992 | 4717707553.14624
 FRANCE                    |   1998 | 2717517036.31775
 FRANCE                    |   1997 | 4633813686.03985
 FRANCE                    |   1996 | 4684903776.93151
 FRANCE                    |   1995 | 4637563664.86115
 FRANCE                    |   1994 | 4651773103.23018
 FRANCE                    |   1993 | 4648956866.79813
 FRANCE                    |   1992 |  4645626507.6455
 GERMANY                   |   1998 | 2723351260.82657
 GERMANY                   |   1997 | 4687468695.34152
 GERMANY                   |   1996 | 4701220877.55173
 GERMANY                   |   1995 | 4670378353.98006
 GERMANY                   |   1994 | 4652574823.16826
 GERMANY                   |   1993 |  4689551121.9271
 GERMANY                   |   1992 | 4698992779.48692
 INDIA                     |   1998 | 2760247511.27639
 INDIA                     |   1997 |  4707790295.5343
 INDIA                     |   1996 | 4695208904.66338
 INDIA                     |   1995 | 4686332667.97519
 INDIA                     |   1994 | 4691506947.33159
 INDIA                     |   1993 | 4684569712.09859
 INDIA                     |   1992 | 4721716396.11462
 INDONESIA                 |   1998 | 2738863138.05167
 INDONESIA                 |   1997 | 4648715141.30699
 INDONESIA                 |   1996 | 4644154457.45113
 INDONESIA                 |   1995 | 4647119163.27493
 INDONESIA                 |   1994 | 4668368366.95183
 INDONESIA                 |   1993 | 4615203614.06749
 INDONESIA                 |   1992 | 4634046482.05362
 IRAN                      |   1998 | 2724187784.80944
 IRAN                      |   1997 | 4662916029.67359
 IRAN                      |   1996 | 4652809273.50356
 IRAN                      |   1995 | 4658629495.94015
 IRAN                      |   1994 |  4644444625.0141
 IRAN                      |   1993 | 4655740630.36794
 IRAN                      |   1992 | 4653489462.49267
 IRAQ                      |   1998 | 2722203360.29159
 IRAQ                      |   1997 | 4650816150.10603
 IRAQ                      |   1996 | 4675286428.85915
 IRAQ                      |   1995 | 4648668507.12163
 IRAQ                      |   1994 | 4664388142.80751
 IRAQ                      |   1993 | 4671282097.72536
 IRAQ                      |   1992 | 4654445649.07145
 JAPAN                     |   1998 | 2709013857.60944
 JAPAN                     |   1997 | 4601892253.79211
 JAPAN                     |   1996 | 4613010426.53351
 JAPAN                     |   1995 |  4625422754.1307
 JAPAN                     |   1994 | 4636078101.53965
 JAPAN                     |   1993 | 4619140165.02654
 JAPAN                     |   1992 | 4644217976.27857
 JORDAN                    |   1998 | 2745457191.62354
 JORDAN                    |   1997 | 4684670875.95129
 JORDAN                    |   1996 | 4678276986.29767
 JORDAN                    |   1995 | 4679852308.16613
 JORDAN                    |   1994 | 4637839507.61487
 JORDAN                    |   1993 | 4662803597.25175
 JORDAN                    |   1992 | 4657351314.97221
 KENYA                     |   1998 | 2730434533.20202
 KENYA                     |   1997 | 4622666470.34792
 KENYA                     |   1996 | 4644615116.39641
 KENYA                     |   1995 | 4625215373.12194
 KENYA                     |   1994 | 4627039649.46714
 KENYA                     |   1993 | 4609362138.12123
 KENYA                     |   1992 | 4631260303.89044
 MOROCCO                   |   1998 | 2760837520.13169
 MOROCCO                   |   1997 | 4704865995.14569
 MOROCCO                   |   1996 | 4691999840.46982
 MOROCCO                   |   1995 | 4696156506.44344
 MOROCCO                   |   1994 | 4723144586.62017
 MOROCCO                   |   1993 | 4683296418.12541
 MOROCCO                   |   1992 | 4704679742.34435
 MOZAMBIQUE                |   1998 | 2732483181.87296
 MOZAMBIQUE                |   1997 |  4674878164.5745
 MOZAMBIQUE                |   1996 | 4716992842.24378
 MOZAMBIQUE                |   1995 | 4695647515.48305
 MOZAMBIQUE                |   1994 | 4695861409.00384
 MOZAMBIQUE                |   1993 | 4692716158.45666
 MOZAMBIQUE                |   1992 | 4729501007.83351
 PERU                      |   1998 | 2724445624.28938
 PERU                      |   1997 | 4623447878.41393
 PERU                      |   1996 | 4660268144.99594
 PERU                      |   1995 | 4630918945.56043
 PERU                      |   1994 | 4644172780.92575
 PERU                      |   1993 | 4622587312.14636
 PERU                      |   1992 | 4670433427.19047
 ROMANIA                   |   1998 | 2742147644.02186
 ROMANIA                   |   1997 | 4661535715.62011
 ROMANIA                   |   1996 | 4644828551.04777
 ROMANIA                   |   1995 | 4674002383.34943
 ROMANIA                   |   1994 |  4677314842.5249
 ROMANIA                   |   1993 | 4660637896.05832
 ROMANIA                   |   1992 | 4667936082.82898
 RUSSIA                    |   1998 | 2713953718.73093
 RUSSIA                    |   1997 | 4648843951.95118
 RUSSIA                    |   1996 | 4679105079.12478
 RUSSIA                    |   1995 | 4680994544.89294
 RUSSIA                    |   1994 | 4665690105.32744
 RUSSIA                    |   1993 |    4676960396.81
 RUSSIA                    |   1992 | 4695038778.96734
 SAUDI ARABIA              |   1998 | 2728251493.56054
 SAUDI ARABIA              |   1997 | 4625482488.18083
 SAUDI ARABIA              |   1996 | 4659388062.87059
 SAUDI ARABIA              |   1995 | 4646425457.28936
 SAUDI ARABIA              |   1994 | 4664067220.07466
 SAUDI ARABIA              |   1993 | 4654607762.95049
 SAUDI ARABIA              |   1992 | 4663674738.13006
 UNITED KINGDOM            |   1998 | 2754216642.22879
 UNITED KINGDOM            |   1997 | 4675494769.90929
 UNITED KINGDOM            |   1996 | 4677933012.84992
 UNITED KINGDOM            |   1995 | 4687234344.77597
 UNITED KINGDOM            |   1994 | 4676317476.78899
 UNITED KINGDOM            |   1993 |  4668596160.0792
 UNITED KINGDOM            |   1992 | 4688878552.42799
 UNITED STATES             |   1998 | 2766176719.69101
 UNITED STATES             |   1997 | 4686952579.36096
 UNITED STATES             |   1996 | 4714580099.82161
 UNITED STATES             |   1995 | 4673989730.51032
 UNITED STATES             |   1994 | 4707554836.09841
 UNITED STATES             |   1993 | 4687510524.89197
 UNITED STATES             |   1992 | 4689950889.46792
 VIETNAM                   |   1998 | 2755840361.04623
 VIETNAM                   |   1997 | 4680322936.20398
 VIETNAM                   |   1996 | 4693612930.98107
 VIETNAM                   |   1995 | 4693157572.71087
 VIETNAM                   |   1994 | 4705818653.14071
 VIETNAM                   |   1993 | 4695506041.34395
 VIETNAM                   |   1992 | 4703168433.69208
(175 rows)

COMMIT;
COMMIT
