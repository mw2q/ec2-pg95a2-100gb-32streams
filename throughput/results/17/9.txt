BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%violet%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2737126231.07892
 ALGERIA                   |   1997 |  4652831290.2195
 ALGERIA                   |   1996 | 4656151505.70321
 ALGERIA                   |   1995 |  4660615852.4612
 ALGERIA                   |   1994 |  4642998049.6352
 ALGERIA                   |   1993 | 4629537951.64936
 ALGERIA                   |   1992 | 4646112525.92831
 ARGENTINA                 |   1998 | 2714171006.94317
 ARGENTINA                 |   1997 | 4655486678.96063
 ARGENTINA                 |   1996 | 4648253996.23921
 ARGENTINA                 |   1995 | 4646999984.76394
 ARGENTINA                 |   1994 | 4662219123.58309
 ARGENTINA                 |   1993 | 4667799095.59418
 ARGENTINA                 |   1992 |  4668815078.8672
 BRAZIL                    |   1998 | 2769602707.30227
 BRAZIL                    |   1997 | 4669949402.97747
 BRAZIL                    |   1996 | 4685551548.80154
 BRAZIL                    |   1995 | 4665810139.38571
 BRAZIL                    |   1994 | 4687544543.43457
 BRAZIL                    |   1993 | 4716518244.97327
 BRAZIL                    |   1992 | 4694154731.27209
 CANADA                    |   1998 | 2754270291.09728
 CANADA                    |   1997 | 4699475764.18609
 CANADA                    |   1996 | 4728044139.43912
 CANADA                    |   1995 | 4707266587.08158
 CANADA                    |   1994 | 4707505455.61322
 CANADA                    |   1993 | 4720171886.54208
 CANADA                    |   1992 | 4726332816.77384
 CHINA                     |   1998 | 2704743306.22742
 CHINA                     |   1997 | 4648742311.00381
 CHINA                     |   1996 | 4679334113.05042
 CHINA                     |   1995 | 4675084267.90671
 CHINA                     |   1994 | 4654367346.01389
 CHINA                     |   1993 | 4647503047.29821
 CHINA                     |   1992 | 4669060929.41383
 EGYPT                     |   1998 | 2726857751.27318
 EGYPT                     |   1997 |  4670679589.4207
 EGYPT                     |   1996 | 4667706633.05884
 EGYPT                     |   1995 | 4683480599.84528
 EGYPT                     |   1994 | 4640923726.77486
 EGYPT                     |   1993 | 4682202482.71226
 EGYPT                     |   1992 | 4691012374.94121
 ETHIOPIA                  |   1998 | 2767555902.71122
 ETHIOPIA                  |   1997 | 4712155929.98215
 ETHIOPIA                  |   1996 | 4746921793.00842
 ETHIOPIA                  |   1995 | 4711362197.39384
 ETHIOPIA                  |   1994 |  4733567912.0296
 ETHIOPIA                  |   1993 | 4715850865.57566
 ETHIOPIA                  |   1992 | 4719275704.23173
 FRANCE                    |   1998 |  2741198946.0745
 FRANCE                    |   1997 | 4666380789.54302
 FRANCE                    |   1996 | 4680017741.58375
 FRANCE                    |   1995 | 4679657402.25466
 FRANCE                    |   1994 | 4672668064.19931
 FRANCE                    |   1993 | 4657416040.42795
 FRANCE                    |   1992 | 4686050172.29064
 GERMANY                   |   1998 | 2786138051.75803
 GERMANY                   |   1997 | 4702734453.71585
 GERMANY                   |   1996 | 4738266561.04486
 GERMANY                   |   1995 | 4723693962.86693
 GERMANY                   |   1994 | 4715198008.68892
 GERMANY                   |   1993 | 4724333699.79584
 GERMANY                   |   1992 | 4736578358.67407
 INDIA                     |   1998 | 2754539613.03231
 INDIA                     |   1997 | 4666504371.00838
 INDIA                     |   1996 | 4670569215.85478
 INDIA                     |   1995 | 4646708305.13865
 INDIA                     |   1994 | 4672080029.51183
 INDIA                     |   1993 | 4672342570.39049
 INDIA                     |   1992 | 4672482888.42756
 INDONESIA                 |   1998 |  2735660597.8733
 INDONESIA                 |   1997 | 4679280363.27623
 INDONESIA                 |   1996 | 4669079562.15706
 INDONESIA                 |   1995 | 4668684555.44919
 INDONESIA                 |   1994 | 4650265554.20156
 INDONESIA                 |   1993 | 4651766155.79149
 INDONESIA                 |   1992 | 4659272083.72074
 IRAN                      |   1998 | 2709385896.37523
 IRAN                      |   1997 | 4652463182.56382
 IRAN                      |   1996 | 4649288313.19854
 IRAN                      |   1995 | 4626400583.28167
 IRAN                      |   1994 | 4624158443.25209
 IRAN                      |   1993 | 4634757058.44819
 IRAN                      |   1992 | 4639284260.09605
 IRAQ                      |   1998 | 2713898540.93369
 IRAQ                      |   1997 | 4654562288.50036
 IRAQ                      |   1996 | 4662235350.99934
 IRAQ                      |   1995 | 4632599581.39857
 IRAQ                      |   1994 | 4662882821.68144
 IRAQ                      |   1993 | 4648629214.92827
 IRAQ                      |   1992 | 4656374719.08825
 JAPAN                     |   1998 |  2726990791.3124
 JAPAN                     |   1997 | 4662477033.99276
 JAPAN                     |   1996 | 4670962602.48359
 JAPAN                     |   1995 | 4664604304.09269
 JAPAN                     |   1994 | 4683975930.99885
 JAPAN                     |   1993 | 4657228566.57661
 JAPAN                     |   1992 |  4673165278.9963
 JORDAN                    |   1998 |  2750917556.2587
 JORDAN                    |   1997 | 4686349421.28737
 JORDAN                    |   1996 | 4702141000.40689
 JORDAN                    |   1995 | 4692888168.58565
 JORDAN                    |   1994 | 4673746417.16239
 JORDAN                    |   1993 | 4699744486.60828
 JORDAN                    |   1992 |  4691637558.8838
 KENYA                     |   1998 | 2717709053.47427
 KENYA                     |   1997 |  4618372975.8549
 KENYA                     |   1996 | 4650366327.21341
 KENYA                     |   1995 | 4618592108.16038
 KENYA                     |   1994 | 4636095770.94078
 KENYA                     |   1993 | 4625369523.07562
 KENYA                     |   1992 | 4632197476.61377
 MOROCCO                   |   1998 | 2740833424.12385
 MOROCCO                   |   1997 | 4694230840.03064
 MOROCCO                   |   1996 | 4715406260.95996
 MOROCCO                   |   1995 |  4669718400.1079
 MOROCCO                   |   1994 | 4656621853.32803
 MOROCCO                   |   1993 | 4671927114.84187
 MOROCCO                   |   1992 | 4712709480.06468
 MOZAMBIQUE                |   1998 | 2750486048.94777
 MOZAMBIQUE                |   1997 | 4677923611.79573
 MOZAMBIQUE                |   1996 | 4696674493.31909
 MOZAMBIQUE                |   1995 | 4648895104.08196
 MOZAMBIQUE                |   1994 | 4663096371.04831
 MOZAMBIQUE                |   1993 |  4668282661.0351
 MOZAMBIQUE                |   1992 |  4695259685.4361
 PERU                      |   1998 | 2710236107.25187
 PERU                      |   1997 | 4621047239.90611
 PERU                      |   1996 |   4656074632.477
 PERU                      |   1995 | 4630433503.13328
 PERU                      |   1994 | 4634578007.15864
 PERU                      |   1993 | 4640382026.95796
 PERU                      |   1992 |   4663768296.258
 ROMANIA                   |   1998 | 2746610281.50667
 ROMANIA                   |   1997 | 4706672111.88177
 ROMANIA                   |   1996 | 4710646058.95753
 ROMANIA                   |   1995 | 4685663935.53409
 ROMANIA                   |   1994 | 4714377703.88125
 ROMANIA                   |   1993 | 4708751116.16695
 ROMANIA                   |   1992 | 4719324790.25101
 RUSSIA                    |   1998 | 2736528621.32484
 RUSSIA                    |   1997 | 4670115930.94361
 RUSSIA                    |   1996 | 4680365415.16081
 RUSSIA                    |   1995 | 4661245473.60016
 RUSSIA                    |   1994 | 4676195101.90486
 RUSSIA                    |   1993 | 4653202500.91725
 RUSSIA                    |   1992 | 4665176825.05848
 SAUDI ARABIA              |   1998 | 2756026152.11873
 SAUDI ARABIA              |   1997 | 4683782341.39185
 SAUDI ARABIA              |   1996 | 4679053407.54101
 SAUDI ARABIA              |   1995 |    4685045027.67
 SAUDI ARABIA              |   1994 | 4658700530.47979
 SAUDI ARABIA              |   1993 |  4662580779.2174
 SAUDI ARABIA              |   1992 |  4697364644.4367
 UNITED KINGDOM            |   1998 | 2750343064.95687
 UNITED KINGDOM            |   1997 | 4732743947.85331
 UNITED KINGDOM            |   1996 | 4725838620.22379
 UNITED KINGDOM            |   1995 | 4716659983.31292
 UNITED KINGDOM            |   1994 | 4743741018.57502
 UNITED KINGDOM            |   1993 | 4682466763.25435
 UNITED KINGDOM            |   1992 | 4746825989.39405
 UNITED STATES             |   1998 | 2739384212.18903
 UNITED STATES             |   1997 | 4675451432.65469
 UNITED STATES             |   1996 |  4706070602.2291
 UNITED STATES             |   1995 | 4659751702.41521
 UNITED STATES             |   1994 | 4682575527.26905
 UNITED STATES             |   1993 | 4672815571.78482
 UNITED STATES             |   1992 | 4684155296.40736
 VIETNAM                   |   1998 | 2756070486.10683
 VIETNAM                   |   1997 | 4690908884.39233
 VIETNAM                   |   1996 | 4695071926.46578
 VIETNAM                   |   1995 | 4682482541.31865
 VIETNAM                   |   1994 | 4712531671.60496
 VIETNAM                   |   1993 | 4704134757.96281
 VIETNAM                   |   1992 | 4703398829.76059
(175 rows)

COMMIT;
COMMIT
