BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%tomato%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2745846333.67483
 ALGERIA                   |   1997 | 4639851314.54984
 ALGERIA                   |   1996 | 4688304279.49952
 ALGERIA                   |   1995 | 4667494154.17777
 ALGERIA                   |   1994 | 4669812674.25762
 ALGERIA                   |   1993 | 4678792593.05352
 ALGERIA                   |   1992 | 4689281174.46875
 ARGENTINA                 |   1998 | 2723161418.60174
 ARGENTINA                 |   1997 | 4673120365.46243
 ARGENTINA                 |   1996 |  4657597612.3201
 ARGENTINA                 |   1995 | 4647089694.06944
 ARGENTINA                 |   1994 | 4645935347.84275
 ARGENTINA                 |   1993 | 4651083028.00679
 ARGENTINA                 |   1992 | 4672563372.68465
 BRAZIL                    |   1998 | 2770780990.07967
 BRAZIL                    |   1997 | 4694622851.77981
 BRAZIL                    |   1996 | 4713476619.78319
 BRAZIL                    |   1995 | 4669351282.79579
 BRAZIL                    |   1994 | 4687280114.65471
 BRAZIL                    |   1993 |  4677499534.5121
 BRAZIL                    |   1992 | 4717755431.55737
 CANADA                    |   1998 | 2770648105.83282
 CANADA                    |   1997 | 4715005691.13388
 CANADA                    |   1996 |  4704828687.1724
 CANADA                    |   1995 | 4733942864.59243
 CANADA                    |   1994 | 4687136405.82516
 CANADA                    |   1993 | 4696518948.83426
 CANADA                    |   1992 | 4725810521.30433
 CHINA                     |   1998 | 2734589636.89503
 CHINA                     |   1997 |  4657573002.9115
 CHINA                     |   1996 |  4678632801.8123
 CHINA                     |   1995 | 4676159795.91595
 CHINA                     |   1994 | 4700877565.14737
 CHINA                     |   1993 | 4670315891.08997
 CHINA                     |   1992 | 4683175388.08763
 EGYPT                     |   1998 | 2718585488.47711
 EGYPT                     |   1997 | 4633813301.83726
 EGYPT                     |   1996 |   4673790855.287
 EGYPT                     |   1995 | 4663419728.73703
 EGYPT                     |   1994 | 4661127589.70776
 EGYPT                     |   1993 | 4664462349.63724
 EGYPT                     |   1992 | 4688524462.73979
 ETHIOPIA                  |   1998 | 2771165135.01671
 ETHIOPIA                  |   1997 | 4718927903.38829
 ETHIOPIA                  |   1996 | 4741325820.33023
 ETHIOPIA                  |   1995 | 4693799717.20498
 ETHIOPIA                  |   1994 | 4742675752.91611
 ETHIOPIA                  |   1993 | 4720192270.19476
 ETHIOPIA                  |   1992 | 4722914784.24428
 FRANCE                    |   1998 | 2715641217.83716
 FRANCE                    |   1997 |  4652798497.7281
 FRANCE                    |   1996 | 4677174044.77075
 FRANCE                    |   1995 | 4647447016.77428
 FRANCE                    |   1994 | 4653283197.82885
 FRANCE                    |   1993 | 4645644317.96395
 FRANCE                    |   1992 | 4665984426.50161
 GERMANY                   |   1998 |  2762900565.4088
 GERMANY                   |   1997 |  4718438956.9276
 GERMANY                   |   1996 | 4721022873.82223
 GERMANY                   |   1995 | 4702430920.28641
 GERMANY                   |   1994 | 4712484832.64873
 GERMANY                   |   1993 | 4709767121.93866
 GERMANY                   |   1992 | 4712069341.71885
 INDIA                     |   1998 | 2741814145.00741
 INDIA                     |   1997 | 4649970345.48015
 INDIA                     |   1996 | 4696177399.75484
 INDIA                     |   1995 | 4686120093.77699
 INDIA                     |   1994 | 4667219497.05984
 INDIA                     |   1993 | 4686743430.06822
 INDIA                     |   1992 | 4687768801.90269
 INDONESIA                 |   1998 | 2715653513.49203
 INDONESIA                 |   1997 | 4659678758.61483
 INDONESIA                 |   1996 | 4660853896.47273
 INDONESIA                 |   1995 | 4685287768.81065
 INDONESIA                 |   1994 | 4650275162.46311
 INDONESIA                 |   1993 | 4683963879.81767
 INDONESIA                 |   1992 | 4668627781.12331
 IRAN                      |   1998 | 2711290856.50738
 IRAN                      |   1997 | 4638555598.54204
 IRAN                      |   1996 | 4655641166.14387
 IRAN                      |   1995 | 4646738592.04295
 IRAN                      |   1994 | 4639357706.26569
 IRAN                      |   1993 | 4650050461.30306
 IRAN                      |   1992 | 4657530528.56019
 IRAQ                      |   1998 | 2736586901.20953
 IRAQ                      |   1997 | 4666806896.24764
 IRAQ                      |   1996 | 4677756847.90947
 IRAQ                      |   1995 | 4666547555.24745
 IRAQ                      |   1994 | 4671011253.12079
 IRAQ                      |   1993 | 4643082035.76758
 IRAQ                      |   1992 | 4712658092.79989
 JAPAN                     |   1998 | 2698115732.21948
 JAPAN                     |   1997 | 4635334939.43528
 JAPAN                     |   1996 | 4625501810.25241
 JAPAN                     |   1995 | 4614720506.11115
 JAPAN                     |   1994 | 4634679449.51131
 JAPAN                     |   1993 | 4616169604.55189
 JAPAN                     |   1992 | 4649525991.26209
 JORDAN                    |   1998 | 2723671957.50041
 JORDAN                    |   1997 | 4678079398.41966
 JORDAN                    |   1996 | 4694860618.04747
 JORDAN                    |   1995 | 4677531733.04925
 JORDAN                    |   1994 | 4644503098.64369
 JORDAN                    |   1993 | 4675146930.63563
 JORDAN                    |   1992 | 4696909571.59762
 KENYA                     |   1998 | 2711055137.72079
 KENYA                     |   1997 | 4640281806.33466
 KENYA                     |   1996 | 4655278976.16511
 KENYA                     |   1995 |  4635981100.8547
 KENYA                     |   1994 | 4643226229.28804
 KENYA                     |   1993 | 4623576079.05026
 KENYA                     |   1992 | 4637265127.72225
 MOROCCO                   |   1998 | 2723134268.66722
 MOROCCO                   |   1997 | 4708187966.83389
 MOROCCO                   |   1996 |  4718513731.7782
 MOROCCO                   |   1995 |  4704687869.8815
 MOROCCO                   |   1994 | 4681677450.93438
 MOROCCO                   |   1993 | 4699148955.57083
 MOROCCO                   |   1992 | 4721086016.12476
 MOZAMBIQUE                |   1998 | 2719461910.20831
 MOZAMBIQUE                |   1997 | 4631762656.61458
 MOZAMBIQUE                |   1996 | 4688224848.60933
 MOZAMBIQUE                |   1995 | 4654791119.78169
 MOZAMBIQUE                |   1994 | 4653293296.49372
 MOZAMBIQUE                |   1993 | 4650250577.40084
 MOZAMBIQUE                |   1992 | 4662461933.36811
 PERU                      |   1998 | 2723967215.05355
 PERU                      |   1997 | 4625517564.47984
 PERU                      |   1996 |  4660897522.5385
 PERU                      |   1995 | 4657002315.26056
 PERU                      |   1994 |  4649503161.7005
 PERU                      |   1993 | 4645458523.51988
 PERU                      |   1992 | 4676559821.83754
 ROMANIA                   |   1998 | 2737348065.36161
 ROMANIA                   |   1997 | 4677438234.13116
 ROMANIA                   |   1996 | 4696795823.32505
 ROMANIA                   |   1995 | 4688984073.35218
 ROMANIA                   |   1994 | 4710092672.00329
 ROMANIA                   |   1993 | 4661534683.70901
 ROMANIA                   |   1992 |  4679162238.6639
 RUSSIA                    |   1998 | 2737603591.96548
 RUSSIA                    |   1997 | 4681323040.65414
 RUSSIA                    |   1996 | 4703276201.52991
 RUSSIA                    |   1995 | 4667142259.94326
 RUSSIA                    |   1994 | 4664931234.07522
 RUSSIA                    |   1993 | 4656858618.44661
 RUSSIA                    |   1992 |  4710373460.2072
 SAUDI ARABIA              |   1998 | 2736326009.56063
 SAUDI ARABIA              |   1997 | 4659558497.18916
 SAUDI ARABIA              |   1996 | 4682362820.31365
 SAUDI ARABIA              |   1995 |  4664003870.7221
 SAUDI ARABIA              |   1994 | 4657562490.09519
 SAUDI ARABIA              |   1993 | 4638936706.08651
 SAUDI ARABIA              |   1992 | 4663831496.29926
 UNITED KINGDOM            |   1998 | 2769042322.51944
 UNITED KINGDOM            |   1997 | 4708262898.01707
 UNITED KINGDOM            |   1996 | 4711687164.87702
 UNITED KINGDOM            |   1995 | 4686284596.87687
 UNITED KINGDOM            |   1994 | 4716028162.87448
 UNITED KINGDOM            |   1993 | 4720346737.80618
 UNITED KINGDOM            |   1992 | 4721959933.40381
 UNITED STATES             |   1998 | 2747166110.62172
 UNITED STATES             |   1997 | 4714718481.26133
 UNITED STATES             |   1996 | 4701922458.26498
 UNITED STATES             |   1995 | 4679511105.89312
 UNITED STATES             |   1994 | 4709310127.95709
 UNITED STATES             |   1993 | 4676394270.53257
 UNITED STATES             |   1992 | 4693602255.45538
 VIETNAM                   |   1998 | 2741793828.90206
 VIETNAM                   |   1997 |  4677312120.4089
 VIETNAM                   |   1996 | 4677519272.91928
 VIETNAM                   |   1995 | 4707706492.09532
 VIETNAM                   |   1994 | 4671635385.81635
 VIETNAM                   |   1993 | 4682475292.50402
 VIETNAM                   |   1992 | 4678619650.52396
(175 rows)

COMMIT;
COMMIT
